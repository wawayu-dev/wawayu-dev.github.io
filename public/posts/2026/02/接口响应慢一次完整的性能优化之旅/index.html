<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—… | åšå®¢å–µ</title>
<meta name="keywords" content="æ€§èƒ½ä¼˜åŒ–, é—®é¢˜æ’æŸ¥, æœ€ä½³å®è·µ">
<meta name="description" content="ä»ä¸€ä¸ªçœŸå®çš„æ¥å£æ€§èƒ½é—®é¢˜å‡ºå‘ï¼Œæ·±å…¥è®²è§£å¦‚ä½•ç³»ç»Ÿæ€§åœ°è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œä»3ç§’ä¼˜åŒ–åˆ°300msçš„å®Œæ•´å®æˆ˜">
<meta name="author" content="wawayu">
<link rel="canonical" href="http://localhost:1313/posts/2026/02/%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94%E6%85%A2%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E6%97%85/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a29c24210eb31d9ce56f669c66a35c9c51b17376b7764e336a49af7dec914cf0.css" integrity="sha256-opwkIQ6zHZzlb2acZqNcnFGxc3a3dk4zakmvfeyRTPA=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2026/02/%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94%E6%85%A2%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E6%97%85/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/posts/2026/02/%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94%E6%85%A2%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E6%97%85/">
  <meta property="og:site_name" content="åšå®¢å–µ">
  <meta property="og:title" content="æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…">
  <meta property="og:description" content="ä»ä¸€ä¸ªçœŸå®çš„æ¥å£æ€§èƒ½é—®é¢˜å‡ºå‘ï¼Œæ·±å…¥è®²è§£å¦‚ä½•ç³»ç»Ÿæ€§åœ°è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œä»3ç§’ä¼˜åŒ–åˆ°300msçš„å®Œæ•´å®æˆ˜">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-02-12T00:00:00+00:00">
    <meta property="article:modified_time" content="2026-02-12T00:00:00+00:00">
    <meta property="article:tag" content="æ€§èƒ½ä¼˜åŒ–">
    <meta property="article:tag" content="é—®é¢˜æ’æŸ¥">
    <meta property="article:tag" content="æœ€ä½³å®è·µ">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…">
<meta name="twitter:description" content="ä»ä¸€ä¸ªçœŸå®çš„æ¥å£æ€§èƒ½é—®é¢˜å‡ºå‘ï¼Œæ·±å…¥è®²è§£å¦‚ä½•ç³»ç»Ÿæ€§åœ°è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œä»3ç§’ä¼˜åŒ–åˆ°300msçš„å®Œæ•´å®æˆ˜">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…",
      "item": "http://localhost:1313/posts/2026/02/%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94%E6%85%A2%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E6%97%85/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…",
  "name": "æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…",
  "description": "ä»ä¸€ä¸ªçœŸå®çš„æ¥å£æ€§èƒ½é—®é¢˜å‡ºå‘ï¼Œæ·±å…¥è®²è§£å¦‚ä½•ç³»ç»Ÿæ€§åœ°è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œä»3ç§’ä¼˜åŒ–åˆ°300msçš„å®Œæ•´å®æˆ˜",
  "keywords": [
    "æ€§èƒ½ä¼˜åŒ–", "é—®é¢˜æ’æŸ¥", "æœ€ä½³å®è·µ"
  ],
  "articleBody": "â€œè¿™ä¸ªæ¥å£æ€ä¹ˆè¿™ä¹ˆæ…¢ï¼Ÿâ€œè¿™æ˜¯æ¯ä¸ªåç«¯å¼€å‘éƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚å½“ç”¨æˆ·æŠ±æ€¨ç³»ç»Ÿå¡é¡¿ï¼Œå½“ç›‘æ§å‘Šè­¦é¢‘ç¹è§¦å‘ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ç³»ç»Ÿæ€§åœ°å®šä½å’Œè§£å†³æ€§èƒ½é—®é¢˜ï¼Ÿ\næœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªçœŸå®çš„æ¡ˆä¾‹ï¼Œå¸¦ä½ ç»å†ä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…ï¼Œä»é—®é¢˜å‘ç°åˆ°æœ€ç»ˆä¼˜åŒ–ï¼Œå°†æ¥å£å“åº”æ—¶é—´ä»3ç§’é™ä½åˆ°300msã€‚\næœ¬æ–‡äº®ç‚¹ æŒæ¡æ€§èƒ½é—®é¢˜çš„ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³• å­¦ä¼šä½¿ç”¨å„ç§æ€§èƒ½åˆ†æå·¥å…· ç†è§£å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆåŠè§£å†³æ–¹æ¡ˆ äº†è§£æ•°æ®åº“ã€ç¼“å­˜ã€ä»£ç å±‚é¢çš„ä¼˜åŒ–æŠ€å·§ å»ºç«‹å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–æ€ç»´æ¨¡å‹ é—®é¢˜èƒŒæ™¯ ä¸šåŠ¡åœºæ™¯ æŸç”µå•†ç³»ç»Ÿçš„è®¢å•è¯¦æƒ…æ¥å£ï¼Œç”¨æˆ·åé¦ˆé¡µé¢åŠ è½½ç¼“æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚\næ¥å£å®šä¹‰ï¼š\n1@GetMapping(\"/api/orders/{orderId}\") 2public Result\u003cOrderDetailVO\u003e getOrderDetail(@PathVariable Long orderId) { 3 return Result.success(orderService.getOrderDetail(orderId)); 4} ç›‘æ§æ•°æ®ï¼š\nå¹³å‡å“åº”æ—¶é—´ï¼š2.8ç§’ P95å“åº”æ—¶é—´ï¼š3.5ç§’ P99å“åº”æ—¶é—´ï¼š5ç§’ QPSï¼š100 ä¸šåŠ¡è¦æ±‚ï¼š\nå“åº”æ—¶é—´ \u003c 500ms P99 \u003c 1ç§’ æ¶æ„æ€è€ƒï¼š æ€§èƒ½ä¼˜åŒ–ä¸æ˜¯ç›²ç›®åœ°ä¼˜åŒ–ï¼Œè€Œæ˜¯è¦åŸºäºæ•°æ®å’Œç›®æ ‡ã€‚é¦–å…ˆè¦æ˜ç¡®æ€§èƒ½æŒ‡æ ‡å’Œä¼˜åŒ–ç›®æ ‡ï¼Œç„¶åç³»ç»Ÿæ€§åœ°åˆ†æå’Œä¼˜åŒ–ã€‚\nç¬¬ä¸€æ­¥ï¼šé—®é¢˜å®šä½ 1. æ·»åŠ ç›‘æ§åŸ‹ç‚¹ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ—¶é—´éƒ½èŠ±åœ¨å“ªé‡Œäº†ï¼š\n1@Service 2@Slf4j 3public class OrderService { 4 5 @Autowired 6 private OrderMapper orderMapper; 7 8 @Autowired 9 private UserService userService; 10 11 @Autowired 12 private ProductService productService; 13 14 @Autowired 15 private LogisticsService logisticsService; 16 17 public OrderDetailVO getOrderDetail(Long orderId) { 18 long startTime = System.currentTimeMillis(); 19 20 // 1. æŸ¥è¯¢è®¢å•åŸºæœ¬ä¿¡æ¯ 21 long step1Start = System.currentTimeMillis(); 22 Order order = orderMapper.selectById(orderId); 23 log.info(\"æŸ¥è¯¢è®¢å•è€—æ—¶ï¼š{}ms\", System.currentTimeMillis() - step1Start); 24 25 // 2. æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ 26 long step2Start = System.currentTimeMillis(); 27 User user = userService.getUserById(order.getUserId()); 28 log.info(\"æŸ¥è¯¢ç”¨æˆ·è€—æ—¶ï¼š{}ms\", System.currentTimeMillis() - step2Start); 29 30 // 3. æŸ¥è¯¢å•†å“ä¿¡æ¯ 31 long step3Start = System.currentTimeMillis(); 32 List\u003cOrderItem\u003e items = orderMapper.selectItemsByOrderId(orderId); 33 List\u003cProduct\u003e products = new ArrayList\u003c\u003e(); 34 for (OrderItem item : items) { 35 Product product = productService.getProductById(item.getProductId()); 36 products.add(product); 37 } 38 log.info(\"æŸ¥è¯¢å•†å“è€—æ—¶ï¼š{}ms\", System.currentTimeMillis() - step3Start); 39 40 // 4. æŸ¥è¯¢ç‰©æµä¿¡æ¯ 41 long step4Start = System.currentTimeMillis(); 42 Logistics logistics = logisticsService.getLogisticsByOrderId(orderId); 43 log.info(\"æŸ¥è¯¢ç‰©æµè€—æ—¶ï¼š{}ms\", System.currentTimeMillis() - step4Start); 44 45 // 5. ç»„è£…è¿”å›æ•°æ® 46 OrderDetailVO vo = buildOrderDetailVO(order, user, products, logistics); 47 48 log.info(\"æ€»è€—æ—¶ï¼š{}ms\", System.currentTimeMillis() - startTime); 49 return vo; 50 } 51} æ—¥å¿—è¾“å‡ºï¼š\n1æŸ¥è¯¢è®¢å•è€—æ—¶ï¼š50ms 2æŸ¥è¯¢ç”¨æˆ·è€—æ—¶ï¼š100ms 3æŸ¥è¯¢å•†å“è€—æ—¶ï¼š2500ms â† ç“¶é¢ˆï¼ 4æŸ¥è¯¢ç‰©æµè€—æ—¶ï¼š150ms 5æ€»è€—æ—¶ï¼š2800ms 2. åˆ†æç“¶é¢ˆ é€šè¿‡æ—¥å¿—å‘ç°ï¼ŒæŸ¥è¯¢å•†å“ä¿¡æ¯è€—æ—¶æœ€é•¿ï¼Œå æ€»è€—æ—¶çš„89%ã€‚è¿›ä¸€æ­¥åˆ†æä»£ç ï¼š\n1// é—®é¢˜ä»£ç ï¼šN+1æŸ¥è¯¢ 2List\u003cOrderItem\u003e items = orderMapper.selectItemsByOrderId(orderId); // 1æ¬¡æŸ¥è¯¢ 3List\u003cProduct\u003e products = new ArrayList\u003c\u003e(); 4for (OrderItem item : items) { 5 Product product = productService.getProductById(item.getProductId()); // Næ¬¡æŸ¥è¯¢ 6 products.add(product); 7} é—®é¢˜åˆ†æï¼š\nè®¢å•æœ‰10ä¸ªå•†å“ æ¯ä¸ªå•†å“æŸ¥è¯¢è€—æ—¶250ms æ€»è€—æ—¶ï¼š10 Ã— 250ms = 2500ms ç¬¬äºŒæ­¥ï¼šæ•°æ®åº“ä¼˜åŒ– ä¼˜åŒ–1ï¼šæ‰¹é‡æŸ¥è¯¢ å°†N+1æŸ¥è¯¢æ”¹ä¸ºæ‰¹é‡æŸ¥è¯¢ï¼š\n1// ä¼˜åŒ–åçš„ä»£ç  2List\u003cOrderItem\u003e items = orderMapper.selectItemsByOrderId(orderId); 3 4// æ”¶é›†æ‰€æœ‰å•†å“ID 5List\u003cLong\u003e productIds = items.stream() 6 .map(OrderItem::getProductId) 7 .collect(Collectors.toList()); 8 9// æ‰¹é‡æŸ¥è¯¢å•†å“ 10List\u003cProduct\u003e products = productService.getProductsByIds(productIds); Mapperå®ç°ï¼š\n1@Mapper 2public interface ProductMapper { 3 4 /** 5 * æ‰¹é‡æŸ¥è¯¢å•†å“ 6 */ 7 @Select(\"\") 13 List\u003cProduct\u003e selectByIds(@Param(\"ids\") List\u003cLong\u003e ids); 14} ä¼˜åŒ–æ•ˆæœï¼š\næŸ¥è¯¢å•†å“è€—æ—¶ï¼š2500ms â†’ 300ms æ€»è€—æ—¶ï¼š2800ms â†’ 600ms ä¼˜åŒ–2ï¼šç´¢å¼•ä¼˜åŒ– åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå‘ç°è®¢å•é¡¹æŸ¥è¯¢æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼š\n1-- æ…¢æŸ¥è¯¢SQL 2SELECT * FROM t_order_item WHERE order_id = 123456; 3 4-- æ‰§è¡Œè®¡åˆ’ 5EXPLAIN SELECT * FROM t_order_item WHERE order_id = 123456; 6-- type: ALLï¼ˆå…¨è¡¨æ‰«æï¼‰ æ·»åŠ ç´¢å¼•ï¼š\n1CREATE INDEX idx_order_id ON t_order_item(order_id); ä¼˜åŒ–æ•ˆæœï¼š\næŸ¥è¯¢è®¢å•é¡¹è€—æ—¶ï¼š50ms â†’ 5ms æ€»è€—æ—¶ï¼š600ms â†’ 555ms ä¼˜åŒ–3ï¼šæŸ¥è¯¢å­—æ®µä¼˜åŒ– åŸæŸ¥è¯¢ä½¿ç”¨äº†SELECT *ï¼Œä½†å®é™…åªéœ€è¦éƒ¨åˆ†å­—æ®µï¼š\n1// ä¼˜åŒ–å‰ 2@Select(\"SELECT * FROM t_product WHERE id IN (...)\") 3List\u003cProduct\u003e selectByIds(@Param(\"ids\") List\u003cLong\u003e ids); 4 5// ä¼˜åŒ–åï¼šåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ 6@Select(\"SELECT id, name, price, image_url FROM t_product WHERE id IN (...)\") 7List\u003cProductDTO\u003e selectByIds(@Param(\"ids\") List\u003cLong\u003e ids); ä¼˜åŒ–æ•ˆæœï¼š\næŸ¥è¯¢å•†å“è€—æ—¶ï¼š300ms â†’ 200ms æ€»è€—æ—¶ï¼š555ms â†’ 455ms ç¬¬ä¸‰æ­¥ï¼šç¼“å­˜ä¼˜åŒ– ä¼˜åŒ–4ï¼šæ·»åŠ Redisç¼“å­˜ å•†å“ä¿¡æ¯å˜åŒ–ä¸é¢‘ç¹ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜ï¼š\n1@Service 2@Slf4j 3public class ProductService { 4 5 @Autowired 6 private ProductMapper productMapper; 7 8 @Autowired 9 private RedisTemplate\u003cString, Product\u003e redisTemplate; 10 11 private static final String PRODUCT_CACHE_KEY = \"product:\"; 12 private static final long CACHE_EXPIRE_TIME = 30; // 30åˆ†é’Ÿ 13 14 public List\u003cProduct\u003e getProductsByIds(List\u003cLong\u003e productIds) { 15 List\u003cProduct\u003e products = new ArrayList\u003c\u003e(); 16 List\u003cLong\u003e missIds = new ArrayList\u003c\u003e(); 17 18 // 1. æ‰¹é‡ä»ç¼“å­˜è·å– 19 List\u003cString\u003e keys = productIds.stream() 20 .map(id -\u003e PRODUCT_CACHE_KEY + id) 21 .collect(Collectors.toList()); 22 23 List\u003cProduct\u003e cachedProducts = redisTemplate.opsForValue().multiGet(keys); 24 25 // 2. æ‰¾å‡ºç¼“å­˜æœªå‘½ä¸­çš„ID 26 for (int i = 0; i \u003c productIds.size(); i++) { 27 Product product = cachedProducts.get(i); 28 if (product != null) { 29 products.add(product); 30 } else { 31 missIds.add(productIds.get(i)); 32 } 33 } 34 35 // 3. æŸ¥è¯¢æ•°æ®åº“ 36 if (!missIds.isEmpty()) { 37 List\u003cProduct\u003e dbProducts = productMapper.selectByIds(missIds); 38 products.addAll(dbProducts); 39 40 // 4. å†™å…¥ç¼“å­˜ 41 for (Product product : dbProducts) { 42 redisTemplate.opsForValue().set( 43 PRODUCT_CACHE_KEY + product.getId(), 44 product, 45 CACHE_EXPIRE_TIME, 46 TimeUnit.MINUTES 47 ); 48 } 49 } 50 51 return products; 52 } 53} ä¼˜åŒ–æ•ˆæœï¼š\nç¼“å­˜å‘½ä¸­ç‡ï¼š80% æŸ¥è¯¢å•†å“è€—æ—¶ï¼š200ms â†’ 50msï¼ˆç¼“å­˜å‘½ä¸­æ—¶ï¼‰ æ€»è€—æ—¶ï¼š455ms â†’ 305ms ä¼˜åŒ–5ï¼šæœ¬åœ°ç¼“å­˜ å¯¹äºçƒ­ç‚¹å•†å“ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š\n1@Service 2public class ProductService { 3 4 // ä½¿ç”¨Caffeineæœ¬åœ°ç¼“å­˜ 5 private final LoadingCache\u003cLong, Product\u003e localCache = Caffeine.newBuilder() 6 .maximumSize(1000) 7 .expireAfterWrite(5, TimeUnit.MINUTES) 8 .build(this::loadProduct); 9 10 private Product loadProduct(Long productId) { 11 // å…ˆæŸ¥Redisï¼Œå†æŸ¥æ•°æ®åº“ 12 String key = PRODUCT_CACHE_KEY + productId; 13 Product product = redisTemplate.opsForValue().get(key); 14 15 if (product == null) { 16 product = productMapper.selectById(productId); 17 if (product != null) { 18 redisTemplate.opsForValue().set(key, product, 30, TimeUnit.MINUTES); 19 } 20 } 21 22 return product; 23 } 24 25 public Product getProductById(Long productId) { 26 return localCache.get(productId); 27 } 28} ç¼“å­˜å±‚çº§ï¼š\n1è¯·æ±‚ â†’ æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰â†’ Redis â†’ æ•°æ®åº“ ä¼˜åŒ–æ•ˆæœï¼š\næœ¬åœ°ç¼“å­˜å‘½ä¸­ç‡ï¼š50% æŸ¥è¯¢å•†å“è€—æ—¶ï¼š50ms â†’ 20msï¼ˆæœ¬åœ°ç¼“å­˜å‘½ä¸­æ—¶ï¼‰ æ€»è€—æ—¶ï¼š305ms â†’ 275ms ç¬¬å››æ­¥ï¼šå¹¶å‘ä¼˜åŒ– ä¼˜åŒ–6ï¼šå¹¶è¡ŒæŸ¥è¯¢ ç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ã€ç‰©æµä¿¡æ¯ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å¹¶è¡ŒæŸ¥è¯¢ï¼š\n1@Service 2public class OrderService { 3 4 @Autowired 5 private ThreadPoolExecutor executor; 6 7 public OrderDetailVO getOrderDetail(Long orderId) { 8 // 1. æŸ¥è¯¢è®¢å•åŸºæœ¬ä¿¡æ¯ 9 Order order = orderMapper.selectById(orderId); 10 11 // 2. å¹¶è¡ŒæŸ¥è¯¢ç”¨æˆ·ã€å•†å“ã€ç‰©æµä¿¡æ¯ 12 CompletableFuture\u003cUser\u003e userFuture = CompletableFuture.supplyAsync( 13 () -\u003e userService.getUserById(order.getUserId()), 14 executor 15 ); 16 17 CompletableFuture\u003cList\u003cProduct\u003e\u003e productsFuture = CompletableFuture.supplyAsync(() -\u003e { 18 List\u003cOrderItem\u003e items = orderMapper.selectItemsByOrderId(orderId); 19 List\u003cLong\u003e productIds = items.stream() 20 .map(OrderItem::getProductId) 21 .collect(Collectors.toList()); 22 return productService.getProductsByIds(productIds); 23 }, executor); 24 25 CompletableFuture\u003cLogistics\u003e logisticsFuture = CompletableFuture.supplyAsync( 26 () -\u003e logisticsService.getLogisticsByOrderId(orderId), 27 executor 28 ); 29 30 // 3. ç­‰å¾…æ‰€æœ‰æŸ¥è¯¢å®Œæˆ 31 CompletableFuture.allOf(userFuture, productsFuture, logisticsFuture).join(); 32 33 // 4. ç»„è£…è¿”å›æ•°æ® 34 User user = userFuture.join(); 35 List\u003cProduct\u003e products = productsFuture.join(); 36 Logistics logistics = logisticsFuture.join(); 37 38 return buildOrderDetailVO(order, user, products, logistics); 39 } 40} ä¼˜åŒ–æ•ˆæœï¼š\nåŸä¸²è¡Œè€—æ—¶ï¼š50msï¼ˆè®¢å•ï¼‰+ 100msï¼ˆç”¨æˆ·ï¼‰+ 20msï¼ˆå•†å“ï¼‰+ 150msï¼ˆç‰©æµï¼‰= 320ms å¹¶è¡Œè€—æ—¶ï¼š50msï¼ˆè®¢å•ï¼‰+ max(100ms, 20ms, 150ms) = 200ms æ€»è€—æ—¶ï¼š275ms â†’ 200ms ç¬¬äº”æ­¥ï¼šä»£ç ä¼˜åŒ– ä¼˜åŒ–7ï¼šå‡å°‘å¯¹è±¡åˆ›å»º 1// ä¼˜åŒ–å‰ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡ 2public OrderDetailVO buildOrderDetailVO(Order order, User user, 3 List\u003cProduct\u003e products, Logistics logistics) { 4 OrderDetailVO vo = new OrderDetailVO(); 5 vo.setOrderId(order.getId()); 6 vo.setOrderNo(order.getOrderNo()); 7 // ... è®¾ç½®æ›´å¤šå­—æ®µ 8 9 UserVO userVO = new UserVO(); 10 userVO.setUserId(user.getId()); 11 userVO.setUserName(user.getName()); 12 vo.setUser(userVO); 13 14 List\u003cProductVO\u003e productVOs = new ArrayList\u003c\u003e(); 15 for (Product product : products) { 16 ProductVO productVO = new ProductVO(); 17 productVO.setProductId(product.getId()); 18 productVO.setProductName(product.getName()); 19 productVOs.add(productVO); 20 } 21 vo.setProducts(productVOs); 22 23 return vo; 24} 25 26// ä¼˜åŒ–åï¼šä½¿ç”¨å¯¹è±¡æ˜ å°„å·¥å…· 27@Autowired 28private ModelMapper modelMapper; 29 30public OrderDetailVO buildOrderDetailVO(Order order, User user, 31 List\u003cProduct\u003e products, Logistics logistics) { 32 OrderDetailVO vo = modelMapper.map(order, OrderDetailVO.class); 33 vo.setUser(modelMapper.map(user, UserVO.class)); 34 vo.setProducts(products.stream() 35 .map(p -\u003e modelMapper.map(p, ProductVO.class)) 36 .collect(Collectors.toList())); 37 vo.setLogistics(modelMapper.map(logistics, LogisticsVO.class)); 38 return vo; 39} ä¼˜åŒ–8ï¼šé¿å…ä¸å¿…è¦çš„è®¡ç®— 1// ä¼˜åŒ–å‰ï¼šæ¯æ¬¡éƒ½è®¡ç®— 2public BigDecimal calculateTotalAmount(List\u003cOrderItem\u003e items) { 3 BigDecimal total = BigDecimal.ZERO; 4 for (OrderItem item : items) { 5 BigDecimal itemAmount = item.getPrice().multiply(new BigDecimal(item.getQuantity())); 6 total = total.add(itemAmount); 7 } 8 return total; 9} 10 11// ä¼˜åŒ–åï¼šä½¿ç”¨æ•°æ®åº“è®¡ç®—å¥½çš„å­—æ®µ 12public BigDecimal getTotalAmount(Order order) { 13 return order.getTotalAmount(); // ä¸‹å•æ—¶å·²è®¡ç®—å¹¶å­˜å‚¨ 14} ç¬¬å…­æ­¥ï¼šç›‘æ§ä¸éªŒè¯ æ€§èƒ½æµ‹è¯• ä½¿ç”¨JMeterè¿›è¡Œå‹æµ‹ï¼š\n1# å‹æµ‹é…ç½® 2çº¿ç¨‹æ•°ï¼š100 3æŒç»­æ—¶é—´ï¼š5åˆ†é’Ÿ ä¼˜åŒ–å‰åå¯¹æ¯”ï¼š\næŒ‡æ ‡ ä¼˜åŒ–å‰ ä¼˜åŒ–å æå‡ å¹³å‡å“åº”æ—¶é—´ 2800ms 280ms 90% P95å“åº”æ—¶é—´ 3500ms 350ms 90% P99å“åº”æ—¶é—´ 5000ms 450ms 91% QPS 100 500 400% CPUä½¿ç”¨ç‡ 80% 40% 50% ç›‘æ§å‘Šè­¦ é…ç½®Prometheuså‘Šè­¦è§„åˆ™ï¼š\n1groups: 2 - name: api_performance 3 rules: 4 - alert: HighResponseTime 5 expr: http_request_duration_seconds{quantile=\"0.99\"} \u003e 1 6 for: 5m 7 labels: 8 severity: warning 9 annotations: 10 summary: \"APIå“åº”æ—¶é—´è¿‡é«˜\" 11 description: \"{{ $labels.api }} P99å“åº”æ—¶é—´è¶…è¿‡1ç§’\" ä¼˜åŒ–æ€»ç»“ ä¼˜åŒ–è·¯å¾„ 1åŸå§‹æ€§èƒ½ï¼š2800ms 2 â†“ æ‰¹é‡æŸ¥è¯¢ï¼ˆN+1é—®é¢˜ï¼‰ 31. 600msï¼ˆä¼˜åŒ–78%ï¼‰ 4 â†“ æ·»åŠ ç´¢å¼• 52. 555msï¼ˆä¼˜åŒ–7%ï¼‰ 6 â†“ æŸ¥è¯¢å­—æ®µä¼˜åŒ– 73. 455msï¼ˆä¼˜åŒ–18%ï¼‰ 8 â†“ Redisç¼“å­˜ 94. 305msï¼ˆä¼˜åŒ–33%ï¼‰ 10 â†“ æœ¬åœ°ç¼“å­˜ 115. 275msï¼ˆä¼˜åŒ–10%ï¼‰ 12 â†“ å¹¶è¡ŒæŸ¥è¯¢ 136. 200msï¼ˆä¼˜åŒ–27%ï¼‰ 14 â†“ ä»£ç ä¼˜åŒ– 15æœ€ç»ˆï¼š280msï¼ˆæ€»ä¼˜åŒ–90%ï¼‰ ä¼˜åŒ–åŸåˆ™ å…ˆå®šä½ï¼Œåä¼˜åŒ–ï¼šé€šè¿‡ç›‘æ§æ‰¾åˆ°çœŸæ­£çš„ç“¶é¢ˆ æŠ“å¤§æ”¾å°ï¼šä¼˜å…ˆä¼˜åŒ–å æ¯”æœ€å¤§çš„éƒ¨åˆ† åˆ†å±‚ä¼˜åŒ–ï¼šæ•°æ®åº“ â†’ ç¼“å­˜ â†’ ä»£ç  â†’ æ¶æ„ é‡åŒ–è¯„ä¼°ï¼šæ¯æ¬¡ä¼˜åŒ–éƒ½è¦æœ‰æ•°æ®æ”¯æ’‘ æŒç»­ç›‘æ§ï¼šä¼˜åŒ–åè¦æŒç»­è§‚å¯Ÿæ•ˆæœ å¸¸è§æ€§èƒ½ç“¶é¢ˆ ç“¶é¢ˆç±»å‹ å…¸å‹è¡¨ç° è§£å†³æ–¹æ¡ˆ æ•°æ®åº“æ…¢æŸ¥è¯¢ å“åº”æ—¶é—´é•¿ï¼Œæ•°æ®åº“CPUé«˜ ç´¢å¼•ä¼˜åŒ–ã€SQLä¼˜åŒ–ã€åˆ†åº“åˆ†è¡¨ N+1æŸ¥è¯¢ å¤§é‡é‡å¤æŸ¥è¯¢ æ‰¹é‡æŸ¥è¯¢ã€JOINæŸ¥è¯¢ ç¼“å­˜æœªå‘½ä¸­ æ•°æ®åº“å‹åŠ›å¤§ æ·»åŠ ç¼“å­˜ã€é¢„çƒ­ç¼“å­˜ ä¸²è¡Œè°ƒç”¨ å“åº”æ—¶é—´=å„æ­¥éª¤ä¹‹å’Œ å¹¶è¡Œè°ƒç”¨ã€å¼‚æ­¥å¤„ç† å¯¹è±¡åˆ›å»º GCé¢‘ç¹ å¯¹è±¡å¤ç”¨ã€æ± åŒ–æŠ€æœ¯ é”ç«äº‰ å¹¶å‘æ€§èƒ½å·® å‡å°é”ç²’åº¦ã€æ— é”åŒ– æ€§èƒ½ä¼˜åŒ–å·¥å…·ç®± 1. ç›‘æ§å·¥å…· APMå·¥å…·ï¼š\nSkyWalkingï¼šåˆ†å¸ƒå¼è¿½è¸ª Prometheus + Grafanaï¼šæŒ‡æ ‡ç›‘æ§ ELKï¼šæ—¥å¿—åˆ†æ æ•°æ®åº“ç›‘æ§ï¼š\nMySQLæ…¢æŸ¥è¯¢æ—¥å¿— Explainæ‰§è¡Œè®¡åˆ’ Performance Schema 2. åˆ†æå·¥å…· JVMåˆ†æï¼š\n1# æŸ¥çœ‹GCæƒ…å†µ 2jstat -gcutil 1000 3 4# ç”Ÿæˆå †è½¬å‚¨ 5jmap -dump:format=b,file=heap.hprof 6 7# çº¿ç¨‹åˆ†æ 8jstack \u003e thread.txt ç«ç„°å›¾ï¼š\n1# ä½¿ç”¨async-profiler 2./profiler.sh -d 60 -f flamegraph.html 3. å‹æµ‹å·¥å…· JMeterï¼š\n1jmeter -n -t test-plan.jmx -l result.jtl -e -o report Gatlingï¼š\n1setUp( 2 scn.inject(rampUsersPerSec(10) to 1000 during (5 minutes)) 3).protocols(httpProtocol) æœ€ä½³å®è·µ 1. æ€§èƒ½ä¼˜åŒ–checklist æ·»åŠ ç›‘æ§åŸ‹ç‚¹ï¼Œé‡åŒ–æ€§èƒ½æŒ‡æ ‡ åˆ†ææ…¢æŸ¥è¯¢ï¼Œä¼˜åŒ–SQLå’Œç´¢å¼• è¯†åˆ«N+1æŸ¥è¯¢ï¼Œæ”¹ä¸ºæ‰¹é‡æŸ¥è¯¢ æ·»åŠ ç¼“å­˜ï¼Œæé«˜è¯»æ€§èƒ½ å¹¶è¡ŒåŒ–ç‹¬ç«‹æ“ä½œï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ ä¼˜åŒ–ä»£ç é€»è¾‘ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®— å‹æµ‹éªŒè¯ï¼Œç¡®ä¿ä¼˜åŒ–æ•ˆæœ æŒç»­ç›‘æ§ï¼Œé˜²æ­¢æ€§èƒ½é€€åŒ– 2. æ€§èƒ½ä¼˜åŒ–è¯¯åŒº âŒ è¿‡æ—©ä¼˜åŒ–ï¼šåœ¨æ²¡æœ‰æ€§èƒ½é—®é¢˜æ—¶å°±å¼€å§‹ä¼˜åŒ– âœ… åŸºäºæ•°æ®ä¼˜åŒ–ï¼šå…ˆæµ‹é‡ï¼Œå†ä¼˜åŒ–\nâŒ ç›²ç›®ä¼˜åŒ–ï¼šä¸çŸ¥é“ç“¶é¢ˆåœ¨å“ªå°±å¼€å§‹ä¼˜åŒ– âœ… å®šä½ç“¶é¢ˆï¼šæ‰¾åˆ°çœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆ\nâŒ å±€éƒ¨ä¼˜åŒ–ï¼šåªä¼˜åŒ–æŸä¸ªç‚¹ âœ… ç³»ç»Ÿä¼˜åŒ–ï¼šä»æ•´ä½“è§’åº¦ä¼˜åŒ–\nâŒ å¿½ç•¥ç›‘æ§ï¼šä¼˜åŒ–åä¸ç›‘æ§æ•ˆæœ âœ… æŒç»­ç›‘æ§ï¼šä¼˜åŒ–åæŒç»­è§‚å¯Ÿ\n3. æ€§èƒ½ä¼˜åŒ–æ€ç»´æ¨¡å‹ 1å‘ç°é—®é¢˜ 2 â†“ 3æ·»åŠ ç›‘æ§ï¼ˆé‡åŒ–é—®é¢˜ï¼‰ 4 â†“ 5å®šä½ç“¶é¢ˆï¼ˆæ‰¾åˆ°æ ¹å› ï¼‰ 6 â†“ 7åˆ¶å®šæ–¹æ¡ˆï¼ˆè¯„ä¼°æ”¶ç›Šï¼‰ 8 â†“ 9å®æ–½ä¼˜åŒ–ï¼ˆå°æ­¥å¿«è·‘ï¼‰ 10 â†“ 11éªŒè¯æ•ˆæœï¼ˆå‹æµ‹éªŒè¯ï¼‰ 12 â†“ 13æŒç»­ç›‘æ§ï¼ˆé˜²æ­¢é€€åŒ–ï¼‰ é¿å‘æç¤ºï¼š æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§çš„å·¥ä½œã€‚è¦å»ºç«‹æ€§èƒ½ç›‘æ§ä½“ç³»ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³æ€§èƒ½é—®é¢˜ã€‚åŒæ—¶è¦æ³¨æ„ï¼Œè¿‡åº¦ä¼˜åŒ–å¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œè¦åœ¨æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚\næ€»ç»“ä¸æ€è€ƒ æœ¬æ–‡é€šè¿‡ä¸€ä¸ªçœŸå®çš„æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹ï¼š\né—®é¢˜å®šä½ï¼šé€šè¿‡ç›‘æ§åŸ‹ç‚¹æ‰¾åˆ°ç“¶é¢ˆ æ•°æ®åº“ä¼˜åŒ–ï¼šæ‰¹é‡æŸ¥è¯¢ã€ç´¢å¼•ä¼˜åŒ–ã€å­—æ®µä¼˜åŒ– ç¼“å­˜ä¼˜åŒ–ï¼šRedisç¼“å­˜ã€æœ¬åœ°ç¼“å­˜ å¹¶å‘ä¼˜åŒ–ï¼šå¹¶è¡ŒæŸ¥è¯¢ã€å¼‚æ­¥å¤„ç† ä»£ç ä¼˜åŒ–ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºã€é¿å…é‡å¤è®¡ç®— ç›‘æ§éªŒè¯ï¼šå‹æµ‹éªŒè¯ã€æŒç»­ç›‘æ§ æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯ï¼š\né‡åŒ–é—®é¢˜ï¼šç”¨æ•°æ®è¯´è¯ å®šä½ç“¶é¢ˆï¼šæ‰¾åˆ°çœŸæ­£çš„é—®é¢˜ ç³»ç»Ÿä¼˜åŒ–ï¼šä»æ•´ä½“è§’åº¦æ€è€ƒ æŒç»­æ”¹è¿›ï¼šå»ºç«‹é•¿æ•ˆæœºåˆ¶ ä¸‹æ¬¡å½“ä½ é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶ï¼Œä¸å¦¨æŒ‰ç…§æœ¬æ–‡çš„æ€è·¯ï¼Œç³»ç»Ÿæ€§åœ°åˆ†æå’Œä¼˜åŒ–ã€‚è®°ä½ï¼Œæ€§èƒ½ä¼˜åŒ–ä¸æ˜¯é“¶å¼¹ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒç»­æ”¹è¿›çš„è¿‡ç¨‹ã€‚\n",
  "wordCount" : "1312",
  "inLanguage": "en",
  "datePublished": "2026-02-12T00:00:00Z",
  "dateModified": "2026-02-12T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "wawayu"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/2026/02/%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94%E6%85%A2%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E6%97%85/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "åšå®¢å–µ",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="åšå®¢å–µ (Alt + H)">åšå®¢å–µ</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="ğŸ“ æ–‡ç« ">
                    <span>ğŸ“ æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="ğŸ·ï¸ æ ‡ç­¾">
                    <span>ğŸ·ï¸ æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="ğŸ“‚ åˆ†ç±»">
                    <span>ğŸ“‚ åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/skills/" title="ğŸ’» æŠ€èƒ½">
                    <span>ğŸ’» æŠ€èƒ½</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="ğŸ‘¤ å…³äº">
                    <span>ğŸ‘¤ å…³äº</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ” æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;Â»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…
    </h1>
    <div class="post-description">
      ä»ä¸€ä¸ªçœŸå®çš„æ¥å£æ€§èƒ½é—®é¢˜å‡ºå‘ï¼Œæ·±å…¥è®²è§£å¦‚ä½•ç³»ç»Ÿæ€§åœ°è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œä»3ç§’ä¼˜åŒ–åˆ°300msçš„å®Œæ•´å®æˆ˜
    </div>
    <div class="post-meta"><span title='2026-02-12 00:00:00 +0000 UTC'>February 12, 2026</span>&nbsp;Â·&nbsp;<span>7 min</span>&nbsp;Â·&nbsp;<span>1312 words</span>&nbsp;Â·&nbsp;<span>wawayu</span>&nbsp;|&nbsp;<span>
    <a href="https://github.com/wawayu-dev/wawayu-dev.github.io/tree/main/content/posts/api-performance-optimization-journey.md" rel="noopener noreferrer edit" target="_blank">å»ºè®®ä¿®æ”¹</a>
</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#æœ¬æ–‡äº®ç‚¹">æœ¬æ–‡äº®ç‚¹</a></li>
      </ul>
    </li>
    <li><a href="#é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯</a>
      <ul>
        <li><a href="#ä¸šåŠ¡åœºæ™¯">ä¸šåŠ¡åœºæ™¯</a></li>
      </ul>
    </li>
    <li><a href="#ç¬¬ä¸€æ­¥é—®é¢˜å®šä½">ç¬¬ä¸€æ­¥ï¼šé—®é¢˜å®šä½</a>
      <ul>
        <li><a href="#1-æ·»åŠ ç›‘æ§åŸ‹ç‚¹">1. æ·»åŠ ç›‘æ§åŸ‹ç‚¹</a></li>
        <li><a href="#2-åˆ†æç“¶é¢ˆ">2. åˆ†æç“¶é¢ˆ</a></li>
      </ul>
    </li>
    <li><a href="#ç¬¬äºŒæ­¥æ•°æ®åº“ä¼˜åŒ–">ç¬¬äºŒæ­¥ï¼šæ•°æ®åº“ä¼˜åŒ–</a>
      <ul>
        <li><a href="#ä¼˜åŒ–1æ‰¹é‡æŸ¥è¯¢">ä¼˜åŒ–1ï¼šæ‰¹é‡æŸ¥è¯¢</a></li>
        <li><a href="#ä¼˜åŒ–2ç´¢å¼•ä¼˜åŒ–">ä¼˜åŒ–2ï¼šç´¢å¼•ä¼˜åŒ–</a></li>
        <li><a href="#ä¼˜åŒ–3æŸ¥è¯¢å­—æ®µä¼˜åŒ–">ä¼˜åŒ–3ï¼šæŸ¥è¯¢å­—æ®µä¼˜åŒ–</a></li>
      </ul>
    </li>
    <li><a href="#ç¬¬ä¸‰æ­¥ç¼“å­˜ä¼˜åŒ–">ç¬¬ä¸‰æ­¥ï¼šç¼“å­˜ä¼˜åŒ–</a>
      <ul>
        <li><a href="#ä¼˜åŒ–4æ·»åŠ redisç¼“å­˜">ä¼˜åŒ–4ï¼šæ·»åŠ Redisç¼“å­˜</a></li>
        <li><a href="#ä¼˜åŒ–5æœ¬åœ°ç¼“å­˜">ä¼˜åŒ–5ï¼šæœ¬åœ°ç¼“å­˜</a></li>
      </ul>
    </li>
    <li><a href="#ç¬¬å››æ­¥å¹¶å‘ä¼˜åŒ–">ç¬¬å››æ­¥ï¼šå¹¶å‘ä¼˜åŒ–</a>
      <ul>
        <li><a href="#ä¼˜åŒ–6å¹¶è¡ŒæŸ¥è¯¢">ä¼˜åŒ–6ï¼šå¹¶è¡ŒæŸ¥è¯¢</a></li>
      </ul>
    </li>
    <li><a href="#ç¬¬äº”æ­¥ä»£ç ä¼˜åŒ–">ç¬¬äº”æ­¥ï¼šä»£ç ä¼˜åŒ–</a>
      <ul>
        <li><a href="#ä¼˜åŒ–7å‡å°‘å¯¹è±¡åˆ›å»º">ä¼˜åŒ–7ï¼šå‡å°‘å¯¹è±¡åˆ›å»º</a></li>
        <li><a href="#ä¼˜åŒ–8é¿å…ä¸å¿…è¦çš„è®¡ç®—">ä¼˜åŒ–8ï¼šé¿å…ä¸å¿…è¦çš„è®¡ç®—</a></li>
      </ul>
    </li>
    <li><a href="#ç¬¬å…­æ­¥ç›‘æ§ä¸éªŒè¯">ç¬¬å…­æ­¥ï¼šç›‘æ§ä¸éªŒè¯</a>
      <ul>
        <li><a href="#æ€§èƒ½æµ‹è¯•">æ€§èƒ½æµ‹è¯•</a></li>
        <li><a href="#ç›‘æ§å‘Šè­¦">ç›‘æ§å‘Šè­¦</a></li>
      </ul>
    </li>
    <li><a href="#ä¼˜åŒ–æ€»ç»“">ä¼˜åŒ–æ€»ç»“</a>
      <ul>
        <li><a href="#ä¼˜åŒ–è·¯å¾„">ä¼˜åŒ–è·¯å¾„</a></li>
        <li><a href="#ä¼˜åŒ–åŸåˆ™">ä¼˜åŒ–åŸåˆ™</a></li>
        <li><a href="#å¸¸è§æ€§èƒ½ç“¶é¢ˆ">å¸¸è§æ€§èƒ½ç“¶é¢ˆ</a></li>
      </ul>
    </li>
    <li><a href="#æ€§èƒ½ä¼˜åŒ–å·¥å…·ç®±">æ€§èƒ½ä¼˜åŒ–å·¥å…·ç®±</a>
      <ul>
        <li><a href="#1-ç›‘æ§å·¥å…·">1. ç›‘æ§å·¥å…·</a></li>
        <li><a href="#2-åˆ†æå·¥å…·">2. åˆ†æå·¥å…·</a></li>
        <li><a href="#3-å‹æµ‹å·¥å…·">3. å‹æµ‹å·¥å…·</a></li>
      </ul>
    </li>
    <li><a href="#æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</a>
      <ul>
        <li><a href="#1-æ€§èƒ½ä¼˜åŒ–checklist">1. æ€§èƒ½ä¼˜åŒ–checklist</a></li>
        <li><a href="#2-æ€§èƒ½ä¼˜åŒ–è¯¯åŒº">2. æ€§èƒ½ä¼˜åŒ–è¯¯åŒº</a></li>
        <li><a href="#3-æ€§èƒ½ä¼˜åŒ–æ€ç»´æ¨¡å‹">3. æ€§èƒ½ä¼˜åŒ–æ€ç»´æ¨¡å‹</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“ä¸æ€è€ƒ">æ€»ç»“ä¸æ€è€ƒ</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>&ldquo;è¿™ä¸ªæ¥å£æ€ä¹ˆè¿™ä¹ˆæ…¢ï¼Ÿ&ldquo;è¿™æ˜¯æ¯ä¸ªåç«¯å¼€å‘éƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚å½“ç”¨æˆ·æŠ±æ€¨ç³»ç»Ÿå¡é¡¿ï¼Œå½“ç›‘æ§å‘Šè­¦é¢‘ç¹è§¦å‘ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ç³»ç»Ÿæ€§åœ°å®šä½å’Œè§£å†³æ€§èƒ½é—®é¢˜ï¼Ÿ</p>
<p>æœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªçœŸå®çš„æ¡ˆä¾‹ï¼Œå¸¦ä½ ç»å†ä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…ï¼Œä»é—®é¢˜å‘ç°åˆ°æœ€ç»ˆä¼˜åŒ–ï¼Œå°†æ¥å£å“åº”æ—¶é—´ä»3ç§’é™ä½åˆ°300msã€‚</p>
<h3 id="æœ¬æ–‡äº®ç‚¹">æœ¬æ–‡äº®ç‚¹<a hidden class="anchor" aria-hidden="true" href="#æœ¬æ–‡äº®ç‚¹">#</a></h3>
<ul>
<li><input checked="" disabled="" type="checkbox"> æŒæ¡æ€§èƒ½é—®é¢˜çš„ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•</li>
<li><input checked="" disabled="" type="checkbox"> å­¦ä¼šä½¿ç”¨å„ç§æ€§èƒ½åˆ†æå·¥å…·</li>
<li><input checked="" disabled="" type="checkbox"> ç†è§£å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆåŠè§£å†³æ–¹æ¡ˆ</li>
<li><input checked="" disabled="" type="checkbox"> äº†è§£æ•°æ®åº“ã€ç¼“å­˜ã€ä»£ç å±‚é¢çš„ä¼˜åŒ–æŠ€å·§</li>
<li><input checked="" disabled="" type="checkbox"> å»ºç«‹å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–æ€ç»´æ¨¡å‹</li>
</ul>
<hr>
<h2 id="é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯<a hidden class="anchor" aria-hidden="true" href="#é—®é¢˜èƒŒæ™¯">#</a></h2>
<h3 id="ä¸šåŠ¡åœºæ™¯">ä¸šåŠ¡åœºæ™¯<a hidden class="anchor" aria-hidden="true" href="#ä¸šåŠ¡åœºæ™¯">#</a></h3>
<p>æŸç”µå•†ç³»ç»Ÿçš„è®¢å•è¯¦æƒ…æ¥å£ï¼Œç”¨æˆ·åé¦ˆé¡µé¢åŠ è½½ç¼“æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>æ¥å£å®šä¹‰</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/api/orders/{orderId}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Result</span><span class="o">&lt;</span><span class="n">OrderDetailVO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getOrderDetail</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">orderService</span><span class="p">.</span><span class="na">getOrderDetail</span><span class="p">(</span><span class="n">orderId</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>ç›‘æ§æ•°æ®</strong>ï¼š</p>
<ul>
<li>å¹³å‡å“åº”æ—¶é—´ï¼š2.8ç§’</li>
<li>P95å“åº”æ—¶é—´ï¼š3.5ç§’</li>
<li>P99å“åº”æ—¶é—´ï¼š5ç§’</li>
<li>QPSï¼š100</li>
</ul>
<p><strong>ä¸šåŠ¡è¦æ±‚</strong>ï¼š</p>
<ul>
<li>å“åº”æ—¶é—´ &lt; 500ms</li>
<li>P99 &lt; 1ç§’</li>
</ul>
<blockquote>
<p><strong>æ¶æ„æ€è€ƒï¼š</strong> æ€§èƒ½ä¼˜åŒ–ä¸æ˜¯ç›²ç›®åœ°ä¼˜åŒ–ï¼Œè€Œæ˜¯è¦åŸºäºæ•°æ®å’Œç›®æ ‡ã€‚é¦–å…ˆè¦æ˜ç¡®æ€§èƒ½æŒ‡æ ‡å’Œä¼˜åŒ–ç›®æ ‡ï¼Œç„¶åç³»ç»Ÿæ€§åœ°åˆ†æå’Œä¼˜åŒ–ã€‚</p>
</blockquote>
<hr>
<h2 id="ç¬¬ä¸€æ­¥é—®é¢˜å®šä½">ç¬¬ä¸€æ­¥ï¼šé—®é¢˜å®šä½<a hidden class="anchor" aria-hidden="true" href="#ç¬¬ä¸€æ­¥é—®é¢˜å®šä½">#</a></h2>
<h3 id="1-æ·»åŠ ç›‘æ§åŸ‹ç‚¹">1. æ·»åŠ ç›‘æ§åŸ‹ç‚¹<a hidden class="anchor" aria-hidden="true" href="#1-æ·»åŠ ç›‘æ§åŸ‹ç‚¹">#</a></h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ—¶é—´éƒ½èŠ±åœ¨å“ªé‡Œäº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ProductService</span><span class="w"> </span><span class="n">productService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LogisticsService</span><span class="w"> </span><span class="n">logisticsService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OrderDetailVO</span><span class="w"> </span><span class="nf">getOrderDetail</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">        </span><span class="c1">// 1. æŸ¥è¯¢è®¢å•åŸºæœ¬ä¿¡æ¯</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">step1Start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">        </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;æŸ¥è¯¢è®¢å•è€—æ—¶ï¼š{}ms&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">step1Start</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">        </span><span class="c1">// 2. æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">step2Start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;æŸ¥è¯¢ç”¨æˆ·è€—æ—¶ï¼š{}ms&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">step2Start</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w">        </span><span class="c1">// 3. æŸ¥è¯¢å•†å“ä¿¡æ¯</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">step3Start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectItemsByOrderId</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">OrderItem</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="w">            </span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productService</span><span class="p">.</span><span class="na">getProductById</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getProductId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="w">            </span><span class="n">products</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">product</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;æŸ¥è¯¢å•†å“è€—æ—¶ï¼š{}ms&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">step3Start</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="w">        </span><span class="c1">// 4. æŸ¥è¯¢ç‰©æµä¿¡æ¯</span><span class="w">
</span></span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">step4Start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="w">        </span><span class="n">Logistics</span><span class="w"> </span><span class="n">logistics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logisticsService</span><span class="p">.</span><span class="na">getLogisticsByOrderId</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;æŸ¥è¯¢ç‰©æµè€—æ—¶ï¼š{}ms&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">step4Start</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="w">        </span><span class="c1">// 5. ç»„è£…è¿”å›æ•°æ®</span><span class="w">
</span></span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="w">        </span><span class="n">OrderDetailVO</span><span class="w"> </span><span class="n">vo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buildOrderDetailVO</span><span class="p">(</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">logistics</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;æ€»è€—æ—¶ï¼š{}ms&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">vo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>æ—¥å¿—è¾“å‡º</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">æŸ¥è¯¢è®¢å•è€—æ—¶ï¼š50ms
</span></span><span class="line"><span class="ln">2</span><span class="cl">æŸ¥è¯¢ç”¨æˆ·è€—æ—¶ï¼š100ms
</span></span><span class="line"><span class="ln">3</span><span class="cl">æŸ¥è¯¢å•†å“è€—æ—¶ï¼š2500ms  â† ç“¶é¢ˆï¼
</span></span><span class="line"><span class="ln">4</span><span class="cl">æŸ¥è¯¢ç‰©æµè€—æ—¶ï¼š150ms
</span></span><span class="line"><span class="ln">5</span><span class="cl">æ€»è€—æ—¶ï¼š2800ms
</span></span></code></pre></div><h3 id="2-åˆ†æç“¶é¢ˆ">2. åˆ†æç“¶é¢ˆ<a hidden class="anchor" aria-hidden="true" href="#2-åˆ†æç“¶é¢ˆ">#</a></h3>
<p>é€šè¿‡æ—¥å¿—å‘ç°ï¼ŒæŸ¥è¯¢å•†å“ä¿¡æ¯è€—æ—¶æœ€é•¿ï¼Œå æ€»è€—æ—¶çš„89%ã€‚è¿›ä¸€æ­¥åˆ†æä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// é—®é¢˜ä»£ç ï¼šN+1æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectItemsByOrderId</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">  </span><span class="c1">// 1æ¬¡æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">OrderItem</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productService</span><span class="p">.</span><span class="na">getProductById</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getProductId</span><span class="p">());</span><span class="w">  </span><span class="c1">// Næ¬¡æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="n">products</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">product</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>è®¢å•æœ‰10ä¸ªå•†å“</li>
<li>æ¯ä¸ªå•†å“æŸ¥è¯¢è€—æ—¶250ms</li>
<li>æ€»è€—æ—¶ï¼š10 Ã— 250ms = 2500ms</li>
</ul>
<hr>
<h2 id="ç¬¬äºŒæ­¥æ•°æ®åº“ä¼˜åŒ–">ç¬¬äºŒæ­¥ï¼šæ•°æ®åº“ä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#ç¬¬äºŒæ­¥æ•°æ®åº“ä¼˜åŒ–">#</a></h2>
<h3 id="ä¼˜åŒ–1æ‰¹é‡æŸ¥è¯¢">ä¼˜åŒ–1ï¼šæ‰¹é‡æŸ¥è¯¢<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–1æ‰¹é‡æŸ¥è¯¢">#</a></h3>
<p>å°†N+1æŸ¥è¯¢æ”¹ä¸ºæ‰¹é‡æŸ¥è¯¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// ä¼˜åŒ–åçš„ä»£ç </span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectItemsByOrderId</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// æ”¶é›†æ‰€æœ‰å•†å“ID</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">productIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">OrderItem</span><span class="p">::</span><span class="n">getProductId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1">// æ‰¹é‡æŸ¥è¯¢å•†å“</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productService</span><span class="p">.</span><span class="na">getProductsByIds</span><span class="p">(</span><span class="n">productIds</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><strong>Mapperå®ç°</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nd">@Mapper</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ProductMapper</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm">     * æ‰¹é‡æŸ¥è¯¢å•†å“
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;&lt;script&gt;&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">            </span><span class="s">&#34;SELECT * FROM t_product WHERE id IN &#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">            </span><span class="s">&#34;&lt;foreach collection=&#39;ids&#39; item=&#39;id&#39; open=&#39;(&#39; separator=&#39;,&#39; close=&#39;)&#39;&gt;&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">            </span><span class="s">&#34;#{id}&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">            </span><span class="s">&#34;&lt;/foreach&gt;&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">            </span><span class="s">&#34;&lt;/script&gt;&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectByIds</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;ids&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ids</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼š</p>
<ul>
<li>æŸ¥è¯¢å•†å“è€—æ—¶ï¼š2500ms â†’ 300ms</li>
<li>æ€»è€—æ—¶ï¼š2800ms â†’ 600ms</li>
</ul>
<h3 id="ä¼˜åŒ–2ç´¢å¼•ä¼˜åŒ–">ä¼˜åŒ–2ï¼šç´¢å¼•ä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–2ç´¢å¼•ä¼˜åŒ–">#</a></h3>
<p>åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå‘ç°è®¢å•é¡¹æŸ¥è¯¢æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- æ…¢æŸ¥è¯¢SQL
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_order_item</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123456</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">-- æ‰§è¡Œè®¡åˆ’
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_order_item</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123456</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1">-- type: ALLï¼ˆå…¨è¡¨æ‰«æï¼‰
</span></span></span></code></pre></div><p><strong>æ·»åŠ ç´¢å¼•</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_order_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t_order_item</span><span class="p">(</span><span class="n">order_id</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼š</p>
<ul>
<li>æŸ¥è¯¢è®¢å•é¡¹è€—æ—¶ï¼š50ms â†’ 5ms</li>
<li>æ€»è€—æ—¶ï¼š600ms â†’ 555ms</li>
</ul>
<h3 id="ä¼˜åŒ–3æŸ¥è¯¢å­—æ®µä¼˜åŒ–">ä¼˜åŒ–3ï¼šæŸ¥è¯¢å­—æ®µä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–3æŸ¥è¯¢å­—æ®µä¼˜åŒ–">#</a></h3>
<p>åŸæŸ¥è¯¢ä½¿ç”¨äº†<code>SELECT *</code>ï¼Œä½†å®é™…åªéœ€è¦éƒ¨åˆ†å­—æ®µï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// ä¼˜åŒ–å‰</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;SELECT * FROM t_product WHERE id IN (...)&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectByIds</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;ids&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ids</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1">// ä¼˜åŒ–åï¼šåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;SELECT id, name, price, image_url FROM t_product WHERE id IN (...)&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">ProductDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectByIds</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;ids&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ids</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼š</p>
<ul>
<li>æŸ¥è¯¢å•†å“è€—æ—¶ï¼š300ms â†’ 200ms</li>
<li>æ€»è€—æ—¶ï¼š555ms â†’ 455ms</li>
</ul>
<hr>
<h2 id="ç¬¬ä¸‰æ­¥ç¼“å­˜ä¼˜åŒ–">ç¬¬ä¸‰æ­¥ï¼šç¼“å­˜ä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#ç¬¬ä¸‰æ­¥ç¼“å­˜ä¼˜åŒ–">#</a></h2>
<h3 id="ä¼˜åŒ–4æ·»åŠ redisç¼“å­˜">ä¼˜åŒ–4ï¼šæ·»åŠ Redisç¼“å­˜<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–4æ·»åŠ redisç¼“å­˜">#</a></h3>
<p>å•†å“ä¿¡æ¯å˜åŒ–ä¸é¢‘ç¹ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProductService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ProductMapper</span><span class="w"> </span><span class="n">productMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">PRODUCT_CACHE_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;product:&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">CACHE_EXPIRE_TIME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">30</span><span class="p">;</span><span class="w"> </span><span class="c1">// 30åˆ†é’Ÿ</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getProductsByIds</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">productIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">missIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">        </span><span class="c1">// 1. æ‰¹é‡ä»ç¼“å­˜è·å–</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productIds</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PRODUCT_CACHE_KEY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cachedProducts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">multiGet</span><span class="p">(</span><span class="n">keys</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">        </span><span class="c1">// 2. æ‰¾å‡ºç¼“å­˜æœªå‘½ä¸­çš„ID</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">productIds</span><span class="p">.</span><span class="na">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">            </span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cachedProducts</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">product</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">                </span><span class="n">products</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">product</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w">                </span><span class="n">missIds</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">productIds</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="w">        </span><span class="c1">// 3. æŸ¥è¯¢æ•°æ®åº“</span><span class="w">
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">missIds</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbProducts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productMapper</span><span class="p">.</span><span class="na">selectByIds</span><span class="p">(</span><span class="n">missIds</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="w">            </span><span class="n">products</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">dbProducts</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="w">            </span><span class="c1">// 4. å†™å…¥ç¼“å­˜</span><span class="w">
</span></span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">dbProducts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="w">                </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">set</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="w">                    </span><span class="n">PRODUCT_CACHE_KEY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="w">                    </span><span class="n">product</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="w">                    </span><span class="n">CACHE_EXPIRE_TIME</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="w">                    </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MINUTES</span><span class="w">
</span></span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="w">                </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">products</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼š</p>
<ul>
<li>ç¼“å­˜å‘½ä¸­ç‡ï¼š80%</li>
<li>æŸ¥è¯¢å•†å“è€—æ—¶ï¼š200ms â†’ 50msï¼ˆç¼“å­˜å‘½ä¸­æ—¶ï¼‰</li>
<li>æ€»è€—æ—¶ï¼š455ms â†’ 305ms</li>
</ul>
<h3 id="ä¼˜åŒ–5æœ¬åœ°ç¼“å­˜">ä¼˜åŒ–5ï¼šæœ¬åœ°ç¼“å­˜<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–5æœ¬åœ°ç¼“å­˜">#</a></h3>
<p>å¯¹äºçƒ­ç‚¹å•†å“ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProductService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="c1">// ä½¿ç”¨Caffeineæœ¬åœ°ç¼“å­˜</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">LoadingCache</span><span class="o">&lt;</span><span class="n">Long</span><span class="p">,</span><span class="w"> </span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">localCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Caffeine</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">maximumSize</span><span class="p">(</span><span class="n">1000</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">expireAfterWrite</span><span class="p">(</span><span class="n">5</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MINUTES</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">loadProduct</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="nf">loadProduct</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="c1">// å…ˆæŸ¥Redisï¼Œå†æŸ¥æ•°æ®åº“</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PRODUCT_CACHE_KEY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">        </span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">product</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">            </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productMapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">(</span><span class="n">productId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">product</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">                </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">30</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MINUTES</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">product</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="nf">getProductById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">localCache</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">productId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>ç¼“å­˜å±‚çº§</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">è¯·æ±‚ â†’ æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰â†’ Redis â†’ æ•°æ®åº“
</span></span></code></pre></div><p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼š</p>
<ul>
<li>æœ¬åœ°ç¼“å­˜å‘½ä¸­ç‡ï¼š50%</li>
<li>æŸ¥è¯¢å•†å“è€—æ—¶ï¼š50ms â†’ 20msï¼ˆæœ¬åœ°ç¼“å­˜å‘½ä¸­æ—¶ï¼‰</li>
<li>æ€»è€—æ—¶ï¼š305ms â†’ 275ms</li>
</ul>
<hr>
<h2 id="ç¬¬å››æ­¥å¹¶å‘ä¼˜åŒ–">ç¬¬å››æ­¥ï¼šå¹¶å‘ä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#ç¬¬å››æ­¥å¹¶å‘ä¼˜åŒ–">#</a></h2>
<h3 id="ä¼˜åŒ–6å¹¶è¡ŒæŸ¥è¯¢">ä¼˜åŒ–6ï¼šå¹¶è¡ŒæŸ¥è¯¢<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–6å¹¶è¡ŒæŸ¥è¯¢">#</a></h3>
<p>ç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ã€ç‰©æµä¿¡æ¯ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å¹¶è¡ŒæŸ¥è¯¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OrderDetailVO</span><span class="w"> </span><span class="nf">getOrderDetail</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">        </span><span class="c1">// 1. æŸ¥è¯¢è®¢å•åŸºæœ¬ä¿¡æ¯</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="c1">// 2. å¹¶è¡ŒæŸ¥è¯¢ç”¨æˆ·ã€å•†å“ã€ç‰©æµä¿¡æ¯</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">            </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getUserId</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">            </span><span class="n">executor</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">        </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">        </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">productsFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectItemsByOrderId</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">productIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">OrderItem</span><span class="p">::</span><span class="n">getProductId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">productService</span><span class="p">.</span><span class="na">getProductsByIds</span><span class="p">(</span><span class="n">productIds</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="n">executor</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">        </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Logistics</span><span class="o">&gt;</span><span class="w"> </span><span class="n">logisticsFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">            </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logisticsService</span><span class="p">.</span><span class="na">getLogisticsByOrderId</span><span class="p">(</span><span class="n">orderId</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">            </span><span class="n">executor</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">        </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w">        </span><span class="c1">// 3. ç­‰å¾…æ‰€æœ‰æŸ¥è¯¢å®Œæˆ</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w">        </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">allOf</span><span class="p">(</span><span class="n">userFuture</span><span class="p">,</span><span class="w"> </span><span class="n">productsFuture</span><span class="p">,</span><span class="w"> </span><span class="n">logisticsFuture</span><span class="p">).</span><span class="na">join</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w">        </span><span class="c1">// 4. ç»„è£…è¿”å›æ•°æ®</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userFuture</span><span class="p">.</span><span class="na">join</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productsFuture</span><span class="p">.</span><span class="na">join</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="w">        </span><span class="n">Logistics</span><span class="w"> </span><span class="n">logistics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logisticsFuture</span><span class="p">.</span><span class="na">join</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">buildOrderDetailVO</span><span class="p">(</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">logistics</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼š</p>
<ul>
<li>åŸä¸²è¡Œè€—æ—¶ï¼š50msï¼ˆè®¢å•ï¼‰+ 100msï¼ˆç”¨æˆ·ï¼‰+ 20msï¼ˆå•†å“ï¼‰+ 150msï¼ˆç‰©æµï¼‰= 320ms</li>
<li>å¹¶è¡Œè€—æ—¶ï¼š50msï¼ˆè®¢å•ï¼‰+ max(100ms, 20ms, 150ms) = 200ms</li>
<li>æ€»è€—æ—¶ï¼š275ms â†’ 200ms</li>
</ul>
<hr>
<h2 id="ç¬¬äº”æ­¥ä»£ç ä¼˜åŒ–">ç¬¬äº”æ­¥ï¼šä»£ç ä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#ç¬¬äº”æ­¥ä»£ç ä¼˜åŒ–">#</a></h2>
<h3 id="ä¼˜åŒ–7å‡å°‘å¯¹è±¡åˆ›å»º">ä¼˜åŒ–7ï¼šå‡å°‘å¯¹è±¡åˆ›å»º<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–7å‡å°‘å¯¹è±¡åˆ›å»º">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// ä¼˜åŒ–å‰ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">OrderDetailVO</span><span class="w"> </span><span class="nf">buildOrderDetailVO</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">                                        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">Logistics</span><span class="w"> </span><span class="n">logistics</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="n">OrderDetailVO</span><span class="w"> </span><span class="n">vo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderDetailVO</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="n">vo</span><span class="p">.</span><span class="na">setOrderId</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="n">vo</span><span class="p">.</span><span class="na">setOrderNo</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getOrderNo</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="c1">// ... è®¾ç½®æ›´å¤šå­—æ®µ</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="n">UserVO</span><span class="w"> </span><span class="n">userVO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserVO</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="n">userVO</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="n">userVO</span><span class="p">.</span><span class="na">setUserName</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">    </span><span class="n">vo</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">userVO</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ProductVO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">productVOs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">products</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">        </span><span class="n">ProductVO</span><span class="w"> </span><span class="n">productVO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProductVO</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">        </span><span class="n">productVO</span><span class="p">.</span><span class="na">setProductId</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">        </span><span class="n">productVO</span><span class="p">.</span><span class="na">setProductName</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">        </span><span class="n">productVOs</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">productVO</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">    </span><span class="n">vo</span><span class="p">.</span><span class="na">setProducts</span><span class="p">(</span><span class="n">productVOs</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">vo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="c1">// ä¼˜åŒ–åï¼šä½¿ç”¨å¯¹è±¡æ˜ å°„å·¥å…·</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">ModelMapper</span><span class="w"> </span><span class="n">modelMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">OrderDetailVO</span><span class="w"> </span><span class="nf">buildOrderDetailVO</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w">                                        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">Logistics</span><span class="w"> </span><span class="n">logistics</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w">    </span><span class="n">OrderDetailVO</span><span class="w"> </span><span class="n">vo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modelMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDetailVO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w">    </span><span class="n">vo</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">modelMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">UserVO</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="w">    </span><span class="n">vo</span><span class="p">.</span><span class="na">setProducts</span><span class="p">(</span><span class="n">products</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">modelMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">ProductVO</span><span class="p">.</span><span class="na">class</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="w">    </span><span class="n">vo</span><span class="p">.</span><span class="na">setLogistics</span><span class="p">(</span><span class="n">modelMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">logistics</span><span class="p">,</span><span class="w"> </span><span class="n">LogisticsVO</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">vo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="ä¼˜åŒ–8é¿å…ä¸å¿…è¦çš„è®¡ç®—">ä¼˜åŒ–8ï¼šé¿å…ä¸å¿…è¦çš„è®¡ç®—<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–8é¿å…ä¸å¿…è¦çš„è®¡ç®—">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// ä¼˜åŒ–å‰ï¼šæ¯æ¬¡éƒ½è®¡ç®—</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">calculateTotalAmount</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">OrderItem</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">itemAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getPrice</span><span class="p">().</span><span class="na">multiply</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">        </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">itemAmount</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1">// ä¼˜åŒ–åï¼šä½¿ç”¨æ•°æ®åº“è®¡ç®—å¥½çš„å­—æ®µ</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getTotalAmount</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">();</span><span class="w">  </span><span class="c1">// ä¸‹å•æ—¶å·²è®¡ç®—å¹¶å­˜å‚¨</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<h2 id="ç¬¬å…­æ­¥ç›‘æ§ä¸éªŒè¯">ç¬¬å…­æ­¥ï¼šç›‘æ§ä¸éªŒè¯<a hidden class="anchor" aria-hidden="true" href="#ç¬¬å…­æ­¥ç›‘æ§ä¸éªŒè¯">#</a></h2>
<h3 id="æ€§èƒ½æµ‹è¯•">æ€§èƒ½æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#æ€§èƒ½æµ‹è¯•">#</a></h3>
<p>ä½¿ç”¨JMeterè¿›è¡Œå‹æµ‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># å‹æµ‹é…ç½®</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">çº¿ç¨‹æ•°ï¼š100
</span></span><span class="line"><span class="ln">3</span><span class="cl">æŒç»­æ—¶é—´ï¼š5åˆ†é’Ÿ
</span></span></code></pre></div><p><strong>ä¼˜åŒ–å‰åå¯¹æ¯”</strong>ï¼š</p>
<table>
  <thead>
      <tr>
          <th>æŒ‡æ ‡</th>
          <th>ä¼˜åŒ–å‰</th>
          <th>ä¼˜åŒ–å</th>
          <th>æå‡</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>å¹³å‡å“åº”æ—¶é—´</td>
          <td>2800ms</td>
          <td>280ms</td>
          <td>90%</td>
      </tr>
      <tr>
          <td>P95å“åº”æ—¶é—´</td>
          <td>3500ms</td>
          <td>350ms</td>
          <td>90%</td>
      </tr>
      <tr>
          <td>P99å“åº”æ—¶é—´</td>
          <td>5000ms</td>
          <td>450ms</td>
          <td>91%</td>
      </tr>
      <tr>
          <td>QPS</td>
          <td>100</td>
          <td>500</td>
          <td>400%</td>
      </tr>
      <tr>
          <td>CPUä½¿ç”¨ç‡</td>
          <td>80%</td>
          <td>40%</td>
          <td>50%</td>
      </tr>
  </tbody>
</table>
<h3 id="ç›‘æ§å‘Šè­¦">ç›‘æ§å‘Šè­¦<a hidden class="anchor" aria-hidden="true" href="#ç›‘æ§å‘Šè­¦">#</a></h3>
<p>é…ç½®Prometheuså‘Šè­¦è§„åˆ™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">groups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">api_performance</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">      </span>- <span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l">HighResponseTime</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l">http_request_duration_seconds{quantile=&#34;0.99&#34;} &gt; 1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l">5m</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">        </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l">warning</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;APIå“åº”æ—¶é—´è¿‡é«˜&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{ $labels.api }} P99å“åº”æ—¶é—´è¶…è¿‡1ç§’&#34;</span><span class="w">
</span></span></span></code></pre></div><hr>
<h2 id="ä¼˜åŒ–æ€»ç»“">ä¼˜åŒ–æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–æ€»ç»“">#</a></h2>
<h3 id="ä¼˜åŒ–è·¯å¾„">ä¼˜åŒ–è·¯å¾„<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–è·¯å¾„">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln"> 1</span><span class="cl">åŸå§‹æ€§èƒ½ï¼š2800ms
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  â†“ æ‰¹é‡æŸ¥è¯¢ï¼ˆN+1é—®é¢˜ï¼‰
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">1. 600msï¼ˆä¼˜åŒ–78%ï¼‰
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  â†“ æ·»åŠ ç´¢å¼•
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">2. 555msï¼ˆä¼˜åŒ–7%ï¼‰
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  â†“ æŸ¥è¯¢å­—æ®µä¼˜åŒ–
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">3. 455msï¼ˆä¼˜åŒ–18%ï¼‰
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  â†“ Redisç¼“å­˜
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">4. 305msï¼ˆä¼˜åŒ–33%ï¼‰
</span></span><span class="line"><span class="ln">10</span><span class="cl">  â†“ æœ¬åœ°ç¼“å­˜
</span></span><span class="line"><span class="ln">11</span><span class="cl">5. 275msï¼ˆä¼˜åŒ–10%ï¼‰
</span></span><span class="line"><span class="ln">12</span><span class="cl">  â†“ å¹¶è¡ŒæŸ¥è¯¢
</span></span><span class="line"><span class="ln">13</span><span class="cl">6. 200msï¼ˆä¼˜åŒ–27%ï¼‰
</span></span><span class="line"><span class="ln">14</span><span class="cl">  â†“ ä»£ç ä¼˜åŒ–
</span></span><span class="line"><span class="ln">15</span><span class="cl">æœ€ç»ˆï¼š280msï¼ˆæ€»ä¼˜åŒ–90%ï¼‰
</span></span></code></pre></div><h3 id="ä¼˜åŒ–åŸåˆ™">ä¼˜åŒ–åŸåˆ™<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–åŸåˆ™">#</a></h3>
<ol>
<li><strong>å…ˆå®šä½ï¼Œåä¼˜åŒ–</strong>ï¼šé€šè¿‡ç›‘æ§æ‰¾åˆ°çœŸæ­£çš„ç“¶é¢ˆ</li>
<li><strong>æŠ“å¤§æ”¾å°</strong>ï¼šä¼˜å…ˆä¼˜åŒ–å æ¯”æœ€å¤§çš„éƒ¨åˆ†</li>
<li><strong>åˆ†å±‚ä¼˜åŒ–</strong>ï¼šæ•°æ®åº“ â†’ ç¼“å­˜ â†’ ä»£ç  â†’ æ¶æ„</li>
<li><strong>é‡åŒ–è¯„ä¼°</strong>ï¼šæ¯æ¬¡ä¼˜åŒ–éƒ½è¦æœ‰æ•°æ®æ”¯æ’‘</li>
<li><strong>æŒç»­ç›‘æ§</strong>ï¼šä¼˜åŒ–åè¦æŒç»­è§‚å¯Ÿæ•ˆæœ</li>
</ol>
<h3 id="å¸¸è§æ€§èƒ½ç“¶é¢ˆ">å¸¸è§æ€§èƒ½ç“¶é¢ˆ<a hidden class="anchor" aria-hidden="true" href="#å¸¸è§æ€§èƒ½ç“¶é¢ˆ">#</a></h3>
<table>
  <thead>
      <tr>
          <th>ç“¶é¢ˆç±»å‹</th>
          <th>å…¸å‹è¡¨ç°</th>
          <th>è§£å†³æ–¹æ¡ˆ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>æ•°æ®åº“æ…¢æŸ¥è¯¢</td>
          <td>å“åº”æ—¶é—´é•¿ï¼Œæ•°æ®åº“CPUé«˜</td>
          <td>ç´¢å¼•ä¼˜åŒ–ã€SQLä¼˜åŒ–ã€åˆ†åº“åˆ†è¡¨</td>
      </tr>
      <tr>
          <td>N+1æŸ¥è¯¢</td>
          <td>å¤§é‡é‡å¤æŸ¥è¯¢</td>
          <td>æ‰¹é‡æŸ¥è¯¢ã€JOINæŸ¥è¯¢</td>
      </tr>
      <tr>
          <td>ç¼“å­˜æœªå‘½ä¸­</td>
          <td>æ•°æ®åº“å‹åŠ›å¤§</td>
          <td>æ·»åŠ ç¼“å­˜ã€é¢„çƒ­ç¼“å­˜</td>
      </tr>
      <tr>
          <td>ä¸²è¡Œè°ƒç”¨</td>
          <td>å“åº”æ—¶é—´=å„æ­¥éª¤ä¹‹å’Œ</td>
          <td>å¹¶è¡Œè°ƒç”¨ã€å¼‚æ­¥å¤„ç†</td>
      </tr>
      <tr>
          <td>å¯¹è±¡åˆ›å»º</td>
          <td>GCé¢‘ç¹</td>
          <td>å¯¹è±¡å¤ç”¨ã€æ± åŒ–æŠ€æœ¯</td>
      </tr>
      <tr>
          <td>é”ç«äº‰</td>
          <td>å¹¶å‘æ€§èƒ½å·®</td>
          <td>å‡å°é”ç²’åº¦ã€æ— é”åŒ–</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="æ€§èƒ½ä¼˜åŒ–å·¥å…·ç®±">æ€§èƒ½ä¼˜åŒ–å·¥å…·ç®±<a hidden class="anchor" aria-hidden="true" href="#æ€§èƒ½ä¼˜åŒ–å·¥å…·ç®±">#</a></h2>
<h3 id="1-ç›‘æ§å·¥å…·">1. ç›‘æ§å·¥å…·<a hidden class="anchor" aria-hidden="true" href="#1-ç›‘æ§å·¥å…·">#</a></h3>
<p><strong>APMå·¥å…·</strong>ï¼š</p>
<ul>
<li>SkyWalkingï¼šåˆ†å¸ƒå¼è¿½è¸ª</li>
<li>Prometheus + Grafanaï¼šæŒ‡æ ‡ç›‘æ§</li>
<li>ELKï¼šæ—¥å¿—åˆ†æ</li>
</ul>
<p><strong>æ•°æ®åº“ç›‘æ§</strong>ï¼š</p>
<ul>
<li>MySQLæ…¢æŸ¥è¯¢æ—¥å¿—</li>
<li>Explainæ‰§è¡Œè®¡åˆ’</li>
<li>Performance Schema</li>
</ul>
<h3 id="2-åˆ†æå·¥å…·">2. åˆ†æå·¥å…·<a hidden class="anchor" aria-hidden="true" href="#2-åˆ†æå·¥å…·">#</a></h3>
<p><strong>JVMåˆ†æ</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># æŸ¥çœ‹GCæƒ…å†µ</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">jstat -gcutil &lt;pid&gt; <span class="m">1000</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"># ç”Ÿæˆå †è½¬å‚¨</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">jmap -dump:format<span class="o">=</span>b,file<span class="o">=</span>heap.hprof &lt;pid&gt;
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="c1"># çº¿ç¨‹åˆ†æ</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">jstack &lt;pid&gt; &gt; thread.txt
</span></span></code></pre></div><p><strong>ç«ç„°å›¾</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># ä½¿ç”¨async-profiler</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">./profiler.sh -d <span class="m">60</span> -f flamegraph.html &lt;pid&gt;
</span></span></code></pre></div><h3 id="3-å‹æµ‹å·¥å…·">3. å‹æµ‹å·¥å…·<a hidden class="anchor" aria-hidden="true" href="#3-å‹æµ‹å·¥å…·">#</a></h3>
<p><strong>JMeter</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">jmeter -n -t test-plan.jmx -l result.jtl -e -o report
</span></span></code></pre></div><p><strong>Gatling</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">setUp</span><span class="o">(</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">scn</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="n">rampUsersPerSec</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="n">to</span> <span class="mi">1000</span> <span class="n">during</span> <span class="o">(</span><span class="mi">5</span> <span class="n">minutes</span><span class="o">))</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="o">).</span><span class="n">protocols</span><span class="o">(</span><span class="n">httpProtocol</span><span class="o">)</span>
</span></span></code></pre></div><hr>
<h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ<a hidden class="anchor" aria-hidden="true" href="#æœ€ä½³å®è·µ">#</a></h2>
<h3 id="1-æ€§èƒ½ä¼˜åŒ–checklist">1. æ€§èƒ½ä¼˜åŒ–checklist<a hidden class="anchor" aria-hidden="true" href="#1-æ€§èƒ½ä¼˜åŒ–checklist">#</a></h3>
<ul>
<li><input disabled="" type="checkbox"> æ·»åŠ ç›‘æ§åŸ‹ç‚¹ï¼Œé‡åŒ–æ€§èƒ½æŒ‡æ ‡</li>
<li><input disabled="" type="checkbox"> åˆ†ææ…¢æŸ¥è¯¢ï¼Œä¼˜åŒ–SQLå’Œç´¢å¼•</li>
<li><input disabled="" type="checkbox"> è¯†åˆ«N+1æŸ¥è¯¢ï¼Œæ”¹ä¸ºæ‰¹é‡æŸ¥è¯¢</li>
<li><input disabled="" type="checkbox"> æ·»åŠ ç¼“å­˜ï¼Œæé«˜è¯»æ€§èƒ½</li>
<li><input disabled="" type="checkbox"> å¹¶è¡ŒåŒ–ç‹¬ç«‹æ“ä½œï¼Œå‡å°‘ç­‰å¾…æ—¶é—´</li>
<li><input disabled="" type="checkbox"> ä¼˜åŒ–ä»£ç é€»è¾‘ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—</li>
<li><input disabled="" type="checkbox"> å‹æµ‹éªŒè¯ï¼Œç¡®ä¿ä¼˜åŒ–æ•ˆæœ</li>
<li><input disabled="" type="checkbox"> æŒç»­ç›‘æ§ï¼Œé˜²æ­¢æ€§èƒ½é€€åŒ–</li>
</ul>
<h3 id="2-æ€§èƒ½ä¼˜åŒ–è¯¯åŒº">2. æ€§èƒ½ä¼˜åŒ–è¯¯åŒº<a hidden class="anchor" aria-hidden="true" href="#2-æ€§èƒ½ä¼˜åŒ–è¯¯åŒº">#</a></h3>
<p>âŒ <strong>è¿‡æ—©ä¼˜åŒ–</strong>ï¼šåœ¨æ²¡æœ‰æ€§èƒ½é—®é¢˜æ—¶å°±å¼€å§‹ä¼˜åŒ–
âœ… <strong>åŸºäºæ•°æ®ä¼˜åŒ–</strong>ï¼šå…ˆæµ‹é‡ï¼Œå†ä¼˜åŒ–</p>
<p>âŒ <strong>ç›²ç›®ä¼˜åŒ–</strong>ï¼šä¸çŸ¥é“ç“¶é¢ˆåœ¨å“ªå°±å¼€å§‹ä¼˜åŒ–
âœ… <strong>å®šä½ç“¶é¢ˆ</strong>ï¼šæ‰¾åˆ°çœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆ</p>
<p>âŒ <strong>å±€éƒ¨ä¼˜åŒ–</strong>ï¼šåªä¼˜åŒ–æŸä¸ªç‚¹
âœ… <strong>ç³»ç»Ÿä¼˜åŒ–</strong>ï¼šä»æ•´ä½“è§’åº¦ä¼˜åŒ–</p>
<p>âŒ <strong>å¿½ç•¥ç›‘æ§</strong>ï¼šä¼˜åŒ–åä¸ç›‘æ§æ•ˆæœ
âœ… <strong>æŒç»­ç›‘æ§</strong>ï¼šä¼˜åŒ–åæŒç»­è§‚å¯Ÿ</p>
<h3 id="3-æ€§èƒ½ä¼˜åŒ–æ€ç»´æ¨¡å‹">3. æ€§èƒ½ä¼˜åŒ–æ€ç»´æ¨¡å‹<a hidden class="anchor" aria-hidden="true" href="#3-æ€§èƒ½ä¼˜åŒ–æ€ç»´æ¨¡å‹">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln"> 1</span><span class="cl">å‘ç°é—®é¢˜
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  â†“
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">æ·»åŠ ç›‘æ§ï¼ˆé‡åŒ–é—®é¢˜ï¼‰
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  â†“
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">å®šä½ç“¶é¢ˆï¼ˆæ‰¾åˆ°æ ¹å› ï¼‰
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  â†“
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">åˆ¶å®šæ–¹æ¡ˆï¼ˆè¯„ä¼°æ”¶ç›Šï¼‰
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  â†“
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">å®æ–½ä¼˜åŒ–ï¼ˆå°æ­¥å¿«è·‘ï¼‰
</span></span><span class="line"><span class="ln">10</span><span class="cl">  â†“
</span></span><span class="line"><span class="ln">11</span><span class="cl">éªŒè¯æ•ˆæœï¼ˆå‹æµ‹éªŒè¯ï¼‰
</span></span><span class="line"><span class="ln">12</span><span class="cl">  â†“
</span></span><span class="line"><span class="ln">13</span><span class="cl">æŒç»­ç›‘æ§ï¼ˆé˜²æ­¢é€€åŒ–ï¼‰
</span></span></code></pre></div><blockquote>
<p><strong>é¿å‘æç¤ºï¼š</strong> æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§çš„å·¥ä½œã€‚è¦å»ºç«‹æ€§èƒ½ç›‘æ§ä½“ç³»ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³æ€§èƒ½é—®é¢˜ã€‚åŒæ—¶è¦æ³¨æ„ï¼Œè¿‡åº¦ä¼˜åŒ–å¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œè¦åœ¨æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚</p>
</blockquote>
<hr>
<h2 id="æ€»ç»“ä¸æ€è€ƒ">æ€»ç»“ä¸æ€è€ƒ<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“ä¸æ€è€ƒ">#</a></h2>
<p>æœ¬æ–‡é€šè¿‡ä¸€ä¸ªçœŸå®çš„æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹ï¼š</p>
<ul>
<li><strong>é—®é¢˜å®šä½</strong>ï¼šé€šè¿‡ç›‘æ§åŸ‹ç‚¹æ‰¾åˆ°ç“¶é¢ˆ</li>
<li><strong>æ•°æ®åº“ä¼˜åŒ–</strong>ï¼šæ‰¹é‡æŸ¥è¯¢ã€ç´¢å¼•ä¼˜åŒ–ã€å­—æ®µä¼˜åŒ–</li>
<li><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼šRedisç¼“å­˜ã€æœ¬åœ°ç¼“å­˜</li>
<li><strong>å¹¶å‘ä¼˜åŒ–</strong>ï¼šå¹¶è¡ŒæŸ¥è¯¢ã€å¼‚æ­¥å¤„ç†</li>
<li><strong>ä»£ç ä¼˜åŒ–</strong>ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºã€é¿å…é‡å¤è®¡ç®—</li>
<li><strong>ç›‘æ§éªŒè¯</strong>ï¼šå‹æµ‹éªŒè¯ã€æŒç»­ç›‘æ§</li>
</ul>
<p>æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯ï¼š</p>
<ol>
<li><strong>é‡åŒ–é—®é¢˜</strong>ï¼šç”¨æ•°æ®è¯´è¯</li>
<li><strong>å®šä½ç“¶é¢ˆ</strong>ï¼šæ‰¾åˆ°çœŸæ­£çš„é—®é¢˜</li>
<li><strong>ç³»ç»Ÿä¼˜åŒ–</strong>ï¼šä»æ•´ä½“è§’åº¦æ€è€ƒ</li>
<li><strong>æŒç»­æ”¹è¿›</strong>ï¼šå»ºç«‹é•¿æ•ˆæœºåˆ¶</li>
</ol>
<p>ä¸‹æ¬¡å½“ä½ é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶ï¼Œä¸å¦¨æŒ‰ç…§æœ¬æ–‡çš„æ€è·¯ï¼Œç³»ç»Ÿæ€§åœ°åˆ†æå’Œä¼˜åŒ–ã€‚è®°ä½ï¼Œæ€§èƒ½ä¼˜åŒ–ä¸æ˜¯é“¶å¼¹ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒç»­æ”¹è¿›çš„è¿‡ç¨‹ã€‚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">æ€§èƒ½ä¼˜åŒ–</a></li>
      <li><a href="http://localhost:1313/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">é—®é¢˜æ’æŸ¥</a></li>
      <li><a href="http://localhost:1313/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">æœ€ä½³å®è·µ</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/2026/02/%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E4%BB%A5-spring-boot-%E4%B8%BA%E4%BE%8B/">
    <span class="title">Â« Prev</span>
    <br>
    <span>å¦‚ä½•é˜…è¯»å¼€æºé¡¹ç›®æºç ï¼šä»¥ Spring Boot ä¸ºä¾‹</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/2026/02/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0/">
    <span class="title">Next Â»</span>
    <br>
    <span>æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« </span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—… on x"
            href="https://x.com/intent/tweet/?text=%e6%8e%a5%e5%8f%a3%e5%93%8d%e5%ba%94%e6%85%a2%ef%bc%9f%e4%b8%80%e6%ac%a1%e5%ae%8c%e6%95%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e4%b9%8b%e6%97%85&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2026%2f02%2f%25E6%258E%25A5%25E5%258F%25A3%25E5%2593%258D%25E5%25BA%2594%25E6%2585%25A2%25E4%25B8%2580%25E6%25AC%25A1%25E5%25AE%258C%25E6%2595%25B4%25E7%259A%2584%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E4%25B9%258B%25E6%2597%2585%2f&amp;hashtags=%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%2c%e9%97%ae%e9%a2%98%e6%8e%92%e6%9f%a5%2c%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—… on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2026%2f02%2f%25E6%258E%25A5%25E5%258F%25A3%25E5%2593%258D%25E5%25BA%2594%25E6%2585%25A2%25E4%25B8%2580%25E6%25AC%25A1%25E5%25AE%258C%25E6%2595%25B4%25E7%259A%2584%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E4%25B9%258B%25E6%2597%2585%2f&amp;title=%e6%8e%a5%e5%8f%a3%e5%93%8d%e5%ba%94%e6%85%a2%ef%bc%9f%e4%b8%80%e6%ac%a1%e5%ae%8c%e6%95%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e4%b9%8b%e6%97%85&amp;summary=%e6%8e%a5%e5%8f%a3%e5%93%8d%e5%ba%94%e6%85%a2%ef%bc%9f%e4%b8%80%e6%ac%a1%e5%ae%8c%e6%95%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e4%b9%8b%e6%97%85&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2f2026%2f02%2f%25E6%258E%25A5%25E5%258F%25A3%25E5%2593%258D%25E5%25BA%2594%25E6%2585%25A2%25E4%25B8%2580%25E6%25AC%25A1%25E5%25AE%258C%25E6%2595%25B4%25E7%259A%2584%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E4%25B9%258B%25E6%2597%2585%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—… on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2026%2f02%2f%25E6%258E%25A5%25E5%258F%25A3%25E5%2593%258D%25E5%25BA%2594%25E6%2585%25A2%25E4%25B8%2580%25E6%25AC%25A1%25E5%25AE%258C%25E6%2595%25B4%25E7%259A%2584%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E4%25B9%258B%25E6%2597%2585%2f&title=%e6%8e%a5%e5%8f%a3%e5%93%8d%e5%ba%94%e6%85%a2%ef%bc%9f%e4%b8%80%e6%ac%a1%e5%ae%8c%e6%95%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e4%b9%8b%e6%97%85">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—… on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2026%2f02%2f%25E6%258E%25A5%25E5%258F%25A3%25E5%2593%258D%25E5%25BA%2594%25E6%2585%25A2%25E4%25B8%2580%25E6%25AC%25A1%25E5%25AE%258C%25E6%2595%25B4%25E7%259A%2584%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E4%25B9%258B%25E6%2597%2585%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—… on whatsapp"
            href="https://api.whatsapp.com/send?text=%e6%8e%a5%e5%8f%a3%e5%93%8d%e5%ba%94%e6%85%a2%ef%bc%9f%e4%b8%80%e6%ac%a1%e5%ae%8c%e6%95%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e4%b9%8b%e6%97%85%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2f2026%2f02%2f%25E6%258E%25A5%25E5%258F%25A3%25E5%2593%258D%25E5%25BA%2594%25E6%2585%25A2%25E4%25B8%2580%25E6%25AC%25A1%25E5%25AE%258C%25E6%2595%25B4%25E7%259A%2584%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E4%25B9%258B%25E6%2597%2585%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—… on telegram"
            href="https://telegram.me/share/url?text=%e6%8e%a5%e5%8f%a3%e5%93%8d%e5%ba%94%e6%85%a2%ef%bc%9f%e4%b8%80%e6%ac%a1%e5%ae%8c%e6%95%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e4%b9%8b%e6%97%85&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2026%2f02%2f%25E6%258E%25A5%25E5%258F%25A3%25E5%2593%258D%25E5%25BA%2594%25E6%2585%25A2%25E4%25B8%2580%25E6%25AC%25A1%25E5%25AE%258C%25E6%2595%25B4%25E7%259A%2584%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E4%25B9%258B%25E6%2597%2585%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share æ¥å£å“åº”æ…¢ï¼Ÿä¸€æ¬¡å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—… on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e6%8e%a5%e5%8f%a3%e5%93%8d%e5%ba%94%e6%85%a2%ef%bc%9f%e4%b8%80%e6%ac%a1%e5%ae%8c%e6%95%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e4%b9%8b%e6%97%85&u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2026%2f02%2f%25E6%258E%25A5%25E5%258F%25A3%25E5%2593%258D%25E5%25BA%2594%25E6%2585%25A2%25E4%25B8%2580%25E6%25AC%25A1%25E5%25AE%258C%25E6%2595%25B4%25E7%259A%2584%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E4%25B9%258B%25E6%2597%2585%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">åšå®¢å–µ</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
