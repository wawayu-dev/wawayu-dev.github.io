<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å— | åšå®¢å–µ</title>
<meta name="keywords" content="Java, å¼‚æ­¥ç¼–ç¨‹, CompletableFuture, å¹¶å‘">
<meta name="description" content="æŒæ¡ Java 8 å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒå·¥å…·ï¼Œä»é“¾å¼è°ƒç”¨åˆ°å¼‚å¸¸å¤„ç†çš„å®Œæ•´å®è·µ">
<meta name="author" content="å–µå–µå–µ">
<link rel="canonical" href="http://localhost:1313/posts/completablefuture-async-programming/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a29c24210eb31d9ce56f669c66a35c9c51b17376b7764e336a49af7dec914cf0.css" integrity="sha256-opwkIQ6zHZzlb2acZqNcnFGxc3a3dk4zakmvfeyRTPA=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/completablefuture-async-programming/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/posts/completablefuture-async-programming/">
  <meta property="og:site_name" content="åšå®¢å–µ">
  <meta property="og:title" content="CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å—">
  <meta property="og:description" content="æŒæ¡ Java 8 å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒå·¥å…·ï¼Œä»é“¾å¼è°ƒç”¨åˆ°å¼‚å¸¸å¤„ç†çš„å®Œæ•´å®è·µ">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-03-25T00:00:00+00:00">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="å¼‚æ­¥ç¼–ç¨‹">
    <meta property="article:tag" content="CompletableFuture">
    <meta property="article:tag" content="å¹¶å‘">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å—">
<meta name="twitter:description" content="æŒæ¡ Java 8 å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒå·¥å…·ï¼Œä»é“¾å¼è°ƒç”¨åˆ°å¼‚å¸¸å¤„ç†çš„å®Œæ•´å®è·µ">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å—",
      "item": "http://localhost:1313/posts/completablefuture-async-programming/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å—",
  "name": "CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å—",
  "description": "æŒæ¡ Java 8 å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒå·¥å…·ï¼Œä»é“¾å¼è°ƒç”¨åˆ°å¼‚å¸¸å¤„ç†çš„å®Œæ•´å®è·µ",
  "keywords": [
    "Java", "å¼‚æ­¥ç¼–ç¨‹", "CompletableFuture", "å¹¶å‘"
  ],
  "articleBody": "åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªæ¥å£å¾€å¾€éœ€è¦è°ƒç”¨å¤šä¸ªä¸‹æ¸¸æœåŠ¡ã€‚å¦‚æœä¸²è¡Œè°ƒç”¨ï¼Œå“åº”æ—¶é—´ä¼šç´¯åŠ ï¼›å¦‚æœç”¨ä¼ ç»Ÿçš„ Futureï¼Œä»£ç ä¼šå˜å¾—å¤æ‚éš¾ç»´æŠ¤ã€‚CompletableFuture æä¾›äº†ä¼˜é›…çš„å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆã€‚\næœ¬æ–‡äº®ç‚¹ æŒæ¡ CompletableFuture çš„é“¾å¼è°ƒç”¨ä¸ç»„åˆæ“ä½œ å­¦ä¼šå¼‚å¸¸å¤„ç†ä¸è¶…æ—¶æ§åˆ¶ ç†è§£ä¸çº¿ç¨‹æ± çš„é…åˆä½¿ç”¨ äº†è§£å¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µ ä¼ ç»Ÿ Future çš„ç—›ç‚¹ JDK 1.5 å¼•å…¥çš„ Future æ¥å£åªèƒ½é€šè¿‡ get() æ–¹æ³•é˜»å¡ç­‰å¾…ç»“æœï¼š\n1 2 3 4 5 6 7 8 9 ExecutorService executor = Executors.newFixedThreadPool(10); Future\u003cString\u003e future = executor.submit(() -\u003e { Thread.sleep(1000); return \"Hello\"; }); // é˜»å¡ç­‰å¾…ç»“æœ String result = future.get(); é—®é¢˜ï¼š\nget() ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ— æ³•å¼‚æ­¥å¤„ç†ç»“æœ æ— æ³•ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡ å¼‚å¸¸å¤„ç†ä¸æ–¹ä¾¿ CompletableFuture è§£å†³äº†è¿™äº›é—®é¢˜ã€‚\nCompletableFuture åŸºç¡€ç”¨æ³• åˆ›å»º CompletableFuture\n1 2 3 4 5 6 7 8 9 10 11 12 13 // æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å®Œæˆ CompletableFuture\u003cString\u003e future = new CompletableFuture\u003c\u003e(); future.complete(\"Hello\"); // æ–¹å¼äºŒï¼šå¼‚æ­¥æ‰§è¡Œ CompletableFuture\u003cString\u003e future = CompletableFuture.supplyAsync(() -\u003e { return \"Hello\"; }); // æ–¹å¼ä¸‰ï¼šæ— è¿”å›å€¼çš„å¼‚æ­¥æ‰§è¡Œ CompletableFuture\u003cVoid\u003e future = CompletableFuture.runAsync(() -\u003e { System.out.println(\"Hello\"); }); è·å–ç»“æœ\n1 2 3 4 5 6 7 8 9 10 11 // é˜»å¡ç­‰å¾…ï¼ˆä¸æ¨èï¼‰ String result = future.get(); // é˜»å¡ç­‰å¾…ï¼Œå¸¦è¶…æ—¶ String result = future.get(1, TimeUnit.SECONDS); // éé˜»å¡è·å–ï¼Œå¦‚æœæœªå®Œæˆè¿”å›é»˜è®¤å€¼ String result = future.getNow(\"default\"); // é˜»å¡ç­‰å¾…ï¼Œä¸æŠ›å‡ºå—æ£€å¼‚å¸¸ String result = future.join(); é“¾å¼è°ƒç”¨ï¼šä¼˜é›…çš„å¼‚æ­¥æµæ°´çº¿ thenApplyï¼šè½¬æ¢ç»“æœ\n1 2 3 4 5 6 7 8 9 CompletableFuture\u003cString\u003e future = CompletableFuture.supplyAsync(() -\u003e { return \"Hello\"; }).thenApply(s -\u003e { return s + \" World\"; }).thenApply(s -\u003e { return s.toUpperCase(); }); System.out.println(future.join()); // HELLO WORLD thenAcceptï¼šæ¶ˆè´¹ç»“æœ\n1 2 3 4 5 CompletableFuture.supplyAsync(() -\u003e { return \"Hello\"; }).thenAccept(s -\u003e { System.out.println(s); // ä¸è¿”å›ç»“æœ }); thenRunï¼šæ‰§è¡Œåç»­æ“ä½œ\n1 2 3 4 5 CompletableFuture.supplyAsync(() -\u003e { return \"Hello\"; }).thenRun(() -\u003e { System.out.println(\"Done\"); // ä¸å…³å¿ƒå‰é¢çš„ç»“æœ }); thenComposeï¼šæ‰å¹³åŒ–åµŒå¥—çš„ CompletableFuture\n1 2 3 4 5 6 7 8 9 10 11 12 CompletableFuture\u003cString\u003e future = CompletableFuture.supplyAsync(() -\u003e { return \"user123\"; }).thenCompose(userId -\u003e { // æ ¹æ® userId æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆè¿”å› CompletableFutureï¼‰ return getUserInfo(userId); }); CompletableFuture\u003cUser\u003e getUserInfo(String userId) { return CompletableFuture.supplyAsync(() -\u003e { return userMapper.selectById(userId); }); } æ¶æ„æ€è€ƒï¼š thenApply å’Œ thenCompose çš„åŒºåˆ«ç±»ä¼¼äº Stream çš„ map å’Œ flatMapã€‚thenApply ç”¨äºç®€å•çš„è½¬æ¢ï¼ŒthenCompose ç”¨äºæ‰å¹³åŒ–åµŒå¥—çš„å¼‚æ­¥æ“ä½œã€‚\nç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡ thenCombineï¼šåˆå¹¶ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœ\n1 2 3 4 5 6 7 8 9 10 11 12 13 CompletableFuture\u003cString\u003e future1 = CompletableFuture.supplyAsync(() -\u003e { return \"Hello\"; }); CompletableFuture\u003cString\u003e future2 = CompletableFuture.supplyAsync(() -\u003e { return \"World\"; }); CompletableFuture\u003cString\u003e result = future1.thenCombine(future2, (s1, s2) -\u003e { return s1 + \" \" + s2; }); System.out.println(result.join()); // Hello World allOfï¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ\n1 2 3 4 5 6 7 8 9 10 11 12 13 CompletableFuture\u003cString\u003e future1 = CompletableFuture.supplyAsync(() -\u003e \"Task1\"); CompletableFuture\u003cString\u003e future2 = CompletableFuture.supplyAsync(() -\u003e \"Task2\"); CompletableFuture\u003cString\u003e future3 = CompletableFuture.supplyAsync(() -\u003e \"Task3\"); CompletableFuture\u003cVoid\u003e allFutures = CompletableFuture.allOf(future1, future2, future3); // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ allFutures.join(); // è·å–æ‰€æœ‰ç»“æœ List\u003cString\u003e results = Stream.of(future1, future2, future3) .map(CompletableFuture::join) .collect(Collectors.toList()); anyOfï¼šç­‰å¾…ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆ\n1 2 3 4 5 6 7 8 9 10 11 12 13 CompletableFuture\u003cString\u003e future1 = CompletableFuture.supplyAsync(() -\u003e { Thread.sleep(1000); return \"Task1\"; }); CompletableFuture\u003cString\u003e future2 = CompletableFuture.supplyAsync(() -\u003e { Thread.sleep(500); return \"Task2\"; }); CompletableFuture\u003cObject\u003e anyFuture = CompletableFuture.anyOf(future1, future2); System.out.println(anyFuture.join()); // Task2ï¼ˆå…ˆå®Œæˆçš„ï¼‰ å®æˆ˜æ¡ˆä¾‹ï¼šå¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡ å‡è®¾ä¸€ä¸ªå•†å“è¯¦æƒ…é¡µéœ€è¦è°ƒç”¨ä¸‰ä¸ªæœåŠ¡ï¼š\nå•†å“æœåŠ¡ï¼šæŸ¥è¯¢å•†å“ä¿¡æ¯ åº“å­˜æœåŠ¡ï¼šæŸ¥è¯¢åº“å­˜ è¯„è®ºæœåŠ¡ï¼šæŸ¥è¯¢è¯„è®º ä¸²è¡Œè°ƒç”¨ï¼ˆæ…¢ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 public ProductDetailDTO getProductDetail(Long productId) { Product product = productService.getProduct(productId); // 100ms Stock stock = stockService.getStock(productId); // 100ms List\u003cComment\u003e comments = commentService.getComments(productId); // 100ms return ProductDetailDTO.builder() .product(product) .stock(stock) .comments(comments) .build(); } // æ€»è€—æ—¶ï¼š300ms å¹¶è¡Œè°ƒç”¨ï¼ˆå¿«ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public ProductDetailDTO getProductDetail(Long productId) { CompletableFuture\u003cProduct\u003e productFuture = CompletableFuture.supplyAsync(() -\u003e productService.getProduct(productId) ); CompletableFuture\u003cStock\u003e stockFuture = CompletableFuture.supplyAsync(() -\u003e stockService.getStock(productId) ); CompletableFuture\u003cList\u003cComment\u003e\u003e commentsFuture = CompletableFuture.supplyAsync(() -\u003e commentService.getComments(productId) ); // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ CompletableFuture.allOf(productFuture, stockFuture, commentsFuture).join(); return ProductDetailDTO.builder() .product(productFuture.join()) .stock(stockFuture.join()) .comments(commentsFuture.join()) .build(); } // æ€»è€—æ—¶ï¼š100msï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰ æ€§èƒ½æå‡ï¼šä» 300ms é™ä½åˆ° 100msã€‚\nå¼‚å¸¸å¤„ç† exceptionallyï¼šæ•è·å¼‚å¸¸å¹¶è¿”å›é»˜è®¤å€¼\n1 2 3 4 5 6 7 8 9 CompletableFuture\u003cString\u003e future = CompletableFuture.supplyAsync(() -\u003e { if (Math.random() \u003e 0.5) { throw new RuntimeException(\"Error\"); } return \"Success\"; }).exceptionally(ex -\u003e { log.error(\"å¼‚å¸¸: {}\", ex.getMessage()); return \"Default\"; }); handleï¼šåŒæ—¶å¤„ç†æ­£å¸¸ç»“æœå’Œå¼‚å¸¸\n1 2 3 4 5 6 7 8 9 10 11 12 CompletableFuture\u003cString\u003e future = CompletableFuture.supplyAsync(() -\u003e { if (Math.random() \u003e 0.5) { throw new RuntimeException(\"Error\"); } return \"Success\"; }).handle((result, ex) -\u003e { if (ex != null) { log.error(\"å¼‚å¸¸: {}\", ex.getMessage()); return \"Default\"; } return result; }); whenCompleteï¼šä¸æ”¹å˜ç»“æœï¼Œåªåšå‰¯ä½œç”¨æ“ä½œ\n1 2 3 4 5 6 7 8 9 CompletableFuture\u003cString\u003e future = CompletableFuture.supplyAsync(() -\u003e { return \"Success\"; }).whenComplete((result, ex) -\u003e { if (ex != null) { log.error(\"å¼‚å¸¸: {}\", ex.getMessage()); } else { log.info(\"ç»“æœ: {}\", result); } }); é¿å‘æç¤ºï¼š exceptionally å’Œ handle ä¼šæ”¹å˜ CompletableFuture çš„ç»“æœï¼Œè€Œ whenComplete ä¸ä¼šã€‚é€‰æ‹©å“ªä¸ªå–å†³äºä½ æ˜¯å¦éœ€è¦æ”¹å˜ç»“æœã€‚\nè¶…æ—¶æ§åˆ¶ JDK 9 å¼•å…¥äº†è¶…æ—¶æ§åˆ¶æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 CompletableFuture\u003cString\u003e future = CompletableFuture.supplyAsync(() -\u003e { Thread.sleep(2000); return \"Success\"; }).orTimeout(1, TimeUnit.SECONDS) // è¶…æ—¶æŠ›å‡º TimeoutException .exceptionally(ex -\u003e { return \"Timeout\"; }); JDK 8 å¯ä»¥é€šè¿‡ CompletableFuture.anyOf å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 CompletableFuture\u003cString\u003e taskFuture = CompletableFuture.supplyAsync(() -\u003e { Thread.sleep(2000); return \"Success\"; }); CompletableFuture\u003cString\u003e timeoutFuture = new CompletableFuture\u003c\u003e(); scheduler.schedule(() -\u003e { timeoutFuture.completeExceptionally(new TimeoutException()); }, 1, TimeUnit.SECONDS); CompletableFuture\u003cString\u003e result = (CompletableFuture\u003cString\u003e) CompletableFuture.anyOf( taskFuture, timeoutFuture ); ä¸çº¿ç¨‹æ± çš„é…åˆ é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompletableFuture ä½¿ç”¨ ForkJoinPool.commonPool()ï¼Œçº¿ç¨‹æ•°ç­‰äº CPU æ ¸å¿ƒæ•°ã€‚\nå¯¹äº IO å¯†é›†å‹ä»»åŠ¡ï¼Œåº”è¯¥ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼š\n1 2 3 4 5 6 ExecutorService executor = Executors.newFixedThreadPool(20); CompletableFuture\u003cString\u003e future = CompletableFuture.supplyAsync(() -\u003e { // IO å¯†é›†å‹ä»»åŠ¡ return httpClient.get(url); }, executor); æ³¨æ„äº‹é¡¹\nä¸åŒç±»å‹çš„ä»»åŠ¡ä½¿ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼ˆCPU å¯†é›†å‹ vs IO å¯†é›†å‹ï¼‰ çº¿ç¨‹æ± è¦åˆç†é…ç½®å¤§å°ï¼Œé¿å…èµ„æºè€—å°½ åº”ç”¨å…³é—­æ—¶è¦ä¼˜é›…åœ°å…³é—­çº¿ç¨‹æ±  1 2 3 4 5 6 7 8 9 10 11 @PreDestroy public void shutdown() { executor.shutdown(); try { if (!executor.awaitTermination(60, TimeUnit.SECONDS)) { executor.shutdownNow(); } } catch (InterruptedException e) { executor.shutdownNow(); } } æœ€ä½³å®è·µ 1. é¿å…é˜»å¡æ“ä½œ\nä¸è¦åœ¨ CompletableFuture çš„å›è°ƒä¸­æ‰§è¡Œé˜»å¡æ“ä½œï¼Œä¼šå ç”¨çº¿ç¨‹æ± èµ„æºã€‚\n1 2 3 4 5 6 7 8 9 10 // ä¸å¥½ï¼šé˜»å¡æ“ä½œ CompletableFuture.supplyAsync(() -\u003e { Thread.sleep(1000); // é˜»å¡çº¿ç¨‹ return \"Result\"; }); // å¥½ï¼šä½¿ç”¨å¼‚æ­¥ API CompletableFuture.supplyAsync(() -\u003e { return asyncHttpClient.get(url).join(); }); 2. åˆç†è®¾ç½®è¶…æ—¶\né¿å…ä»»åŠ¡æ— é™ç­‰å¾…ï¼Œå¯¼è‡´èµ„æºæ³„æ¼ã€‚\n3. å¼‚å¸¸å¤„ç†è¦å®Œå–„\nç¡®ä¿æ¯ä¸ª CompletableFuture éƒ½æœ‰å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œé¿å…å¼‚å¸¸è¢«åæ‰ã€‚\n4. é¿å…è¿‡åº¦å¹¶è¡Œ\nå¹¶è¡Œä»»åŠ¡æ•°ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¦æ ¹æ®ç³»ç»Ÿèµ„æºå’Œä¸‹æ¸¸æœåŠ¡çš„æ‰¿è½½èƒ½åŠ›è°ƒæ•´ã€‚\næ€»ç»“ä¸æ€è€ƒ CompletableFuture æ˜¯ Java å¼‚æ­¥ç¼–ç¨‹çš„åˆ©å™¨ï¼Œå®ƒæä¾›äº†ï¼š\né“¾å¼è°ƒç”¨ï¼šä¼˜é›…çš„å¼‚æ­¥æµæ°´çº¿ ç»„åˆæ“ä½œï¼šçµæ´»çš„ä»»åŠ¡ç¼–æ’ å¼‚å¸¸å¤„ç†ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ çº¿ç¨‹æ± é›†æˆï¼šé«˜æ•ˆçš„èµ„æºåˆ©ç”¨ æŒæ¡ CompletableFutureï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å’Œä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚\nä¸‹æ¬¡å½“ä½ éœ€è¦å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡æ—¶ï¼Œä¸å¦¨è¯•è¯• CompletableFutureï¼Œä½“éªŒå¼‚æ­¥ç¼–ç¨‹çš„é­…åŠ›ã€‚\n",
  "wordCount" : "878",
  "inLanguage": "en",
  "datePublished": "2024-03-25T00:00:00Z",
  "dateModified": "2024-03-25T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "å–µå–µå–µ"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/completablefuture-async-programming/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "åšå®¢å–µ",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="åšå®¢å–µ (Alt + H)">åšå®¢å–µ</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/projects/" title="ğŸš€ é¡¹ç›®">
                    <span>ğŸš€ é¡¹ç›®</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="ğŸ“ æ–‡ç« ">
                    <span>ğŸ“ æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/skills/" title="ğŸ’» æŠ€èƒ½">
                    <span>ğŸ’» æŠ€èƒ½</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="ğŸ·ï¸ æ ‡ç­¾">
                    <span>ğŸ·ï¸ æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="ğŸ‘¤ å…³äºæˆ‘">
                    <span>ğŸ‘¤ å…³äºæˆ‘</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;Â»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å—
    </h1>
    <div class="post-description">
      æŒæ¡ Java 8 å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒå·¥å…·ï¼Œä»é“¾å¼è°ƒç”¨åˆ°å¼‚å¸¸å¤„ç†çš„å®Œæ•´å®è·µ
    </div>
    <div class="post-meta"><span title='2024-03-25 00:00:00 +0000 UTC'>March 25, 2024</span>&nbsp;Â·&nbsp;<span>5 min</span>&nbsp;Â·&nbsp;<span>878 words</span>&nbsp;Â·&nbsp;<span>å–µå–µå–µ</span>&nbsp;|&nbsp;<span>
    <a href="https://github.com/wawayu-dev/wawayu-dev.github.io/tree/main/content/posts/completablefuture-async-programming.md" rel="noopener noreferrer edit" target="_blank">å»ºè®®ä¿®æ”¹</a>
</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#æœ¬æ–‡äº®ç‚¹">æœ¬æ–‡äº®ç‚¹</a></li>
      </ul>
    </li>
    <li><a href="#ä¼ ç»Ÿ-future-çš„ç—›ç‚¹">ä¼ ç»Ÿ Future çš„ç—›ç‚¹</a></li>
    <li><a href="#completablefuture-åŸºç¡€ç”¨æ³•">CompletableFuture åŸºç¡€ç”¨æ³•</a></li>
    <li><a href="#é“¾å¼è°ƒç”¨ä¼˜é›…çš„å¼‚æ­¥æµæ°´çº¿">é“¾å¼è°ƒç”¨ï¼šä¼˜é›…çš„å¼‚æ­¥æµæ°´çº¿</a></li>
    <li><a href="#ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡">ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡</a></li>
    <li><a href="#å®æˆ˜æ¡ˆä¾‹å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡">å®æˆ˜æ¡ˆä¾‹ï¼šå¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡</a></li>
    <li><a href="#å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</a></li>
    <li><a href="#è¶…æ—¶æ§åˆ¶">è¶…æ—¶æ§åˆ¶</a></li>
    <li><a href="#ä¸çº¿ç¨‹æ± çš„é…åˆ">ä¸çº¿ç¨‹æ± çš„é…åˆ</a></li>
    <li><a href="#æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</a></li>
    <li><a href="#æ€»ç»“ä¸æ€è€ƒ">æ€»ç»“ä¸æ€è€ƒ</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªæ¥å£å¾€å¾€éœ€è¦è°ƒç”¨å¤šä¸ªä¸‹æ¸¸æœåŠ¡ã€‚å¦‚æœä¸²è¡Œè°ƒç”¨ï¼Œå“åº”æ—¶é—´ä¼šç´¯åŠ ï¼›å¦‚æœç”¨ä¼ ç»Ÿçš„ Futureï¼Œä»£ç ä¼šå˜å¾—å¤æ‚éš¾ç»´æŠ¤ã€‚CompletableFuture æä¾›äº†ä¼˜é›…çš„å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆã€‚</p>
<h3 id="æœ¬æ–‡äº®ç‚¹">æœ¬æ–‡äº®ç‚¹<a hidden class="anchor" aria-hidden="true" href="#æœ¬æ–‡äº®ç‚¹">#</a></h3>
<ul>
<li><input checked="" disabled="" type="checkbox"> æŒæ¡ CompletableFuture çš„é“¾å¼è°ƒç”¨ä¸ç»„åˆæ“ä½œ</li>
<li><input checked="" disabled="" type="checkbox"> å­¦ä¼šå¼‚å¸¸å¤„ç†ä¸è¶…æ—¶æ§åˆ¶</li>
<li><input checked="" disabled="" type="checkbox"> ç†è§£ä¸çº¿ç¨‹æ± çš„é…åˆä½¿ç”¨</li>
<li><input checked="" disabled="" type="checkbox"> äº†è§£å¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µ</li>
</ul>
<hr>
<h2 id="ä¼ ç»Ÿ-future-çš„ç—›ç‚¹">ä¼ ç»Ÿ Future çš„ç—›ç‚¹<a hidden class="anchor" aria-hidden="true" href="#ä¼ ç»Ÿ-future-çš„ç—›ç‚¹">#</a></h2>
<p>JDK 1.5 å¼•å…¥çš„ Future æ¥å£åªèƒ½é€šè¿‡ get() æ–¹æ³•é˜»å¡ç­‰å¾…ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="n">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="na">submit</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">1000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// é˜»å¡ç­‰å¾…ç»“æœ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é—®é¢˜ï¼š</p>
<ol>
<li>get() ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ— æ³•å¼‚æ­¥å¤„ç†ç»“æœ</li>
<li>æ— æ³•ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡</li>
<li>å¼‚å¸¸å¤„ç†ä¸æ–¹ä¾¿</li>
</ol>
<p>CompletableFuture è§£å†³äº†è¿™äº›é—®é¢˜ã€‚</p>
<hr>
<h2 id="completablefuture-åŸºç¡€ç”¨æ³•">CompletableFuture åŸºç¡€ç”¨æ³•<a hidden class="anchor" aria-hidden="true" href="#completablefuture-åŸºç¡€ç”¨æ³•">#</a></h2>
<p><strong>åˆ›å»º CompletableFuture</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å®Œæˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">future</span><span class="p">.</span><span class="na">complete</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// æ–¹å¼äºŒï¼šå¼‚æ­¥æ‰§è¡Œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// æ–¹å¼ä¸‰ï¼šæ— è¿”å›å€¼çš„å¼‚æ­¥æ‰§è¡Œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">runAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è·å–ç»“æœ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// é˜»å¡ç­‰å¾…ï¼ˆä¸æ¨èï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// é˜»å¡ç­‰å¾…ï¼Œå¸¦è¶…æ—¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// éé˜»å¡è·å–ï¼Œå¦‚æœæœªå®Œæˆè¿”å›é»˜è®¤å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span><span class="p">.</span><span class="na">getNow</span><span class="p">(</span><span class="s">&#34;default&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// é˜»å¡ç­‰å¾…ï¼Œä¸æŠ›å‡ºå—æ£€å¼‚å¸¸</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span><span class="p">.</span><span class="na">join</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="é“¾å¼è°ƒç”¨ä¼˜é›…çš„å¼‚æ­¥æµæ°´çº¿">é“¾å¼è°ƒç”¨ï¼šä¼˜é›…çš„å¼‚æ­¥æµæ°´çº¿<a hidden class="anchor" aria-hidden="true" href="#é“¾å¼è°ƒç”¨ä¼˜é›…çš„å¼‚æ­¥æµæ°´çº¿">#</a></h2>
<p><strong>thenApplyï¼šè½¬æ¢ç»“æœ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="na">thenApply</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; World&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="na">thenApply</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">future</span><span class="p">.</span><span class="na">join</span><span class="p">());</span><span class="w">  </span><span class="c1">// HELLO WORLD</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>thenAcceptï¼šæ¶ˆè´¹ç»“æœ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="na">thenAccept</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">  </span><span class="c1">// ä¸è¿”å›ç»“æœ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>thenRunï¼šæ‰§è¡Œåç»­æ“ä½œ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="na">thenRun</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Done&#34;</span><span class="p">);</span><span class="w">  </span><span class="c1">// ä¸å…³å¿ƒå‰é¢çš„ç»“æœ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>thenComposeï¼šæ‰å¹³åŒ–åµŒå¥—çš„ CompletableFuture</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;user123&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="na">thenCompose</span><span class="p">(</span><span class="n">userId</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// æ ¹æ® userId æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆè¿”å› CompletableFutureï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">getUserInfo</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getUserInfo</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userMapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>æ¶æ„æ€è€ƒï¼š</strong> thenApply å’Œ thenCompose çš„åŒºåˆ«ç±»ä¼¼äº Stream çš„ map å’Œ flatMapã€‚thenApply ç”¨äºç®€å•çš„è½¬æ¢ï¼ŒthenCompose ç”¨äºæ‰å¹³åŒ–åµŒå¥—çš„å¼‚æ­¥æ“ä½œã€‚</p>
</blockquote>
<hr>
<h2 id="ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡">ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡<a hidden class="anchor" aria-hidden="true" href="#ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡">#</a></h2>
<p><strong>thenCombineï¼šåˆå¹¶ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;World&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future1</span><span class="p">.</span><span class="na">thenCombine</span><span class="p">(</span><span class="n">future2</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">join</span><span class="p">());</span><span class="w">  </span><span class="c1">// Hello World</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>allOfï¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&#34;Task1&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&#34;Task2&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&#34;Task3&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">allFutures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">allOf</span><span class="p">(</span><span class="n">future1</span><span class="p">,</span><span class="w"> </span><span class="n">future2</span><span class="p">,</span><span class="w"> </span><span class="n">future3</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">allFutures</span><span class="p">.</span><span class="na">join</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// è·å–æ‰€æœ‰ç»“æœ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">future1</span><span class="p">,</span><span class="w"> </span><span class="n">future2</span><span class="p">,</span><span class="w"> </span><span class="n">future3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">CompletableFuture</span><span class="p">::</span><span class="n">join</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>anyOfï¼šç­‰å¾…ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">1000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Task1&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">500</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Task2&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">anyFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">anyOf</span><span class="p">(</span><span class="n">future1</span><span class="p">,</span><span class="w"> </span><span class="n">future2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">anyFuture</span><span class="p">.</span><span class="na">join</span><span class="p">());</span><span class="w">  </span><span class="c1">// Task2ï¼ˆå…ˆå®Œæˆçš„ï¼‰</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="å®æˆ˜æ¡ˆä¾‹å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡">å®æˆ˜æ¡ˆä¾‹ï¼šå¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡<a hidden class="anchor" aria-hidden="true" href="#å®æˆ˜æ¡ˆä¾‹å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡">#</a></h2>
<p>å‡è®¾ä¸€ä¸ªå•†å“è¯¦æƒ…é¡µéœ€è¦è°ƒç”¨ä¸‰ä¸ªæœåŠ¡ï¼š</p>
<ul>
<li>å•†å“æœåŠ¡ï¼šæŸ¥è¯¢å•†å“ä¿¡æ¯</li>
<li>åº“å­˜æœåŠ¡ï¼šæŸ¥è¯¢åº“å­˜</li>
<li>è¯„è®ºæœåŠ¡ï¼šæŸ¥è¯¢è¯„è®º</li>
</ul>
<p><strong>ä¸²è¡Œè°ƒç”¨ï¼ˆæ…¢ï¼‰</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">ProductDetailDTO</span><span class="w"> </span><span class="nf">getProductDetail</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productService</span><span class="p">.</span><span class="na">getProduct</span><span class="p">(</span><span class="n">productId</span><span class="p">);</span><span class="w">  </span><span class="c1">// 100ms</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Stock</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stockService</span><span class="p">.</span><span class="na">getStock</span><span class="p">(</span><span class="n">productId</span><span class="p">);</span><span class="w">          </span><span class="c1">// 100ms</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Comment</span><span class="o">&gt;</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commentService</span><span class="p">.</span><span class="na">getComments</span><span class="p">(</span><span class="n">productId</span><span class="p">);</span><span class="w">  </span><span class="c1">// 100ms</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ProductDetailDTO</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">product</span><span class="p">(</span><span class="n">product</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">stock</span><span class="p">(</span><span class="n">stock</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">comments</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// æ€»è€—æ—¶ï¼š300ms</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å¹¶è¡Œè°ƒç”¨ï¼ˆå¿«ï¼‰</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">ProductDetailDTO</span><span class="w"> </span><span class="nf">getProductDetail</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">productFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">productService</span><span class="p">.</span><span class="na">getProduct</span><span class="p">(</span><span class="n">productId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Stock</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stockFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">stockService</span><span class="p">.</span><span class="na">getStock</span><span class="p">(</span><span class="n">productId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Comment</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">commentsFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">commentService</span><span class="p">.</span><span class="na">getComments</span><span class="p">(</span><span class="n">productId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">allOf</span><span class="p">(</span><span class="n">productFuture</span><span class="p">,</span><span class="w"> </span><span class="n">stockFuture</span><span class="p">,</span><span class="w"> </span><span class="n">commentsFuture</span><span class="p">).</span><span class="na">join</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ProductDetailDTO</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">product</span><span class="p">(</span><span class="n">productFuture</span><span class="p">.</span><span class="na">join</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">stock</span><span class="p">(</span><span class="n">stockFuture</span><span class="p">.</span><span class="na">join</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">comments</span><span class="p">(</span><span class="n">commentsFuture</span><span class="p">.</span><span class="na">join</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// æ€»è€—æ—¶ï¼š100msï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ€§èƒ½æå‡ï¼šä» 300ms é™ä½åˆ° 100msã€‚</p>
<hr>
<h2 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#å¼‚å¸¸å¤„ç†">#</a></h2>
<p><strong>exceptionallyï¼šæ•è·å¼‚å¸¸å¹¶è¿”å›é»˜è®¤å€¼</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="na">random</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;Error&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Success&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="na">exceptionally</span><span class="p">(</span><span class="n">ex</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;å¼‚å¸¸: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Default&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>handleï¼šåŒæ—¶å¤„ç†æ­£å¸¸ç»“æœå’Œå¼‚å¸¸</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="na">random</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;Error&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Success&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="na">handle</span><span class="p">((</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;å¼‚å¸¸: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Default&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>whenCompleteï¼šä¸æ”¹å˜ç»“æœï¼Œåªåšå‰¯ä½œç”¨æ“ä½œ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Success&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="na">whenComplete</span><span class="p">((</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;å¼‚å¸¸: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;ç»“æœ: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>é¿å‘æç¤ºï¼š</strong> exceptionally å’Œ handle ä¼šæ”¹å˜ CompletableFuture çš„ç»“æœï¼Œè€Œ whenComplete ä¸ä¼šã€‚é€‰æ‹©å“ªä¸ªå–å†³äºä½ æ˜¯å¦éœ€è¦æ”¹å˜ç»“æœã€‚</p>
</blockquote>
<hr>
<h2 id="è¶…æ—¶æ§åˆ¶">è¶…æ—¶æ§åˆ¶<a hidden class="anchor" aria-hidden="true" href="#è¶…æ—¶æ§åˆ¶">#</a></h2>
<p>JDK 9 å¼•å…¥äº†è¶…æ—¶æ§åˆ¶æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">2000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Success&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="na">orTimeout</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">)</span><span class="w">  </span><span class="c1">// è¶…æ—¶æŠ›å‡º TimeoutException</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">.</span><span class="na">exceptionally</span><span class="p">(</span><span class="n">ex</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Timeout&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>JDK 8 å¯ä»¥é€šè¿‡ CompletableFuture.anyOf å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">taskFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">2000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Success&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">timeoutFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">scheduler</span><span class="p">.</span><span class="na">schedule</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">timeoutFuture</span><span class="p">.</span><span class="na">completeExceptionally</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TimeoutException</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">},</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">anyOf</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">taskFuture</span><span class="p">,</span><span class="w"> </span><span class="n">timeoutFuture</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="ä¸çº¿ç¨‹æ± çš„é…åˆ">ä¸çº¿ç¨‹æ± çš„é…åˆ<a hidden class="anchor" aria-hidden="true" href="#ä¸çº¿ç¨‹æ± çš„é…åˆ">#</a></h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompletableFuture ä½¿ç”¨ ForkJoinPool.commonPool()ï¼Œçº¿ç¨‹æ•°ç­‰äº CPU æ ¸å¿ƒæ•°ã€‚</p>
<p>å¯¹äº IO å¯†é›†å‹ä»»åŠ¡ï¼Œåº”è¯¥ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="n">20</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// IO å¯†é›†å‹ä»»åŠ¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">httpClient</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">url</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">},</span><span class="w"> </span><span class="n">executor</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ol>
<li>ä¸åŒç±»å‹çš„ä»»åŠ¡ä½¿ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼ˆCPU å¯†é›†å‹ vs IO å¯†é›†å‹ï¼‰</li>
<li>çº¿ç¨‹æ± è¦åˆç†é…ç½®å¤§å°ï¼Œé¿å…èµ„æºè€—å°½</li>
<li>åº”ç”¨å…³é—­æ—¶è¦ä¼˜é›…åœ°å…³é—­çº¿ç¨‹æ± </li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PreDestroy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">executor</span><span class="p">.</span><span class="na">shutdown</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">executor</span><span class="p">.</span><span class="na">awaitTermination</span><span class="p">(</span><span class="n">60</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">executor</span><span class="p">.</span><span class="na">shutdownNow</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">executor</span><span class="p">.</span><span class="na">shutdownNow</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ<a hidden class="anchor" aria-hidden="true" href="#æœ€ä½³å®è·µ">#</a></h2>
<p><strong>1. é¿å…é˜»å¡æ“ä½œ</strong></p>
<p>ä¸è¦åœ¨ CompletableFuture çš„å›è°ƒä¸­æ‰§è¡Œé˜»å¡æ“ä½œï¼Œä¼šå ç”¨çº¿ç¨‹æ± èµ„æºã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ä¸å¥½ï¼šé˜»å¡æ“ä½œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">1000</span><span class="p">);</span><span class="w">  </span><span class="c1">// é˜»å¡çº¿ç¨‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Result&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¥½ï¼šä½¿ç”¨å¼‚æ­¥ API</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">asyncHttpClient</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="na">join</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>2. åˆç†è®¾ç½®è¶…æ—¶</strong></p>
<p>é¿å…ä»»åŠ¡æ— é™ç­‰å¾…ï¼Œå¯¼è‡´èµ„æºæ³„æ¼ã€‚</p>
<p><strong>3. å¼‚å¸¸å¤„ç†è¦å®Œå–„</strong></p>
<p>ç¡®ä¿æ¯ä¸ª CompletableFuture éƒ½æœ‰å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œé¿å…å¼‚å¸¸è¢«åæ‰ã€‚</p>
<p><strong>4. é¿å…è¿‡åº¦å¹¶è¡Œ</strong></p>
<p>å¹¶è¡Œä»»åŠ¡æ•°ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¦æ ¹æ®ç³»ç»Ÿèµ„æºå’Œä¸‹æ¸¸æœåŠ¡çš„æ‰¿è½½èƒ½åŠ›è°ƒæ•´ã€‚</p>
<hr>
<h2 id="æ€»ç»“ä¸æ€è€ƒ">æ€»ç»“ä¸æ€è€ƒ<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“ä¸æ€è€ƒ">#</a></h2>
<p>CompletableFuture æ˜¯ Java å¼‚æ­¥ç¼–ç¨‹çš„åˆ©å™¨ï¼Œå®ƒæä¾›äº†ï¼š</p>
<ul>
<li>é“¾å¼è°ƒç”¨ï¼šä¼˜é›…çš„å¼‚æ­¥æµæ°´çº¿</li>
<li>ç»„åˆæ“ä½œï¼šçµæ´»çš„ä»»åŠ¡ç¼–æ’</li>
<li>å¼‚å¸¸å¤„ç†ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
<li>çº¿ç¨‹æ± é›†æˆï¼šé«˜æ•ˆçš„èµ„æºåˆ©ç”¨</li>
</ul>
<p>æŒæ¡ CompletableFutureï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å’Œä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</p>
<p>ä¸‹æ¬¡å½“ä½ éœ€è¦å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡æ—¶ï¼Œä¸å¦¨è¯•è¯• CompletableFutureï¼Œä½“éªŒå¼‚æ­¥ç¼–ç¨‹çš„é­…åŠ›ã€‚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/java/">Java</a></li>
      <li><a href="http://localhost:1313/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/">å¼‚æ­¥ç¼–ç¨‹</a></li>
      <li><a href="http://localhost:1313/tags/completablefuture/">CompletableFuture</a></li>
      <li><a href="http://localhost:1313/tags/%E5%B9%B6%E5%8F%91/">å¹¶å‘</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/spring-aop-dynamic-proxy/">
    <span class="title">Â« Prev</span>
    <br>
    <span>Spring AOP åŸç†ä¸åŠ¨æ€ä»£ç†å®ç°æ·±åº¦è§£æ</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/threadlocal-memory-leak/">
    <span class="title">Next Â»</span>
    <br>
    <span>ThreadLocal åŸç†ä¸å†…å­˜æ³„æ¼æ’æŸ¥å®æˆ˜</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å— on x"
            href="https://x.com/intent/tweet/?text=CompletableFuture%20%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcompletablefuture-async-programming%2f&amp;hashtags=Java%2c%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%2cCompletableFuture%2c%e5%b9%b6%e5%8f%91">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å— on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcompletablefuture-async-programming%2f&amp;title=CompletableFuture%20%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97&amp;summary=CompletableFuture%20%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fcompletablefuture-async-programming%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å— on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcompletablefuture-async-programming%2f&title=CompletableFuture%20%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å— on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fcompletablefuture-async-programming%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å— on whatsapp"
            href="https://api.whatsapp.com/send?text=CompletableFuture%20%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fcompletablefuture-async-programming%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å— on telegram"
            href="https://telegram.me/share/url?text=CompletableFuture%20%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcompletablefuture-async-programming%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CompletableFuture å¼‚æ­¥ç¼–ç¨‹å®æˆ˜æŒ‡å— on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=CompletableFuture%20%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fcompletablefuture-async-programming%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">åšå®¢å–µ</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
