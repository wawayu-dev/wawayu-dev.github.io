<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜ | åšå®¢å–µ</title>
<meta name="keywords" content="MySQL, åˆ†å¸ƒå¼ç³»ç»Ÿ, æ€§èƒ½ä¼˜åŒ–, æœ€ä½³å®è·µ">
<meta name="description" content="ä»å•è¡¨åƒä¸‡çº§æ•°æ®åˆ°åˆ†åº“åˆ†è¡¨ï¼ŒæŒæ¡ShardingSphereçš„ç”Ÿäº§çº§åº”ç”¨">
<meta name="author" content="wawayu">
<link rel="canonical" href="http://localhost:1313/posts/2025/02/shardingsphere-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9A%84%E7%94%9F%E4%BA%A7%E5%AE%9E%E6%88%98/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a29c24210eb31d9ce56f669c66a35c9c51b17376b7764e336a49af7dec914cf0.css" integrity="sha256-opwkIQ6zHZzlb2acZqNcnFGxc3a3dk4zakmvfeyRTPA=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2025/02/shardingsphere-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9A%84%E7%94%9F%E4%BA%A7%E5%AE%9E%E6%88%98/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/posts/2025/02/shardingsphere-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9A%84%E7%94%9F%E4%BA%A7%E5%AE%9E%E6%88%98/">
  <meta property="og:site_name" content="åšå®¢å–µ">
  <meta property="og:title" content="ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜">
  <meta property="og:description" content="ä»å•è¡¨åƒä¸‡çº§æ•°æ®åˆ°åˆ†åº“åˆ†è¡¨ï¼ŒæŒæ¡ShardingSphereçš„ç”Ÿäº§çº§åº”ç”¨">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-15T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-02-15T00:00:00+00:00">
    <meta property="article:tag" content="MySQL">
    <meta property="article:tag" content="åˆ†å¸ƒå¼ç³»ç»Ÿ">
    <meta property="article:tag" content="æ€§èƒ½ä¼˜åŒ–">
    <meta property="article:tag" content="æœ€ä½³å®è·µ">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜">
<meta name="twitter:description" content="ä»å•è¡¨åƒä¸‡çº§æ•°æ®åˆ°åˆ†åº“åˆ†è¡¨ï¼ŒæŒæ¡ShardingSphereçš„ç”Ÿäº§çº§åº”ç”¨">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜",
      "item": "http://localhost:1313/posts/2025/02/shardingsphere-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9A%84%E7%94%9F%E4%BA%A7%E5%AE%9E%E6%88%98/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜",
  "name": "ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜",
  "description": "ä»å•è¡¨åƒä¸‡çº§æ•°æ®åˆ°åˆ†åº“åˆ†è¡¨ï¼ŒæŒæ¡ShardingSphereçš„ç”Ÿäº§çº§åº”ç”¨",
  "keywords": [
    "MySQL", "åˆ†å¸ƒå¼ç³»ç»Ÿ", "æ€§èƒ½ä¼˜åŒ–", "æœ€ä½³å®è·µ"
  ],
  "articleBody": "å½“å•è¡¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§åˆ«æ—¶ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚åˆ†åº“åˆ†è¡¨æ˜¯è§£å†³å¤§æ•°æ®é‡é—®é¢˜çš„æœ‰æ•ˆæ–¹æ¡ˆã€‚æœ¬æ–‡å°†æ·±å…¥è®²è§£å¦‚ä½•ä½¿ç”¨ ShardingSphere å®ç°åˆ†åº“åˆ†è¡¨ï¼Œå¹¶åˆ†äº«ç”Ÿäº§ç¯å¢ƒçš„å®æˆ˜ç»éªŒã€‚\næœ¬æ–‡äº®ç‚¹ ç†è§£åˆ†åº“åˆ†è¡¨çš„æ ¸å¿ƒæ¦‚å¿µå’Œåº”ç”¨åœºæ™¯ æŒæ¡ ShardingSphere çš„é…ç½®å’Œä½¿ç”¨æ–¹æ³• å­¦ä¼šé€‰æ‹©åˆé€‚çš„åˆ†ç‰‡ç­–ç•¥ äº†è§£åˆ†åº“åˆ†è¡¨çš„æœ€ä½³å®è·µå’Œå¸¸è§é—®é¢˜ ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ åœºæ™¯ï¼šè®¢å•è¡¨æ•°æ®çˆ†ç‚¸\nç”µå•†ç³»ç»Ÿçš„è®¢å•è¡¨ï¼Œæ¯å¤©æ–°å¢10ä¸‡æ¡æ•°æ®ï¼Œä¸€å¹´å°±æ˜¯3600ä¸‡æ¡ã€‚éšç€æ•°æ®é‡å¢é•¿ï¼š\næŸ¥è¯¢å˜æ…¢ï¼šå•è¡¨æŸ¥è¯¢ä»æ¯«ç§’çº§å˜æˆç§’çº§ ç´¢å¼•å¤±æ•ˆï¼šB+æ ‘å±‚çº§å¢åŠ ï¼Œç´¢å¼•æ•ˆç‡ä¸‹é™ é”ç«äº‰ï¼šå¤§è¡¨çš„é”ç²’åº¦å¤§ï¼Œå¹¶å‘æ€§èƒ½å·® å¤‡ä»½å›°éš¾ï¼šå•è¡¨å¤‡ä»½æ—¶é—´è¿‡é•¿ ä¼ ç»Ÿä¼˜åŒ–æ–¹æ¡ˆçš„å±€é™\n1-- ä¼˜åŒ–ç´¢å¼• 2CREATE INDEX idx_user_id_create_time ON orders(user_id, create_time); 3 4-- åˆ†åŒºè¡¨ 5ALTER TABLE orders PARTITION BY RANGE (YEAR(create_time)) ( 6 PARTITION p2023 VALUES LESS THAN (2024), 7 PARTITION p2024 VALUES LESS THAN (2025) 8); è¿™äº›æ–¹æ¡ˆåªèƒ½ç¼“è§£é—®é¢˜ï¼Œæ— æ³•æ ¹æœ¬è§£å†³ã€‚å½“æ•°æ®é‡è¾¾åˆ°äº¿çº§æ—¶ï¼Œåˆ†åº“åˆ†è¡¨æ˜¯å¿…ç„¶é€‰æ‹©ã€‚\nåˆ†åº“åˆ†è¡¨æ ¸å¿ƒæ¦‚å¿µ å‚ç›´æ‹†åˆ† vs æ°´å¹³æ‹†åˆ† å‚ç›´æ‹†åˆ†ï¼šæŒ‰ä¸šåŠ¡æ¨¡å—æ‹†åˆ†\n1åŸå§‹æ•°æ®åº“ 2â”œâ”€â”€ ç”¨æˆ·è¡¨ 3â”œâ”€â”€ è®¢å•è¡¨ 4â”œâ”€â”€ å•†å“è¡¨ 5â””â”€â”€ æ”¯ä»˜è¡¨ 6 7æ‹†åˆ†å 8â”œâ”€â”€ ç”¨æˆ·åº“ 9â”‚ â””â”€â”€ ç”¨æˆ·è¡¨ 10â”œâ”€â”€ è®¢å•åº“ 11â”‚ â””â”€â”€ è®¢å•è¡¨ 12â”œâ”€â”€ å•†å“åº“ 13â”‚ â””â”€â”€ å•†å“è¡¨ 14â””â”€â”€ æ”¯ä»˜åº“ 15 â””â”€â”€ æ”¯ä»˜è¡¨ æ°´å¹³æ‹†åˆ†ï¼šæŒ‰æ•°æ®è¡Œæ‹†åˆ†\n1è®¢å•è¡¨ï¼ˆ1äº¿æ¡æ•°æ®ï¼‰ 2 3æ‹†åˆ†å 4â”œâ”€â”€ orders_0ï¼ˆ2500ä¸‡æ¡ï¼‰ 5â”œâ”€â”€ orders_1ï¼ˆ2500ä¸‡æ¡ï¼‰ 6â”œâ”€â”€ orders_2ï¼ˆ2500ä¸‡æ¡ï¼‰ 7â””â”€â”€ orders_3ï¼ˆ2500ä¸‡æ¡ï¼‰ åˆ†ç‰‡é”®çš„é€‰æ‹© åˆ†ç‰‡é”®å†³å®šäº†æ•°æ®å¦‚ä½•åˆ†å¸ƒï¼Œé€‰æ‹©ä¸å½“ä¼šå¯¼è‡´æ•°æ®å€¾æ–œã€‚\nå¸¸è§åˆ†ç‰‡é”®ï¼š\nç”¨æˆ·IDï¼šé€‚åˆç”¨æˆ·ç»´åº¦æŸ¥è¯¢ è®¢å•IDï¼šé€‚åˆè®¢å•ç»´åº¦æŸ¥è¯¢ æ—¶é—´ï¼šé€‚åˆæ—¶é—´èŒƒå›´æŸ¥è¯¢ é€‰æ‹©åŸåˆ™ï¼š\né«˜é¢‘æŸ¥è¯¢å­—æ®µ æ•°æ®åˆ†å¸ƒå‡åŒ€ é¿å…è·¨åˆ†ç‰‡æŸ¥è¯¢ ShardingSphere å¿«é€Ÿå…¥é—¨ å¼•å…¥ä¾èµ– 1 2 org.apache.shardingsphere 3 shardingsphere-jdbc-core-spring-boot-starter 4 5.3.2 5 åŸºç¡€é…ç½® 1spring: 2 shardingsphere: 3 # æ•°æ®æºé…ç½® 4 datasource: 5 names: ds0,ds1 6 ds0: 7 type: com.zaxxer.hikari.HikariDataSource 8 driver-class-name: com.mysql.cj.jdbc.Driver 9 jdbc-url: jdbc:mysql://localhost:3306/order_db_0 10 username: root 11 password: root 12 ds1: 13 type: com.zaxxer.hikari.HikariDataSource 14 driver-class-name: com.mysql.cj.jdbc.Driver 15 jdbc-url: jdbc:mysql://localhost:3306/order_db_1 16 username: root 17 password: root 18 19 # åˆ†ç‰‡è§„åˆ™ 20 rules: 21 sharding: 22 tables: 23 orders: 24 # å®é™…èŠ‚ç‚¹ 25 actual-data-nodes: ds$-\u003e{0..1}.orders_$-\u003e{0..3} 26 # åˆ†åº“ç­–ç•¥ 27 database-strategy: 28 standard: 29 sharding-column: user_id 30 sharding-algorithm-name: database-inline 31 # åˆ†è¡¨ç­–ç•¥ 32 table-strategy: 33 standard: 34 sharding-column: order_id 35 sharding-algorithm-name: table-inline 36 37 # åˆ†ç‰‡ç®—æ³• 38 sharding-algorithms: 39 database-inline: 40 type: INLINE 41 props: 42 algorithm-expression: ds$-\u003e{user_id % 2} 43 table-inline: 44 type: INLINE 45 props: 46 algorithm-expression: orders_$-\u003e{order_id % 4} 47 48 # å±æ€§é…ç½® 49 props: 50 sql-show: true å®ä½“ç±» 1@Data 2@TableName(\"orders\") 3public class Order { 4 private Long orderId; 5 private Long userId; 6 private BigDecimal amount; 7 private Integer status; 8 private LocalDateTime createTime; 9} ä½¿ç”¨ç¤ºä¾‹ 1@Service 2public class OrderService { 3 4 @Autowired 5 private OrderMapper orderMapper; 6 7 /** 8 * æ’å…¥è®¢å• 9 * ShardingSphere ä¼šæ ¹æ® user_id å’Œ order_id è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”çš„åº“è¡¨ 10 */ 11 public void createOrder(Order order) { 12 orderMapper.insert(order); 13 } 14 15 /** 16 * æ ¹æ®è®¢å•IDæŸ¥è¯¢ 17 * å•åˆ†ç‰‡æŸ¥è¯¢ï¼Œæ€§èƒ½æœ€ä¼˜ 18 */ 19 public Order getById(Long orderId) { 20 return orderMapper.selectById(orderId); 21 } 22 23 /** 24 * æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢è®¢å•åˆ—è¡¨ 25 * å•åº“å¤šè¡¨æŸ¥è¯¢ï¼Œéœ€è¦åˆå¹¶ç»“æœ 26 */ 27 public List\u003cOrder\u003e listByUserId(Long userId) { 28 return orderMapper.selectList( 29 new LambdaQueryWrapper\u003cOrder\u003e() 30 .eq(Order::getUserId, userId) 31 .orderByDesc(Order::getCreateTime) 32 ); 33 } 34} åˆ†ç‰‡ç­–ç•¥è¯¦è§£ 1. æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ï¼ˆStandardï¼‰ é€‚ç”¨äºå•ä¸€åˆ†ç‰‡é”®çš„åœºæ™¯ã€‚\n1database-strategy: 2 standard: 3 sharding-column: user_id 4 sharding-algorithm-name: database-mod å–æ¨¡ç®—æ³•\n1sharding-algorithms: 2 database-mod: 3 type: MOD 4 props: 5 sharding-count: 2 å“ˆå¸Œå–æ¨¡ç®—æ³•\n1sharding-algorithms: 2 database-hash-mod: 3 type: HASH_MOD 4 props: 5 sharding-count: 2 2. å¤åˆåˆ†ç‰‡ç­–ç•¥ï¼ˆComplexï¼‰ é€‚ç”¨äºå¤šä¸ªåˆ†ç‰‡é”®çš„åœºæ™¯ã€‚\n1database-strategy: 2 complex: 3 sharding-columns: user_id,order_id 4 sharding-algorithm-name: complex-inline 1sharding-algorithms: 2 complex-inline: 3 type: CLASS_BASED 4 props: 5 strategy: COMPLEX 6 algorithm-class-name: com.example.ComplexShardingAlgorithm è‡ªå®šä¹‰å¤åˆç®—æ³•\n1public class ComplexShardingAlgorithm implements ComplexKeysShardingAlgorithm\u003cLong\u003e { 2 3 @Override 4 public Collection\u003cString\u003e doSharding( 5 Collection\u003cString\u003e availableTargetNames, 6 ComplexKeysShardingValue\u003cLong\u003e shardingValue) { 7 8 // è·å–åˆ†ç‰‡é”®å€¼ 9 Map\u003cString, Collection\u003cLong\u003e\u003e columnNameAndShardingValuesMap = 10 shardingValue.getColumnNameAndShardingValuesMap(); 11 12 Collection\u003cLong\u003e userIds = columnNameAndShardingValuesMap.get(\"user_id\"); 13 Collection\u003cLong\u003e orderIds = columnNameAndShardingValuesMap.get(\"order_id\"); 14 15 // è‡ªå®šä¹‰åˆ†ç‰‡é€»è¾‘ 16 Set\u003cString\u003e result = new HashSet\u003c\u003e(); 17 for (Long userId : userIds) { 18 for (Long orderId : orderIds) { 19 String suffix = String.valueOf((userId + orderId) % 4); 20 result.addAll(availableTargetNames.stream() 21 .filter(name -\u003e name.endsWith(suffix)) 22 .collect(Collectors.toList())); 23 } 24 } 25 return result; 26 } 27} 3. èŒƒå›´åˆ†ç‰‡ç­–ç•¥ï¼ˆRangeï¼‰ é€‚ç”¨äºæ—¶é—´èŒƒå›´æŸ¥è¯¢ã€‚\n1table-strategy: 2 standard: 3 sharding-column: create_time 4 sharding-algorithm-name: table-range 1sharding-algorithms: 2 table-range: 3 type: CLASS_BASED 4 props: 5 strategy: STANDARD 6 algorithm-class-name: com.example.RangeShardingAlgorithm æŒ‰æœˆåˆ†ç‰‡\n1public class RangeShardingAlgorithm implements StandardShardingAlgorithm\u003cLocalDateTime\u003e { 2 3 @Override 4 public String doSharding( 5 Collection\u003cString\u003e availableTargetNames, 6 PreciseShardingValue\u003cLocalDateTime\u003e shardingValue) { 7 8 LocalDateTime createTime = shardingValue.getValue(); 9 int month = createTime.getMonthValue(); 10 String suffix = String.format(\"%02d\", month); 11 12 return availableTargetNames.stream() 13 .filter(name -\u003e name.endsWith(suffix)) 14 .findFirst() 15 .orElseThrow(() -\u003e new IllegalArgumentException(\"æ‰¾ä¸åˆ°å¯¹åº”çš„åˆ†ç‰‡è¡¨\")); 16 } 17 18 @Override 19 public Collection\u003cString\u003e doSharding( 20 Collection\u003cString\u003e availableTargetNames, 21 RangeShardingValue\u003cLocalDateTime\u003e shardingValue) { 22 23 Range\u003cLocalDateTime\u003e range = shardingValue.getValueRange(); 24 LocalDateTime start = range.lowerEndpoint(); 25 LocalDateTime end = range.upperEndpoint(); 26 27 Set\u003cString\u003e result = new HashSet\u003c\u003e(); 28 for (int month = start.getMonthValue(); month \u003c= end.getMonthValue(); month++) { 29 String suffix = String.format(\"%02d\", month); 30 result.addAll(availableTargetNames.stream() 31 .filter(name -\u003e name.endsWith(suffix)) 32 .collect(Collectors.toList())); 33 } 34 return result; 35 } 36} åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆ åˆ†åº“åˆ†è¡¨åï¼Œè‡ªå¢ä¸»é”®ä¼šå†²çªï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼ä¸»é”®ã€‚\nSnowflake ç®—æ³• 1rules: 2 sharding: 3 tables: 4 orders: 5 key-generate-strategy: 6 column: order_id 7 key-generator-name: snowflake 8 9 key-generators: 10 snowflake: 11 type: SNOWFLAKE 12 props: 13 worker-id: 1 è‡ªå®šä¹‰ä¸»é”®ç”Ÿæˆå™¨ 1public class CustomKeyGenerator implements KeyGenerateAlgorithm { 2 3 @Override 4 public Comparable\u003c?\u003e generateKey() { 5 // æ—¶é—´æˆ³ï¼ˆ41ä½ï¼‰+ æœºå™¨IDï¼ˆ10ä½ï¼‰+ åºåˆ—å·ï¼ˆ12ä½ï¼‰ 6 long timestamp = System.currentTimeMillis(); 7 long workerId = getWorkerId(); 8 long sequence = getSequence(); 9 10 return (timestamp \u003c\u003c 22) | (workerId \u003c\u003c 12) | sequence; 11 } 12} è¯»å†™åˆ†ç¦» ShardingSphere æ”¯æŒä¸»ä»è¯»å†™åˆ†ç¦»ã€‚\n1rules: 2 readwrite-splitting: 3 data-sources: 4 ds0: 5 type: Static 6 props: 7 write-data-source-name: ds0-master 8 read-data-source-names: ds0-slave0,ds0-slave1 9 load-balancer-name: round-robin 10 ds1: 11 type: Static 12 props: 13 write-data-source-name: ds1-master 14 read-data-source-names: ds1-slave0,ds1-slave1 15 load-balancer-name: round-robin 16 17 load-balancers: 18 round-robin: 19 type: ROUND_ROBIN å¼ºåˆ¶ä¸»åº“æŸ¥è¯¢\n1// ä½¿ç”¨ HintManager å¼ºåˆ¶è·¯ç”±åˆ°ä¸»åº“ 2HintManager hintManager = HintManager.getInstance(); 3hintManager.setWriteRouteOnly(); 4try { 5 Order order = orderMapper.selectById(orderId); 6} finally { 7 hintManager.close(); 8} è·¨åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ– é—®é¢˜ï¼šå…¨è¡¨æ‰«æ 1// ä¸å¸¦åˆ†ç‰‡é”®çš„æŸ¥è¯¢ï¼Œä¼šæ‰«ææ‰€æœ‰åˆ†ç‰‡ 2List\u003cOrder\u003e orders = orderMapper.selectList( 3 new LambdaQueryWrapper\u003cOrder\u003e() 4 .eq(Order::getStatus, 1) 5); è§£å†³æ–¹æ¡ˆ1ï¼šå†—ä½™åˆ†ç‰‡é”® 1// åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­æ·»åŠ åˆ†ç‰‡é”® 2List\u003cOrder\u003e orders = orderMapper.selectList( 3 new LambdaQueryWrapper\u003cOrder\u003e() 4 .eq(Order::getUserId, userId) // åˆ†ç‰‡é”® 5 .eq(Order::getStatus, 1) 6); è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨ Hint 1// æ‰‹åŠ¨æŒ‡å®šåˆ†ç‰‡ 2HintManager hintManager = HintManager.getInstance(); 3hintManager.addDatabaseShardingValue(\"orders\", \"user_id\", userId); 4hintManager.addTableShardingValue(\"orders\", \"order_id\", orderId); 5try { 6 Order order = orderMapper.selectById(orderId); 7} finally { 8 hintManager.close(); 9} è§£å†³æ–¹æ¡ˆ3ï¼šå»ºç«‹æ˜ å°„è¡¨ 1-- è®¢å•çŠ¶æ€æ˜ å°„è¡¨ï¼ˆä¸åˆ†ç‰‡ï¼‰ 2CREATE TABLE order_status_mapping ( 3 order_id BIGINT PRIMARY KEY, 4 user_id BIGINT, 5 status INT, 6 INDEX idx_status (status) 7); 1// å…ˆæŸ¥æ˜ å°„è¡¨è·å–åˆ†ç‰‡é”® 2List\u003cLong\u003e orderIds = mappingMapper.selectOrderIdsByStatus(status); 3 4// å†æ ¹æ®åˆ†ç‰‡é”®æŸ¥è¯¢è¯¦æƒ… 5List\u003cOrder\u003e orders = orderIds.stream() 6 .map(orderMapper::selectById) 7 .collect(Collectors.toList()); åˆ†å¸ƒå¼äº‹åŠ¡ ShardingSphere æ”¯æŒ XA å’Œ Saga ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡ã€‚\nXA äº‹åŠ¡ 1rules: 2 transaction: 3 default-type: XA 4 provider-type: Atomikos 1@Transactional 2public void createOrderWithXA(Order order, OrderItem item) { 3 // è·¨åˆ†ç‰‡çš„äº‹åŠ¡æ“ä½œ 4 orderMapper.insert(order); 5 orderItemMapper.insert(item); 6} Saga äº‹åŠ¡ 1rules: 2 transaction: 3 default-type: BASE 4 provider-type: Seata æ¶æ„æ€è€ƒï¼š XA äº‹åŠ¡ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½†æ€§èƒ½è¾ƒå·®ï¼›Saga äº‹åŠ¡ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ€§èƒ½æ›´å¥½ã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Sagaï¼Œé€šè¿‡è¡¥å¿æœºåˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚\næ•°æ®è¿ç§»æ–¹æ¡ˆ æ–¹æ¡ˆä¸€ï¼šåŒå†™ + æ•°æ®æ ¡éªŒ 1@Service 2public class OrderMigrationService { 3 4 @Autowired 5 private OrderMapper oldOrderMapper; // æ—§è¡¨ 6 7 @Autowired 8 private OrderMapper newOrderMapper; // æ–°è¡¨ï¼ˆåˆ†ç‰‡ï¼‰ 9 10 /** 11 * åŒå†™é˜¶æ®µï¼šåŒæ—¶å†™å…¥æ—§è¡¨å’Œæ–°è¡¨ 12 */ 13 public void createOrder(Order order) { 14 // å†™å…¥æ—§è¡¨ 15 oldOrderMapper.insert(order); 16 17 // å¼‚æ­¥å†™å…¥æ–°è¡¨ 18 CompletableFuture.runAsync(() -\u003e { 19 try { 20 newOrderMapper.insert(order); 21 } catch (Exception e) { 22 log.error(\"æ–°è¡¨å†™å…¥å¤±è´¥\", e); 23 // è®°å½•å¤±è´¥æ—¥å¿—ï¼Œåç»­è¡¥å¿ 24 } 25 }); 26 } 27 28 /** 29 * æ•°æ®æ ¡éªŒï¼šå¯¹æ¯”æ–°æ—§è¡¨æ•°æ® 30 */ 31 public void verifyData(Long orderId) { 32 Order oldOrder = oldOrderMapper.selectById(orderId); 33 Order newOrder = newOrderMapper.selectById(orderId); 34 35 if (!Objects.equals(oldOrder, newOrder)) { 36 log.error(\"æ•°æ®ä¸ä¸€è‡´: orderId={}\", orderId); 37 // è§¦å‘å‘Šè­¦ 38 } 39 } 40} æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ Canal åŒæ­¥ 1# Canal é…ç½® 2canal: 3 server: 127.0.0.1:11111 4 destination: example 5 username: canal 6 password: canal 7 filter: order_db\\\\.orders 1@Component 2public class CanalDataSyncListener { 3 4 @Autowired 5 private OrderMapper shardingOrderMapper; 6 7 @CanalEventListener 8 public void onEvent(CanalEntry.Entry entry) { 9 if (entry.getEntryType() == CanalEntry.EntryType.ROWDATA) { 10 RowChange rowChange = RowChange.parseFrom(entry.getStoreValue()); 11 12 for (CanalEntry.RowData rowData : rowChange.getRowDatasList()) { 13 if (rowChange.getEventType() == CanalEntry.EventType.INSERT) { 14 Order order = parseOrder(rowData.getAfterColumnsList()); 15 shardingOrderMapper.insert(order); 16 } 17 } 18 } 19 } 20} æ€§èƒ½å¯¹æ¯” æµ‹è¯•ç¯å¢ƒ æ•°æ®é‡ï¼š5000ä¸‡æ¡ åˆ†ç‰‡é…ç½®ï¼š2åº“ Ã— 4è¡¨ = 8ä¸ªåˆ†ç‰‡ æ¯ä¸ªåˆ†ç‰‡ï¼š625ä¸‡æ¡æ•°æ® æŸ¥è¯¢æ€§èƒ½å¯¹æ¯” åœºæ™¯ å•è¡¨ åˆ†åº“åˆ†è¡¨ æå‡ ä¸»é”®æŸ¥è¯¢ 150ms 15ms 10å€ ç´¢å¼•æŸ¥è¯¢ 800ms 80ms 10å€ èŒƒå›´æŸ¥è¯¢ 2000ms 250ms 8å€ èšåˆæŸ¥è¯¢ 5000ms 800ms 6å€ å†™å…¥æ€§èƒ½å¯¹æ¯” åœºæ™¯ å•è¡¨ åˆ†åº“åˆ†è¡¨ æå‡ å•æ¡æ’å…¥ 5ms 6ms æŒå¹³ æ‰¹é‡æ’å…¥ï¼ˆ1000æ¡ï¼‰ 800ms 200ms 4å€ æœ€ä½³å®è·µ 1. åˆ†ç‰‡é”®é€‰æ‹©\nä¼˜å…ˆé€‰æ‹©é«˜é¢‘æŸ¥è¯¢å­—æ®µ ç¡®ä¿æ•°æ®åˆ†å¸ƒå‡åŒ€ é¿å…çƒ­ç‚¹æ•°æ® 2. é¿å…è·¨åˆ†ç‰‡æŸ¥è¯¢\nåœ¨æŸ¥è¯¢æ¡ä»¶ä¸­åŒ…å«åˆ†ç‰‡é”® ä½¿ç”¨æ˜ å°„è¡¨è¾…åŠ©æŸ¥è¯¢ åˆç†è®¾è®¡æ•°æ®æ¨¡å‹ 3. åˆ†ç‰‡æ•°é‡è§„åˆ’\nå•è¡¨æ•°æ®é‡æ§åˆ¶åœ¨500ä¸‡ä»¥å†… é¢„ç•™æ‰©å±•ç©ºé—´ï¼ˆ2-3å€ï¼‰ åˆ†ç‰‡æ•°é‡å»ºè®®ä¸º2çš„å¹‚æ¬¡æ–¹ 4. ç›‘æ§å‘Šè­¦\nç›‘æ§å„åˆ†ç‰‡æ•°æ®é‡ ç›‘æ§æ…¢æŸ¥è¯¢ ç›‘æ§è·¨åˆ†ç‰‡æŸ¥è¯¢æ¯”ä¾‹ 5. ç°åº¦å‘å¸ƒ\nå…ˆè¿ç§»å†å²æ•°æ® å†å¼€å¯åŒå†™ æœ€ååˆ‡æ¢è¯»æµé‡ é¿å‘æç¤ºï¼š åˆ†åº“åˆ†è¡¨ä¸æ˜¯é“¶å¼¹ï¼Œä¼šå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ã€‚åœ¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§ä¹‹å‰ï¼Œä¼˜å…ˆè€ƒè™‘ç´¢å¼•ä¼˜åŒ–ã€ç¼“å­˜ã€è¯»å†™åˆ†ç¦»ç­‰æ–¹æ¡ˆã€‚åªæœ‰åœ¨è¿™äº›æ–¹æ¡ˆéƒ½æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå†è€ƒè™‘åˆ†åº“åˆ†è¡¨ã€‚\næ€»ç»“ä¸æ€è€ƒ ShardingSphere åˆ†åº“åˆ†è¡¨çš„æ ¸å¿ƒè¦ç‚¹ï¼š\né€‰æ‹©åˆé€‚çš„åˆ†ç‰‡é”®ï¼Œé¿å…æ•°æ®å€¾æ–œ ä½¿ç”¨æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ï¼Œç®€åŒ–é…ç½® é¿å…è·¨åˆ†ç‰‡æŸ¥è¯¢ï¼Œæå‡æ€§èƒ½ ä½¿ç”¨åˆ†å¸ƒå¼ä¸»é”®ï¼Œé¿å…IDå†²çª ç°åº¦è¿ç§»æ•°æ®ï¼Œé™ä½é£é™© åˆ†åº“åˆ†è¡¨æ˜¯è§£å†³å¤§æ•°æ®é‡é—®é¢˜çš„æœ‰æ•ˆæ–¹æ¡ˆï¼Œä½†ä¹Ÿä¼šå¸¦æ¥å¤æ‚åº¦ã€‚åœ¨å®æ–½å‰è¦å……åˆ†è¯„ä¼°ï¼š\næ˜¯å¦çœŸçš„éœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ åˆ†ç‰‡é”®å¦‚ä½•é€‰æ‹©ï¼Ÿ å¦‚ä½•å¤„ç†è·¨åˆ†ç‰‡æŸ¥è¯¢ï¼Ÿ å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ ä¸‹æ¬¡å½“ä½ çš„å•è¡¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§æ—¶ï¼Œä¸å¦¨è¯•è¯• ShardingSphereï¼Œè®©æ•°æ®åº“æ€§èƒ½é‡å›å·…å³°ã€‚\n",
  "wordCount" : "1274",
  "inLanguage": "en",
  "datePublished": "2025-02-15T00:00:00Z",
  "dateModified": "2025-02-15T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "wawayu"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/2025/02/shardingsphere-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9A%84%E7%94%9F%E4%BA%A7%E5%AE%9E%E6%88%98/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "åšå®¢å–µ",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="åšå®¢å–µ (Alt + H)">åšå®¢å–µ</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="ğŸ“ æ–‡ç« ">
                    <span>ğŸ“ æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="ğŸ·ï¸ æ ‡ç­¾">
                    <span>ğŸ·ï¸ æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="ğŸ“‚ åˆ†ç±»">
                    <span>ğŸ“‚ åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/skills/" title="ğŸ’» æŠ€èƒ½">
                    <span>ğŸ’» æŠ€èƒ½</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="ğŸ‘¤ å…³äº">
                    <span>ğŸ‘¤ å…³äº</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ” æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;Â»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜
    </h1>
    <div class="post-description">
      ä»å•è¡¨åƒä¸‡çº§æ•°æ®åˆ°åˆ†åº“åˆ†è¡¨ï¼ŒæŒæ¡ShardingSphereçš„ç”Ÿäº§çº§åº”ç”¨
    </div>
    <div class="post-meta"><span title='2025-02-15 00:00:00 +0000 UTC'>February 15, 2025</span>&nbsp;Â·&nbsp;<span>6 min</span>&nbsp;Â·&nbsp;<span>1274 words</span>&nbsp;Â·&nbsp;<span>wawayu</span>&nbsp;|&nbsp;<span>
    <a href="https://github.com/wawayu-dev/wawayu-dev.github.io/tree/main/content/posts/shardingsphere-sharding-practice.md" rel="noopener noreferrer edit" target="_blank">å»ºè®®ä¿®æ”¹</a>
</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#æœ¬æ–‡äº®ç‚¹">æœ¬æ–‡äº®ç‚¹</a></li>
      </ul>
    </li>
    <li><a href="#ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨">ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ</a></li>
    <li><a href="#åˆ†åº“åˆ†è¡¨æ ¸å¿ƒæ¦‚å¿µ">åˆ†åº“åˆ†è¡¨æ ¸å¿ƒæ¦‚å¿µ</a>
      <ul>
        <li><a href="#å‚ç›´æ‹†åˆ†-vs-æ°´å¹³æ‹†åˆ†">å‚ç›´æ‹†åˆ† vs æ°´å¹³æ‹†åˆ†</a></li>
        <li><a href="#åˆ†ç‰‡é”®çš„é€‰æ‹©">åˆ†ç‰‡é”®çš„é€‰æ‹©</a></li>
      </ul>
    </li>
    <li><a href="#shardingsphere-å¿«é€Ÿå…¥é—¨">ShardingSphere å¿«é€Ÿå…¥é—¨</a>
      <ul>
        <li><a href="#å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–</a></li>
        <li><a href="#åŸºç¡€é…ç½®">åŸºç¡€é…ç½®</a></li>
        <li><a href="#å®ä½“ç±»">å®ä½“ç±»</a></li>
        <li><a href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li>
      </ul>
    </li>
    <li><a href="#åˆ†ç‰‡ç­–ç•¥è¯¦è§£">åˆ†ç‰‡ç­–ç•¥è¯¦è§£</a>
      <ul>
        <li><a href="#1-æ ‡å‡†åˆ†ç‰‡ç­–ç•¥standard">1. æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ï¼ˆStandardï¼‰</a></li>
        <li><a href="#2-å¤åˆåˆ†ç‰‡ç­–ç•¥complex">2. å¤åˆåˆ†ç‰‡ç­–ç•¥ï¼ˆComplexï¼‰</a></li>
        <li><a href="#3-èŒƒå›´åˆ†ç‰‡ç­–ç•¥range">3. èŒƒå›´åˆ†ç‰‡ç­–ç•¥ï¼ˆRangeï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆ">åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆ</a>
      <ul>
        <li><a href="#snowflake-ç®—æ³•">Snowflake ç®—æ³•</a></li>
        <li><a href="#è‡ªå®šä¹‰ä¸»é”®ç”Ÿæˆå™¨">è‡ªå®šä¹‰ä¸»é”®ç”Ÿæˆå™¨</a></li>
      </ul>
    </li>
    <li><a href="#è¯»å†™åˆ†ç¦»">è¯»å†™åˆ†ç¦»</a></li>
    <li><a href="#è·¨åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ–">è·¨åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ–</a>
      <ul>
        <li><a href="#é—®é¢˜å…¨è¡¨æ‰«æ">é—®é¢˜ï¼šå…¨è¡¨æ‰«æ</a></li>
        <li><a href="#è§£å†³æ–¹æ¡ˆ1å†—ä½™åˆ†ç‰‡é”®">è§£å†³æ–¹æ¡ˆ1ï¼šå†—ä½™åˆ†ç‰‡é”®</a></li>
        <li><a href="#è§£å†³æ–¹æ¡ˆ2ä½¿ç”¨-hint">è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨ Hint</a></li>
        <li><a href="#è§£å†³æ–¹æ¡ˆ3å»ºç«‹æ˜ å°„è¡¨">è§£å†³æ–¹æ¡ˆ3ï¼šå»ºç«‹æ˜ å°„è¡¨</a></li>
      </ul>
    </li>
    <li><a href="#åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡</a>
      <ul>
        <li><a href="#xa-äº‹åŠ¡">XA äº‹åŠ¡</a></li>
        <li><a href="#saga-äº‹åŠ¡">Saga äº‹åŠ¡</a></li>
      </ul>
    </li>
    <li><a href="#æ•°æ®è¿ç§»æ–¹æ¡ˆ">æ•°æ®è¿ç§»æ–¹æ¡ˆ</a>
      <ul>
        <li><a href="#æ–¹æ¡ˆä¸€åŒå†™--æ•°æ®æ ¡éªŒ">æ–¹æ¡ˆä¸€ï¼šåŒå†™ + æ•°æ®æ ¡éªŒ</a></li>
        <li><a href="#æ–¹æ¡ˆäºŒä½¿ç”¨-canal-åŒæ­¥">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ Canal åŒæ­¥</a></li>
      </ul>
    </li>
    <li><a href="#æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”</a>
      <ul>
        <li><a href="#æµ‹è¯•ç¯å¢ƒ">æµ‹è¯•ç¯å¢ƒ</a></li>
        <li><a href="#æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”">æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”</a></li>
        <li><a href="#å†™å…¥æ€§èƒ½å¯¹æ¯”">å†™å…¥æ€§èƒ½å¯¹æ¯”</a></li>
      </ul>
    </li>
    <li><a href="#æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</a></li>
    <li><a href="#æ€»ç»“ä¸æ€è€ƒ">æ€»ç»“ä¸æ€è€ƒ</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>å½“å•è¡¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§åˆ«æ—¶ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚åˆ†åº“åˆ†è¡¨æ˜¯è§£å†³å¤§æ•°æ®é‡é—®é¢˜çš„æœ‰æ•ˆæ–¹æ¡ˆã€‚æœ¬æ–‡å°†æ·±å…¥è®²è§£å¦‚ä½•ä½¿ç”¨ ShardingSphere å®ç°åˆ†åº“åˆ†è¡¨ï¼Œå¹¶åˆ†äº«ç”Ÿäº§ç¯å¢ƒçš„å®æˆ˜ç»éªŒã€‚</p>
<h3 id="æœ¬æ–‡äº®ç‚¹">æœ¬æ–‡äº®ç‚¹<a hidden class="anchor" aria-hidden="true" href="#æœ¬æ–‡äº®ç‚¹">#</a></h3>
<ul>
<li><input checked="" disabled="" type="checkbox"> ç†è§£åˆ†åº“åˆ†è¡¨çš„æ ¸å¿ƒæ¦‚å¿µå’Œåº”ç”¨åœºæ™¯</li>
<li><input checked="" disabled="" type="checkbox"> æŒæ¡ ShardingSphere çš„é…ç½®å’Œä½¿ç”¨æ–¹æ³•</li>
<li><input checked="" disabled="" type="checkbox"> å­¦ä¼šé€‰æ‹©åˆé€‚çš„åˆ†ç‰‡ç­–ç•¥</li>
<li><input checked="" disabled="" type="checkbox"> äº†è§£åˆ†åº“åˆ†è¡¨çš„æœ€ä½³å®è·µå’Œå¸¸è§é—®é¢˜</li>
</ul>
<hr>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨">ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨">#</a></h2>
<p><strong>åœºæ™¯ï¼šè®¢å•è¡¨æ•°æ®çˆ†ç‚¸</strong></p>
<p>ç”µå•†ç³»ç»Ÿçš„è®¢å•è¡¨ï¼Œæ¯å¤©æ–°å¢10ä¸‡æ¡æ•°æ®ï¼Œä¸€å¹´å°±æ˜¯3600ä¸‡æ¡ã€‚éšç€æ•°æ®é‡å¢é•¿ï¼š</p>
<ol>
<li><strong>æŸ¥è¯¢å˜æ…¢</strong>ï¼šå•è¡¨æŸ¥è¯¢ä»æ¯«ç§’çº§å˜æˆç§’çº§</li>
<li><strong>ç´¢å¼•å¤±æ•ˆ</strong>ï¼šB+æ ‘å±‚çº§å¢åŠ ï¼Œç´¢å¼•æ•ˆç‡ä¸‹é™</li>
<li><strong>é”ç«äº‰</strong>ï¼šå¤§è¡¨çš„é”ç²’åº¦å¤§ï¼Œå¹¶å‘æ€§èƒ½å·®</li>
<li><strong>å¤‡ä»½å›°éš¾</strong>ï¼šå•è¡¨å¤‡ä»½æ—¶é—´è¿‡é•¿</li>
</ol>
<p><strong>ä¼ ç»Ÿä¼˜åŒ–æ–¹æ¡ˆçš„å±€é™</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- ä¼˜åŒ–ç´¢å¼•
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_user_id_create_time</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">create_time</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">-- åˆ†åŒºè¡¨
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">RANGE</span><span class="w"> </span><span class="p">(</span><span class="k">YEAR</span><span class="p">(</span><span class="n">create_time</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">p2023</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="k">LESS</span><span class="w"> </span><span class="k">THAN</span><span class="w"> </span><span class="p">(</span><span class="mi">2024</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">p2024</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="k">LESS</span><span class="w"> </span><span class="k">THAN</span><span class="w"> </span><span class="p">(</span><span class="mi">2025</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>è¿™äº›æ–¹æ¡ˆåªèƒ½ç¼“è§£é—®é¢˜ï¼Œæ— æ³•æ ¹æœ¬è§£å†³ã€‚å½“æ•°æ®é‡è¾¾åˆ°äº¿çº§æ—¶ï¼Œåˆ†åº“åˆ†è¡¨æ˜¯å¿…ç„¶é€‰æ‹©ã€‚</p>
<hr>
<h2 id="åˆ†åº“åˆ†è¡¨æ ¸å¿ƒæ¦‚å¿µ">åˆ†åº“åˆ†è¡¨æ ¸å¿ƒæ¦‚å¿µ<a hidden class="anchor" aria-hidden="true" href="#åˆ†åº“åˆ†è¡¨æ ¸å¿ƒæ¦‚å¿µ">#</a></h2>
<h3 id="å‚ç›´æ‹†åˆ†-vs-æ°´å¹³æ‹†åˆ†">å‚ç›´æ‹†åˆ† vs æ°´å¹³æ‹†åˆ†<a hidden class="anchor" aria-hidden="true" href="#å‚ç›´æ‹†åˆ†-vs-æ°´å¹³æ‹†åˆ†">#</a></h3>
<p><strong>å‚ç›´æ‹†åˆ†</strong>ï¼šæŒ‰ä¸šåŠ¡æ¨¡å—æ‹†åˆ†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln"> 1</span><span class="cl">åŸå§‹æ•°æ®åº“
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">â”œâ”€â”€ ç”¨æˆ·è¡¨
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">â”œâ”€â”€ è®¢å•è¡¨
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">â”œâ”€â”€ å•†å“è¡¨
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">â””â”€â”€ æ”¯ä»˜è¡¨
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">æ‹†åˆ†å
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">â”œâ”€â”€ ç”¨æˆ·åº“
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">â”‚   â””â”€â”€ ç”¨æˆ·è¡¨
</span></span><span class="line"><span class="ln">10</span><span class="cl">â”œâ”€â”€ è®¢å•åº“
</span></span><span class="line"><span class="ln">11</span><span class="cl">â”‚   â””â”€â”€ è®¢å•è¡¨
</span></span><span class="line"><span class="ln">12</span><span class="cl">â”œâ”€â”€ å•†å“åº“
</span></span><span class="line"><span class="ln">13</span><span class="cl">â”‚   â””â”€â”€ å•†å“è¡¨
</span></span><span class="line"><span class="ln">14</span><span class="cl">â””â”€â”€ æ”¯ä»˜åº“
</span></span><span class="line"><span class="ln">15</span><span class="cl">    â””â”€â”€ æ”¯ä»˜è¡¨
</span></span></code></pre></div><p><strong>æ°´å¹³æ‹†åˆ†</strong>ï¼šæŒ‰æ•°æ®è¡Œæ‹†åˆ†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">è®¢å•è¡¨ï¼ˆ1äº¿æ¡æ•°æ®ï¼‰
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">æ‹†åˆ†å
</span></span><span class="line"><span class="ln">4</span><span class="cl">â”œâ”€â”€ orders_0ï¼ˆ2500ä¸‡æ¡ï¼‰
</span></span><span class="line"><span class="ln">5</span><span class="cl">â”œâ”€â”€ orders_1ï¼ˆ2500ä¸‡æ¡ï¼‰
</span></span><span class="line"><span class="ln">6</span><span class="cl">â”œâ”€â”€ orders_2ï¼ˆ2500ä¸‡æ¡ï¼‰
</span></span><span class="line"><span class="ln">7</span><span class="cl">â””â”€â”€ orders_3ï¼ˆ2500ä¸‡æ¡ï¼‰
</span></span></code></pre></div><h3 id="åˆ†ç‰‡é”®çš„é€‰æ‹©">åˆ†ç‰‡é”®çš„é€‰æ‹©<a hidden class="anchor" aria-hidden="true" href="#åˆ†ç‰‡é”®çš„é€‰æ‹©">#</a></h3>
<p>åˆ†ç‰‡é”®å†³å®šäº†æ•°æ®å¦‚ä½•åˆ†å¸ƒï¼Œé€‰æ‹©ä¸å½“ä¼šå¯¼è‡´æ•°æ®å€¾æ–œã€‚</p>
<p><strong>å¸¸è§åˆ†ç‰‡é”®ï¼š</strong></p>
<ul>
<li>ç”¨æˆ·IDï¼šé€‚åˆç”¨æˆ·ç»´åº¦æŸ¥è¯¢</li>
<li>è®¢å•IDï¼šé€‚åˆè®¢å•ç»´åº¦æŸ¥è¯¢</li>
<li>æ—¶é—´ï¼šé€‚åˆæ—¶é—´èŒƒå›´æŸ¥è¯¢</li>
</ul>
<p><strong>é€‰æ‹©åŸåˆ™ï¼š</strong></p>
<ol>
<li>é«˜é¢‘æŸ¥è¯¢å­—æ®µ</li>
<li>æ•°æ®åˆ†å¸ƒå‡åŒ€</li>
<li>é¿å…è·¨åˆ†ç‰‡æŸ¥è¯¢</li>
</ol>
<hr>
<h2 id="shardingsphere-å¿«é€Ÿå…¥é—¨">ShardingSphere å¿«é€Ÿå…¥é—¨<a hidden class="anchor" aria-hidden="true" href="#shardingsphere-å¿«é€Ÿå…¥é—¨">#</a></h2>
<h3 id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–<a hidden class="anchor" aria-hidden="true" href="#å¼•å…¥ä¾èµ–">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.apache.shardingsphere<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>shardingsphere-jdbc-core-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="nt">&lt;version&gt;</span>5.3.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="åŸºç¡€é…ç½®">åŸºç¡€é…ç½®<a hidden class="anchor" aria-hidden="true" href="#åŸºç¡€é…ç½®">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">  </span><span class="nt">shardingsphere</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="c"># æ•°æ®æºé…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">      </span><span class="nt">names</span><span class="p">:</span><span class="w"> </span><span class="l">ds0,ds1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">      </span><span class="nt">ds0</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">com.zaxxer.hikari.HikariDataSource</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">        </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        </span><span class="nt">jdbc-url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://localhost:3306/order_db_0</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">      </span><span class="nt">ds1</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">com.zaxxer.hikari.HikariDataSource</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">        </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">        </span><span class="nt">jdbc-url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://localhost:3306/order_db_1</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">    </span><span class="c"># åˆ†ç‰‡è§„åˆ™</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">    </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">      </span><span class="nt">sharding</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">        </span><span class="nt">tables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">          </span><span class="nt">orders</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">            </span><span class="c"># å®é™…èŠ‚ç‚¹</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">            </span><span class="nt">actual-data-nodes</span><span class="p">:</span><span class="w"> </span><span class="l">ds$-&gt;{0..1}.orders_$-&gt;{0..3}</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">            </span><span class="c"># åˆ†åº“ç­–ç•¥</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">            </span><span class="nt">database-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">              </span><span class="nt">standard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">                </span><span class="nt">sharding-column</span><span class="p">:</span><span class="w"> </span><span class="l">user_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w">                </span><span class="nt">sharding-algorithm-name</span><span class="p">:</span><span class="w"> </span><span class="l">database-inline</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w">            </span><span class="c"># åˆ†è¡¨ç­–ç•¥</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w">            </span><span class="nt">table-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w">              </span><span class="nt">standard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="w">                </span><span class="nt">sharding-column</span><span class="p">:</span><span class="w"> </span><span class="l">order_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="w">                </span><span class="nt">sharding-algorithm-name</span><span class="p">:</span><span class="w"> </span><span class="l">table-inline</span><span class="w">
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="w">        </span><span class="c"># åˆ†ç‰‡ç®—æ³•</span><span class="w">
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="w">        </span><span class="nt">sharding-algorithms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="w">          </span><span class="nt">database-inline</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">INLINE</span><span class="w">
</span></span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="w">            </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="w">              </span><span class="nt">algorithm-expression</span><span class="p">:</span><span class="w"> </span><span class="l">ds$-&gt;{user_id % 2}</span><span class="w">
</span></span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="w">          </span><span class="nt">table-inline</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">INLINE</span><span class="w">
</span></span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="w">            </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="w">              </span><span class="nt">algorithm-expression</span><span class="p">:</span><span class="w"> </span><span class="l">orders_$-&gt;{order_id % 4}</span><span class="w">
</span></span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="w">    </span><span class="c"># å±æ€§é…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="w">    </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="w">      </span><span class="nt">sql-show</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><h3 id="å®ä½“ç±»">å®ä½“ç±»<a hidden class="anchor" aria-hidden="true" href="#å®ä½“ç±»">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="nd">@Data</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nd">@TableName</span><span class="p">(</span><span class="s">&#34;orders&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createTime</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨ç¤ºä¾‹">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm">     * æ’å…¥è®¢å•
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">     * ShardingSphere ä¼šæ ¹æ® user_id å’Œ order_id è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”çš„åº“è¡¨
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createOrder</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="cm">     * æ ¹æ®è®¢å•IDæŸ¥è¯¢
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="cm">     * å•åˆ†ç‰‡æŸ¥è¯¢ï¼Œæ€§èƒ½æœ€ä¼˜
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="nf">getById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="cm">     * æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢è®¢å•åˆ—è¡¨
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="cm">     * å•åº“å¤šè¡¨æŸ¥è¯¢ï¼Œéœ€è¦åˆå¹¶ç»“æœ
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">listByUserId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">LambdaQueryWrapper</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Order</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">orderByDesc</span><span class="p">(</span><span class="n">Order</span><span class="p">::</span><span class="n">getCreateTime</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w">        </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<h2 id="åˆ†ç‰‡ç­–ç•¥è¯¦è§£">åˆ†ç‰‡ç­–ç•¥è¯¦è§£<a hidden class="anchor" aria-hidden="true" href="#åˆ†ç‰‡ç­–ç•¥è¯¦è§£">#</a></h2>
<h3 id="1-æ ‡å‡†åˆ†ç‰‡ç­–ç•¥standard">1. æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ï¼ˆStandardï¼‰<a hidden class="anchor" aria-hidden="true" href="#1-æ ‡å‡†åˆ†ç‰‡ç­–ç•¥standard">#</a></h3>
<p>é€‚ç”¨äºå•ä¸€åˆ†ç‰‡é”®çš„åœºæ™¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">database-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">standard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">sharding-column</span><span class="p">:</span><span class="w"> </span><span class="l">user_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">sharding-algorithm-name</span><span class="p">:</span><span class="w"> </span><span class="l">database-mod</span><span class="w">
</span></span></span></code></pre></div><p><strong>å–æ¨¡ç®—æ³•</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">sharding-algorithms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">database-mod</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">MOD</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">      </span><span class="nt">sharding-count</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span></code></pre></div><p><strong>å“ˆå¸Œå–æ¨¡ç®—æ³•</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">sharding-algorithms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">database-hash-mod</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">HASH_MOD</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">      </span><span class="nt">sharding-count</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span></code></pre></div><h3 id="2-å¤åˆåˆ†ç‰‡ç­–ç•¥complex">2. å¤åˆåˆ†ç‰‡ç­–ç•¥ï¼ˆComplexï¼‰<a hidden class="anchor" aria-hidden="true" href="#2-å¤åˆåˆ†ç‰‡ç­–ç•¥complex">#</a></h3>
<p>é€‚ç”¨äºå¤šä¸ªåˆ†ç‰‡é”®çš„åœºæ™¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">database-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">complex</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">sharding-columns</span><span class="p">:</span><span class="w"> </span><span class="l">user_id,order_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">sharding-algorithm-name</span><span class="p">:</span><span class="w"> </span><span class="l">complex-inline</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">sharding-algorithms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">complex-inline</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">CLASS_BASED</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">      </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l">COMPLEX</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">      </span><span class="nt">algorithm-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.example.ComplexShardingAlgorithm</span><span class="w">
</span></span></span></code></pre></div><p><strong>è‡ªå®šä¹‰å¤åˆç®—æ³•</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ComplexShardingAlgorithm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ComplexKeysShardingAlgorithm</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">doSharding</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">            </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">availableTargetNames</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">            </span><span class="n">ComplexKeysShardingValue</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shardingValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">        </span><span class="c1">// è·å–åˆ†ç‰‡é”®å€¼</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">columnNameAndShardingValuesMap</span><span class="w"> </span><span class="o">=</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">            </span><span class="n">shardingValue</span><span class="p">.</span><span class="na">getColumnNameAndShardingValuesMap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">columnNameAndShardingValuesMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;user_id&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">        </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orderIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">columnNameAndShardingValuesMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;order_id&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">        </span><span class="c1">// è‡ªå®šä¹‰åˆ†ç‰‡é€»è¾‘</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">userIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">orderId</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">orderIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">((</span><span class="n">userId</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">4</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">availableTargetNames</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="n">suffix</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="3-èŒƒå›´åˆ†ç‰‡ç­–ç•¥range">3. èŒƒå›´åˆ†ç‰‡ç­–ç•¥ï¼ˆRangeï¼‰<a hidden class="anchor" aria-hidden="true" href="#3-èŒƒå›´åˆ†ç‰‡ç­–ç•¥range">#</a></h3>
<p>é€‚ç”¨äºæ—¶é—´èŒƒå›´æŸ¥è¯¢ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">table-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">standard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">sharding-column</span><span class="p">:</span><span class="w"> </span><span class="l">create_time</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">sharding-algorithm-name</span><span class="p">:</span><span class="w"> </span><span class="l">table-range</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">sharding-algorithms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">table-range</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">CLASS_BASED</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">      </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l">STANDARD</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">      </span><span class="nt">algorithm-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.example.RangeShardingAlgorithm</span><span class="w">
</span></span></span></code></pre></div><p><strong>æŒ‰æœˆåˆ†ç‰‡</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RangeShardingAlgorithm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">StandardShardingAlgorithm</span><span class="o">&lt;</span><span class="n">LocalDateTime</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">doSharding</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">            </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">availableTargetNames</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">            </span><span class="n">PreciseShardingValue</span><span class="o">&lt;</span><span class="n">LocalDateTime</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shardingValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shardingValue</span><span class="p">.</span><span class="na">getValue</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTime</span><span class="p">.</span><span class="na">getMonthValue</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&#34;%02d&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">availableTargetNames</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="n">suffix</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">findFirst</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&#34;æ‰¾ä¸åˆ°å¯¹åº”çš„åˆ†ç‰‡è¡¨&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">doSharding</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">            </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">availableTargetNames</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">            </span><span class="n">RangeShardingValue</span><span class="o">&lt;</span><span class="n">LocalDateTime</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shardingValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">        </span><span class="n">Range</span><span class="o">&lt;</span><span class="n">LocalDateTime</span><span class="o">&gt;</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shardingValue</span><span class="p">.</span><span class="na">getValueRange</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="na">lowerEndpoint</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="na">upperEndpoint</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">.</span><span class="na">getMonthValue</span><span class="p">();</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">end</span><span class="p">.</span><span class="na">getMonthValue</span><span class="p">();</span><span class="w"> </span><span class="n">month</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&#34;%02d&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">availableTargetNames</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="n">suffix</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<h2 id="åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆ">åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆ<a hidden class="anchor" aria-hidden="true" href="#åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆ">#</a></h2>
<p>åˆ†åº“åˆ†è¡¨åï¼Œè‡ªå¢ä¸»é”®ä¼šå†²çªï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼ä¸»é”®ã€‚</p>
<h3 id="snowflake-ç®—æ³•">Snowflake ç®—æ³•<a hidden class="anchor" aria-hidden="true" href="#snowflake-ç®—æ³•">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">  </span><span class="nt">sharding</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nt">tables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">      </span><span class="nt">orders</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="nt">key-generate-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">          </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l">order_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">          </span><span class="nt">key-generator-name</span><span class="p">:</span><span class="w"> </span><span class="l">snowflake</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="nt">key-generators</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">      </span><span class="nt">snowflake</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">SNOWFLAKE</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">          </span><span class="nt">worker-id</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span></code></pre></div><h3 id="è‡ªå®šä¹‰ä¸»é”®ç”Ÿæˆå™¨">è‡ªå®šä¹‰ä¸»é”®ç”Ÿæˆå™¨<a hidden class="anchor" aria-hidden="true" href="#è‡ªå®šä¹‰ä¸»é”®ç”Ÿæˆå™¨">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomKeyGenerator</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">KeyGenerateAlgorithm</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Comparable</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">generateKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="c1">// æ—¶é—´æˆ³ï¼ˆ41ä½ï¼‰+ æœºå™¨IDï¼ˆ10ä½ï¼‰+ åºåˆ—å·ï¼ˆ12ä½ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">workerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getWorkerId</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSequence</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">22</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">workerId</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">12</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<h2 id="è¯»å†™åˆ†ç¦»">è¯»å†™åˆ†ç¦»<a hidden class="anchor" aria-hidden="true" href="#è¯»å†™åˆ†ç¦»">#</a></h2>
<p>ShardingSphere æ”¯æŒä¸»ä»è¯»å†™åˆ†ç¦»ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">  </span><span class="nt">readwrite-splitting</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nt">data-sources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">      </span><span class="nt">ds0</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Static</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">        </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">          </span><span class="nt">write-data-source-name</span><span class="p">:</span><span class="w"> </span><span class="l">ds0-master</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">          </span><span class="nt">read-data-source-names</span><span class="p">:</span><span class="w"> </span><span class="l">ds0-slave0,ds0-slave1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">          </span><span class="nt">load-balancer-name</span><span class="p">:</span><span class="w"> </span><span class="l">round-robin</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">      </span><span class="nt">ds1</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Static</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">          </span><span class="nt">write-data-source-name</span><span class="p">:</span><span class="w"> </span><span class="l">ds1-master</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">          </span><span class="nt">read-data-source-names</span><span class="p">:</span><span class="w"> </span><span class="l">ds1-slave0,ds1-slave1</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">          </span><span class="nt">load-balancer-name</span><span class="p">:</span><span class="w"> </span><span class="l">round-robin</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">    </span><span class="nt">load-balancers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">      </span><span class="nt">round-robin</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ROUND_ROBIN</span><span class="w">
</span></span></span></code></pre></div><p><strong>å¼ºåˆ¶ä¸»åº“æŸ¥è¯¢</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// ä½¿ç”¨ HintManager å¼ºåˆ¶è·¯ç”±åˆ°ä¸»åº“</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">HintManager</span><span class="w"> </span><span class="n">hintManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HintManager</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">hintManager</span><span class="p">.</span><span class="na">setWriteRouteOnly</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="n">hintManager</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<h2 id="è·¨åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ–">è·¨åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#è·¨åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ–">#</a></h2>
<h3 id="é—®é¢˜å…¨è¡¨æ‰«æ">é—®é¢˜ï¼šå…¨è¡¨æ‰«æ<a hidden class="anchor" aria-hidden="true" href="#é—®é¢˜å…¨è¡¨æ‰«æ">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// ä¸å¸¦åˆ†ç‰‡é”®çš„æŸ¥è¯¢ï¼Œä¼šæ‰«ææ‰€æœ‰åˆ†ç‰‡</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">LambdaQueryWrapper</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Order</span><span class="p">::</span><span class="n">getStatus</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><h3 id="è§£å†³æ–¹æ¡ˆ1å†—ä½™åˆ†ç‰‡é”®">è§£å†³æ–¹æ¡ˆ1ï¼šå†—ä½™åˆ†ç‰‡é”®<a hidden class="anchor" aria-hidden="true" href="#è§£å†³æ–¹æ¡ˆ1å†—ä½™åˆ†ç‰‡é”®">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­æ·»åŠ åˆ†ç‰‡é”®</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">LambdaQueryWrapper</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Order</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w">  </span><span class="c1">// åˆ†ç‰‡é”®</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Order</span><span class="p">::</span><span class="n">getStatus</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><h3 id="è§£å†³æ–¹æ¡ˆ2ä½¿ç”¨-hint">è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨ Hint<a hidden class="anchor" aria-hidden="true" href="#è§£å†³æ–¹æ¡ˆ2ä½¿ç”¨-hint">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// æ‰‹åŠ¨æŒ‡å®šåˆ†ç‰‡</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">HintManager</span><span class="w"> </span><span class="n">hintManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HintManager</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">hintManager</span><span class="p">.</span><span class="na">addDatabaseShardingValue</span><span class="p">(</span><span class="s">&#34;orders&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user_id&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">hintManager</span><span class="p">.</span><span class="na">addTableShardingValue</span><span class="p">(</span><span class="s">&#34;orders&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;order_id&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w">    </span><span class="n">hintManager</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="è§£å†³æ–¹æ¡ˆ3å»ºç«‹æ˜ å°„è¡¨">è§£å†³æ–¹æ¡ˆ3ï¼šå»ºç«‹æ˜ å°„è¡¨<a hidden class="anchor" aria-hidden="true" href="#è§£å†³æ–¹æ¡ˆ3å»ºç«‹æ˜ å°„è¡¨">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- è®¢å•çŠ¶æ€æ˜ å°„è¡¨ï¼ˆä¸åˆ†ç‰‡ï¼‰
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">order_status_mapping</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="n">order_id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_status</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// å…ˆæŸ¥æ˜ å°„è¡¨è·å–åˆ†ç‰‡é”®</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orderIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mappingMapper</span><span class="p">.</span><span class="na">selectOrderIdsByStatus</span><span class="p">(</span><span class="n">status</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">// å†æ ¹æ®åˆ†ç‰‡é”®æŸ¥è¯¢è¯¦æƒ…</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderIds</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">orderMapper</span><span class="p">::</span><span class="n">selectById</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></div><hr>
<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡<a hidden class="anchor" aria-hidden="true" href="#åˆ†å¸ƒå¼äº‹åŠ¡">#</a></h2>
<p>ShardingSphere æ”¯æŒ XA å’Œ Saga ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>
<h3 id="xa-äº‹åŠ¡">XA äº‹åŠ¡<a hidden class="anchor" aria-hidden="true" href="#xa-äº‹åŠ¡">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">transaction</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">default-type</span><span class="p">:</span><span class="w"> </span><span class="l">XA</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">provider-type</span><span class="p">:</span><span class="w"> </span><span class="l">Atomikos</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="nd">@Transactional</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createOrderWithXA</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">OrderItem</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="c1">// è·¨åˆ†ç‰‡çš„äº‹åŠ¡æ“ä½œ</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="n">orderItemMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">item</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="saga-äº‹åŠ¡">Saga äº‹åŠ¡<a hidden class="anchor" aria-hidden="true" href="#saga-äº‹åŠ¡">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">transaction</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">default-type</span><span class="p">:</span><span class="w"> </span><span class="l">BASE</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">provider-type</span><span class="p">:</span><span class="w"> </span><span class="l">Seata</span><span class="w">
</span></span></span></code></pre></div><blockquote>
<p><strong>æ¶æ„æ€è€ƒï¼š</strong> XA äº‹åŠ¡ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½†æ€§èƒ½è¾ƒå·®ï¼›Saga äº‹åŠ¡ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ€§èƒ½æ›´å¥½ã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Sagaï¼Œé€šè¿‡è¡¥å¿æœºåˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p>
</blockquote>
<hr>
<h2 id="æ•°æ®è¿ç§»æ–¹æ¡ˆ">æ•°æ®è¿ç§»æ–¹æ¡ˆ<a hidden class="anchor" aria-hidden="true" href="#æ•°æ®è¿ç§»æ–¹æ¡ˆ">#</a></h2>
<h3 id="æ–¹æ¡ˆä¸€åŒå†™--æ•°æ®æ ¡éªŒ">æ–¹æ¡ˆä¸€ï¼šåŒå†™ + æ•°æ®æ ¡éªŒ<a hidden class="anchor" aria-hidden="true" href="#æ–¹æ¡ˆä¸€åŒå†™--æ•°æ®æ ¡éªŒ">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderMigrationService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">oldOrderMapper</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ—§è¡¨</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">newOrderMapper</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ–°è¡¨ï¼ˆåˆ†ç‰‡ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">     * åŒå†™é˜¶æ®µï¼šåŒæ—¶å†™å…¥æ—§è¡¨å’Œæ–°è¡¨
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createOrder</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">        </span><span class="c1">// å†™å…¥æ—§è¡¨</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">        </span><span class="n">oldOrderMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">        </span><span class="c1">// å¼‚æ­¥å†™å…¥æ–°è¡¨</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">        </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">runAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">                </span><span class="n">newOrderMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;æ–°è¡¨å†™å…¥å¤±è´¥&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">                </span><span class="c1">// è®°å½•å¤±è´¥æ—¥å¿—ï¼Œåç»­è¡¥å¿</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="cm">     * æ•°æ®æ ¡éªŒï¼šå¯¹æ¯”æ–°æ—§è¡¨æ•°æ®
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">verifyData</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w">        </span><span class="n">Order</span><span class="w"> </span><span class="n">oldOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldOrderMapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w">        </span><span class="n">Order</span><span class="w"> </span><span class="n">newOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newOrderMapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">oldOrder</span><span class="p">,</span><span class="w"> </span><span class="n">newOrder</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;æ•°æ®ä¸ä¸€è‡´: orderId={}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">orderId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="w">            </span><span class="c1">// è§¦å‘å‘Šè­¦</span><span class="w">
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="æ–¹æ¡ˆäºŒä½¿ç”¨-canal-åŒæ­¥">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ Canal åŒæ­¥<a hidden class="anchor" aria-hidden="true" href="#æ–¹æ¡ˆäºŒä½¿ç”¨-canal-åŒæ­¥">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="c"># Canal é…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nt">canal</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">  </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="p">:</span><span class="m">11111</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">  </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l">example</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">canal</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">canal</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">  </span><span class="nt">filter</span><span class="p">:</span><span class="w"> </span><span class="l">order_db\\.orders</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CanalDataSyncListener</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">shardingOrderMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="nd">@CanalEventListener</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">CanalEntry</span><span class="p">.</span><span class="na">Entry</span><span class="w"> </span><span class="n">entry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="na">getEntryType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CanalEntry</span><span class="p">.</span><span class="na">EntryType</span><span class="p">.</span><span class="na">ROWDATA</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">            </span><span class="n">RowChange</span><span class="w"> </span><span class="n">rowChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RowChange</span><span class="p">.</span><span class="na">parseFrom</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="na">getStoreValue</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">CanalEntry</span><span class="p">.</span><span class="na">RowData</span><span class="w"> </span><span class="n">rowData</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">rowChange</span><span class="p">.</span><span class="na">getRowDatasList</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rowChange</span><span class="p">.</span><span class="na">getEventType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CanalEntry</span><span class="p">.</span><span class="na">EventType</span><span class="p">.</span><span class="na">INSERT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">                    </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseOrder</span><span class="p">(</span><span class="n">rowData</span><span class="p">.</span><span class="na">getAfterColumnsList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">                    </span><span class="n">shardingOrderMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<h2 id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”<a hidden class="anchor" aria-hidden="true" href="#æ€§èƒ½å¯¹æ¯”">#</a></h2>
<h3 id="æµ‹è¯•ç¯å¢ƒ">æµ‹è¯•ç¯å¢ƒ<a hidden class="anchor" aria-hidden="true" href="#æµ‹è¯•ç¯å¢ƒ">#</a></h3>
<ul>
<li>æ•°æ®é‡ï¼š5000ä¸‡æ¡</li>
<li>åˆ†ç‰‡é…ç½®ï¼š2åº“ Ã— 4è¡¨ = 8ä¸ªåˆ†ç‰‡</li>
<li>æ¯ä¸ªåˆ†ç‰‡ï¼š625ä¸‡æ¡æ•°æ®</li>
</ul>
<h3 id="æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”">æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”<a hidden class="anchor" aria-hidden="true" href="#æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”">#</a></h3>
<table>
  <thead>
      <tr>
          <th>åœºæ™¯</th>
          <th>å•è¡¨</th>
          <th>åˆ†åº“åˆ†è¡¨</th>
          <th>æå‡</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ä¸»é”®æŸ¥è¯¢</td>
          <td>150ms</td>
          <td>15ms</td>
          <td>10å€</td>
      </tr>
      <tr>
          <td>ç´¢å¼•æŸ¥è¯¢</td>
          <td>800ms</td>
          <td>80ms</td>
          <td>10å€</td>
      </tr>
      <tr>
          <td>èŒƒå›´æŸ¥è¯¢</td>
          <td>2000ms</td>
          <td>250ms</td>
          <td>8å€</td>
      </tr>
      <tr>
          <td>èšåˆæŸ¥è¯¢</td>
          <td>5000ms</td>
          <td>800ms</td>
          <td>6å€</td>
      </tr>
  </tbody>
</table>
<h3 id="å†™å…¥æ€§èƒ½å¯¹æ¯”">å†™å…¥æ€§èƒ½å¯¹æ¯”<a hidden class="anchor" aria-hidden="true" href="#å†™å…¥æ€§èƒ½å¯¹æ¯”">#</a></h3>
<table>
  <thead>
      <tr>
          <th>åœºæ™¯</th>
          <th>å•è¡¨</th>
          <th>åˆ†åº“åˆ†è¡¨</th>
          <th>æå‡</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>å•æ¡æ’å…¥</td>
          <td>5ms</td>
          <td>6ms</td>
          <td>æŒå¹³</td>
      </tr>
      <tr>
          <td>æ‰¹é‡æ’å…¥ï¼ˆ1000æ¡ï¼‰</td>
          <td>800ms</td>
          <td>200ms</td>
          <td>4å€</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ<a hidden class="anchor" aria-hidden="true" href="#æœ€ä½³å®è·µ">#</a></h2>
<p><strong>1. åˆ†ç‰‡é”®é€‰æ‹©</strong></p>
<ul>
<li>ä¼˜å…ˆé€‰æ‹©é«˜é¢‘æŸ¥è¯¢å­—æ®µ</li>
<li>ç¡®ä¿æ•°æ®åˆ†å¸ƒå‡åŒ€</li>
<li>é¿å…çƒ­ç‚¹æ•°æ®</li>
</ul>
<p><strong>2. é¿å…è·¨åˆ†ç‰‡æŸ¥è¯¢</strong></p>
<ul>
<li>åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­åŒ…å«åˆ†ç‰‡é”®</li>
<li>ä½¿ç”¨æ˜ å°„è¡¨è¾…åŠ©æŸ¥è¯¢</li>
<li>åˆç†è®¾è®¡æ•°æ®æ¨¡å‹</li>
</ul>
<p><strong>3. åˆ†ç‰‡æ•°é‡è§„åˆ’</strong></p>
<ul>
<li>å•è¡¨æ•°æ®é‡æ§åˆ¶åœ¨500ä¸‡ä»¥å†…</li>
<li>é¢„ç•™æ‰©å±•ç©ºé—´ï¼ˆ2-3å€ï¼‰</li>
<li>åˆ†ç‰‡æ•°é‡å»ºè®®ä¸º2çš„å¹‚æ¬¡æ–¹</li>
</ul>
<p><strong>4. ç›‘æ§å‘Šè­¦</strong></p>
<ul>
<li>ç›‘æ§å„åˆ†ç‰‡æ•°æ®é‡</li>
<li>ç›‘æ§æ…¢æŸ¥è¯¢</li>
<li>ç›‘æ§è·¨åˆ†ç‰‡æŸ¥è¯¢æ¯”ä¾‹</li>
</ul>
<p><strong>5. ç°åº¦å‘å¸ƒ</strong></p>
<ul>
<li>å…ˆè¿ç§»å†å²æ•°æ®</li>
<li>å†å¼€å¯åŒå†™</li>
<li>æœ€ååˆ‡æ¢è¯»æµé‡</li>
</ul>
<blockquote>
<p><strong>é¿å‘æç¤ºï¼š</strong> åˆ†åº“åˆ†è¡¨ä¸æ˜¯é“¶å¼¹ï¼Œä¼šå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ã€‚åœ¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§ä¹‹å‰ï¼Œä¼˜å…ˆè€ƒè™‘ç´¢å¼•ä¼˜åŒ–ã€ç¼“å­˜ã€è¯»å†™åˆ†ç¦»ç­‰æ–¹æ¡ˆã€‚åªæœ‰åœ¨è¿™äº›æ–¹æ¡ˆéƒ½æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå†è€ƒè™‘åˆ†åº“åˆ†è¡¨ã€‚</p>
</blockquote>
<hr>
<h2 id="æ€»ç»“ä¸æ€è€ƒ">æ€»ç»“ä¸æ€è€ƒ<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“ä¸æ€è€ƒ">#</a></h2>
<p>ShardingSphere åˆ†åº“åˆ†è¡¨çš„æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<ul>
<li>é€‰æ‹©åˆé€‚çš„åˆ†ç‰‡é”®ï¼Œé¿å…æ•°æ®å€¾æ–œ</li>
<li>ä½¿ç”¨æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ï¼Œç®€åŒ–é…ç½®</li>
<li>é¿å…è·¨åˆ†ç‰‡æŸ¥è¯¢ï¼Œæå‡æ€§èƒ½</li>
<li>ä½¿ç”¨åˆ†å¸ƒå¼ä¸»é”®ï¼Œé¿å…IDå†²çª</li>
<li>ç°åº¦è¿ç§»æ•°æ®ï¼Œé™ä½é£é™©</li>
</ul>
<p>åˆ†åº“åˆ†è¡¨æ˜¯è§£å†³å¤§æ•°æ®é‡é—®é¢˜çš„æœ‰æ•ˆæ–¹æ¡ˆï¼Œä½†ä¹Ÿä¼šå¸¦æ¥å¤æ‚åº¦ã€‚åœ¨å®æ–½å‰è¦å……åˆ†è¯„ä¼°ï¼š</p>
<ul>
<li>æ˜¯å¦çœŸçš„éœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ</li>
<li>åˆ†ç‰‡é”®å¦‚ä½•é€‰æ‹©ï¼Ÿ</li>
<li>å¦‚ä½•å¤„ç†è·¨åˆ†ç‰‡æŸ¥è¯¢ï¼Ÿ</li>
<li>å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</li>
</ul>
<p>ä¸‹æ¬¡å½“ä½ çš„å•è¡¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§æ—¶ï¼Œä¸å¦¨è¯•è¯• ShardingSphereï¼Œè®©æ•°æ®åº“æ€§èƒ½é‡å›å·…å³°ã€‚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/mysql/">MySQL</a></li>
      <li><a href="http://localhost:1313/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li>
      <li><a href="http://localhost:1313/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">æ€§èƒ½ä¼˜åŒ–</a></li>
      <li><a href="http://localhost:1313/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">æœ€ä½³å®è·µ</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/2025/03/redis-%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84%E4%BB%8E%E7%A9%BF%E9%80%8F%E5%88%B0%E9%9B%AA%E5%B4%A9%E7%9A%84%E5%85%A8%E9%93%BE%E8%B7%AF%E9%98%B2%E6%8A%A4/">
    <span class="title">Â« Prev</span>
    <br>
    <span>Redis ç¼“å­˜æ¶æ„ï¼šä»ç©¿é€åˆ°é›ªå´©çš„å…¨é“¾è·¯é˜²æŠ¤</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/2025/01/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8F%82%E6%95%B0%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AEadmin-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E8%AE%BE%E8%AE%A1/">
    <span class="title">Next Â»</span>
    <br>
    <span>çº¿ç¨‹æ± å‚æ•°åŠ¨æ€é…ç½®ï¼šAdmin ç®¡ç†åå°è®¾è®¡</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜ on x"
            href="https://x.com/intent/tweet/?text=ShardingSphere%20%e5%88%86%e5%ba%93%e5%88%86%e8%a1%a8%e7%9a%84%e7%94%9f%e4%ba%a7%e5%ae%9e%e6%88%98&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f02%2fshardingsphere-%25E5%2588%2586%25E5%25BA%2593%25E5%2588%2586%25E8%25A1%25A8%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E5%25AE%259E%25E6%2588%2598%2f&amp;hashtags=MySQL%2c%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%2c%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%2c%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜ on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f02%2fshardingsphere-%25E5%2588%2586%25E5%25BA%2593%25E5%2588%2586%25E8%25A1%25A8%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E5%25AE%259E%25E6%2588%2598%2f&amp;title=ShardingSphere%20%e5%88%86%e5%ba%93%e5%88%86%e8%a1%a8%e7%9a%84%e7%94%9f%e4%ba%a7%e5%ae%9e%e6%88%98&amp;summary=ShardingSphere%20%e5%88%86%e5%ba%93%e5%88%86%e8%a1%a8%e7%9a%84%e7%94%9f%e4%ba%a7%e5%ae%9e%e6%88%98&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f02%2fshardingsphere-%25E5%2588%2586%25E5%25BA%2593%25E5%2588%2586%25E8%25A1%25A8%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E5%25AE%259E%25E6%2588%2598%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜ on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f02%2fshardingsphere-%25E5%2588%2586%25E5%25BA%2593%25E5%2588%2586%25E8%25A1%25A8%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E5%25AE%259E%25E6%2588%2598%2f&title=ShardingSphere%20%e5%88%86%e5%ba%93%e5%88%86%e8%a1%a8%e7%9a%84%e7%94%9f%e4%ba%a7%e5%ae%9e%e6%88%98">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜ on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f02%2fshardingsphere-%25E5%2588%2586%25E5%25BA%2593%25E5%2588%2586%25E8%25A1%25A8%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E5%25AE%259E%25E6%2588%2598%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜ on whatsapp"
            href="https://api.whatsapp.com/send?text=ShardingSphere%20%e5%88%86%e5%ba%93%e5%88%86%e8%a1%a8%e7%9a%84%e7%94%9f%e4%ba%a7%e5%ae%9e%e6%88%98%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f02%2fshardingsphere-%25E5%2588%2586%25E5%25BA%2593%25E5%2588%2586%25E8%25A1%25A8%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E5%25AE%259E%25E6%2588%2598%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜ on telegram"
            href="https://telegram.me/share/url?text=ShardingSphere%20%e5%88%86%e5%ba%93%e5%88%86%e8%a1%a8%e7%9a%84%e7%94%9f%e4%ba%a7%e5%ae%9e%e6%88%98&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f02%2fshardingsphere-%25E5%2588%2586%25E5%25BA%2593%25E5%2588%2586%25E8%25A1%25A8%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E5%25AE%259E%25E6%2588%2598%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ShardingSphere åˆ†åº“åˆ†è¡¨çš„ç”Ÿäº§å®æˆ˜ on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=ShardingSphere%20%e5%88%86%e5%ba%93%e5%88%86%e8%a1%a8%e7%9a%84%e7%94%9f%e4%ba%a7%e5%ae%9e%e6%88%98&u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f02%2fshardingsphere-%25E5%2588%2586%25E5%25BA%2593%25E5%2588%2586%25E8%25A1%25A8%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E5%25AE%259E%25E6%2588%2598%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">åšå®¢å–µ</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
